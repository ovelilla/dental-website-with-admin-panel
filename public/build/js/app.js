(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};t.d({},{hi:()=>F,gk:()=>P});const s=class{constructor(e,t,s){this.target=e,this.container=t,this.collapsed=s,this.type=s,this.start=!1,this.target&&this.target.addEventListener("click",this.toggle.bind(this))}async toggle(){this.setStart(!0),this.toggleClass(),this.collapsed?(this.setCollapsed(!1),await this.expandEl()):(this.setCollapsed(!0),await this.collapseEl()),this.heightAuto(),this.clean(),this.setStart(!1)}async expand(){this.setStart(!0),this.addClass(),this.setCollapsed(!1),await this.expandEl(),this.heightAuto(),this.clean(),this.setStart(!1)}async collapse(){this.setStart(!0),this.addClass(),this.setCollapsed(!0),await this.collapseEl(),this.heightAuto(),this.clean(),this.setStart(!1)}async expandEl(){return new Promise((e=>{this.container.style.height=this.container.scrollHeight+"px",this.container.addEventListener("transitionend",e,{once:!0})}))}async collapseEl(){return new Promise((e=>{requestAnimationFrame((()=>{this.container.style.height=this.container.scrollHeight+"px",requestAnimationFrame((()=>{this.container.style.height="0px"}))})),this.container.addEventListener("transitionend",e,{once:!0})}))}heightAuto(){this.type&&!this.collapsed&&(this.container.style.height="auto")}setStart(e){this.start=e}setCollapsed(e){this.collapsed=e}addClass(){this.target.classList.add("active")}removeClass(){this.target.classList.remove("active")}toggleClass(){this.target.classList.toggle("active")}clean(){(!this.type&&!this.collapsed||this.type&&this.collapsed)&&(this.container.removeAttribute("style"),""==this.target.className&&this.target.removeAttribute("class"))}};class i{constructor(){if(this.constructor===i)throw new TypeError("Abstract class 'Form' cannot be instantiated directly.");window.addEventListener("load",(()=>{this.field.querySelector("input:-webkit-autofill")&&this.field.classList.add("active")}))}getField(){return this.field}createField(){const e=document.createElement("div");return e.classList.add("mio-field"),this.input.value&&e.classList.add("active"),this.error&&e.classList.add("error"),e}createWrapper(){const e=document.createElement("div");return e.classList.add("mio-wrapper"),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-label"),e.textContent=this.label.text,e.htmlFor=this.label.for,e}createAdornment(){const e=document.createElement("div");return e.classList.add("mio-adornment"),e.appendChild(this.adornment),e}createMessage(){if(this.message)return this.messageEl=document.createElement("div"),this.messageEl.classList.add("mio-message"),this.error&&this.messageEl.classList.add("mio-error"),this.messageEl.textContent=this.message,this.messageEl}removeMessage(){this.messageEl&&(this.messageEl.remove(),this.error&&(this.field.classList.remove("error"),this.messageEl.classList.remove("mio-error")))}setValue(e){this.input.value=e,this.field.classList.add("active"),this.removeMessage()}handleBlur(e){e.target.value||this.field.classList.remove("active"),this.field.classList.remove("focus")}handleFocus(){this.field.classList.add("active"),this.field.classList.add("focus")}handleInput(e){this.removeMessage(),this.callback&&this.callback(e.target.value)}}const a=i,n=class extends a{constructor(e){super(e),Object.assign(this,e),this.init()}init(){this.field=this.create()}create(){const e=this.createField(),t=this.createWrapper();e.appendChild(t);const s=this.createLabel();if(t.appendChild(s),this.input=this.createInput(),t.appendChild(this.input),this.message){const t=this.createMessage();e.appendChild(t)}if(this.adornment){const e=this.createAdornment();t.appendChild(e)}return e}createInput(){const e=document.createElement("input");return e.classList.add("mio-input"),e.type=this.input.type,e.name=this.input.name,e.id=this.input.id,e.value=this.input.value??"",this.input.step&&(e.step=this.step),this.input.autocomplete&&(e.autocomplete=this.input.autocomplete),this.input.maxlength&&(e.maxLength=this.input.maxlength),e.addEventListener("focus",this.handleFocus.bind(this)),e.addEventListener("blur",this.handleBlur.bind(this)),e.addEventListener("input",this.handleInput.bind(this)),e}},o=class extends a{constructor(e){super(e),Object.assign(this,e),this.init()}init(){this.field=this.create()}create(){const e=this.createField(),t=this.createWrapper();e.appendChild(t);const s=this.createLabel();t.appendChild(s);const i=this.createTextarea();if(t.appendChild(i),this.message){const t=this.createMessage();e.appendChild(t)}return e}createTextarea(){const e=document.createElement("textarea");return e.classList.add("mio-input"),e.name=this.input.name,e.id=this.input.id,e.rows=this.input.rows??"",e.value=this.input.value??"",this.input.maxlength&&(e.maxLength=this.input.maxlength),e.addEventListener("focus",this.handleFocus.bind(this)),e.addEventListener("blur",this.handleBlur.bind(this)),e.addEventListener("input",this.handleInput.bind(this)),e}},r=class extends a{constructor(e){super(e),Object.assign(this,e),this.init()}init(){this.field=this.create()}create(){const e=this.createField(),t=this.createWrapper();e.appendChild(t),this.checkbox=this.createCheckbox(),t.appendChild(this.checkbox);const s=this.createLabel();if(t.appendChild(s),this.message){const t=this.createMessage();e.appendChild(t)}return e}createCheckbox(){const e=document.createElement("input");return e.classList.add("mio-checkbox-input"),e.type="checkbox",e.name=this.input.name,e.id=this.input.id,this.input.value&&(e.checked=!0),e.addEventListener("change",(()=>{this.removeMessage(),this.callback(e.checked)})),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-checkbox-label"),e.textContent=this.label.text,e.htmlFor=this.label.for,e}},c=class{constructor(e){Object.assign(this,e),this.init()}init(){this.button=this.create()}get(){return this.button}create(){const e=document.createElement("button");this.classes&&e.classList.add(...this.classes),e.classList.add("loading-btn"),e.type=this.type??"button",e.ariaLabel=this.ariaLabel??"",e.addEventListener("click",this.handleClick.bind(this));const t=document.createElement("span");t.classList.add("text"),t.textContent=this.text,e.appendChild(t);const s=document.createElement("div");s.classList.add("loading-icon"),e.appendChild(s);const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox","25 25 50 50"),s.appendChild(i);const a=document.createElementNS("http://www.w3.org/2000/svg","circle");return a.setAttribute("cx","50"),a.setAttribute("cy","50"),a.setAttribute("r","20"),a.setAttribute("fill","none"),a.setAttribute("stroke-width","5"),a.setAttribute("stroke-miterlimit","10"),i.appendChild(a),e}handleClick(){this.button.style.width=`${this.button.offsetWidth}px`,this.button.classList.add("loading"),this.onClick&&this.onClick()}stop(){this.button.classList.remove("loading"),this.button.removeAttribute("style")}},l=(()=>{const e=[{name:"pencilSquare",paths:[{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"},{fillRule:"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"}]},{name:"search",paths:[{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"}]},{name:"trash",paths:[{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"},{fillRule:"evenodd",d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"}]},{name:"chevronRight",paths:[{fillRule:"evenodd",d:"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"}]},{name:"chevronDown",paths:[{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"}]},{name:"chevronLeft",paths:[{fillRule:"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"}]},{name:"chevronDoubleRight",paths:[{fillRule:"evenodd",d:"M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708z"},{fillRule:"evenodd",d:"M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708z"}]},{name:"chevronDoubleLeft",paths:[{fillRule:"evenodd",d:"M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"},{fillRule:"evenodd",d:"M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"}]},{name:"caretDownFill",paths:[{d:"M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"}]},{name:"xLg",paths:[{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"}]},{name:"arrowRight",paths:[{fillRule:"evenodd",d:"M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"}]},{name:"arrowUpShort",paths:[{fillRule:"evenodd",d:"M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"}]},{name:"threeDots",paths:[{d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}]},{name:"threeDotsVertical",paths:[{d:"M9.5 13a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0zm0-5a1.5 1.5 0 1 1-3 0 1.5 1.5 0 0 1 3 0z"}]},{name:"filePDF",paths:[{d:"M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"},{d:"M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z"}]},{name:"fileText",paths:[{d:"M5 4a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zM5 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1H5z"},{d:"M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"}]},{name:"eraserFill",paths:[{d:"M8.086 2.207a2 2 0 0 1 2.828 0l3.879 3.879a2 2 0 0 1 0 2.828l-5.5 5.5A2 2 0 0 1 7.879 15H5.12a2 2 0 0 1-1.414-.586l-2.5-2.5a2 2 0 0 1 0-2.828l6.879-6.879zm.66 11.34L3.453 8.254 1.914 9.793a1 1 0 0 0 0 1.414l2.5 2.5a1 1 0 0 0 .707.293H7.88a1 1 0 0 0 .707-.293l.16-.16z"}]},{name:"arrowsFullscreen",paths:[{fillRule:"evenodd",d:"M5.828 10.172a.5.5 0 0 0-.707 0l-4.096 4.096V11.5a.5.5 0 0 0-1 0v3.975a.5.5 0 0 0 .5.5H4.5a.5.5 0 0 0 0-1H1.732l4.096-4.096a.5.5 0 0 0 0-.707zm4.344 0a.5.5 0 0 1 .707 0l4.096 4.096V11.5a.5.5 0 1 1 1 0v3.975a.5.5 0 0 1-.5.5H11.5a.5.5 0 0 1 0-1h2.768l-4.096-4.096a.5.5 0 0 1 0-.707zm0-4.344a.5.5 0 0 0 .707 0l4.096-4.096V4.5a.5.5 0 1 0 1 0V.525a.5.5 0 0 0-.5-.5H11.5a.5.5 0 0 0 0 1h2.768l-4.096 4.096a.5.5 0 0 0 0 .707zm-4.344 0a.5.5 0 0 1-.707 0L1.025 1.732V4.5a.5.5 0 0 1-1 0V.525a.5.5 0 0 1 .5-.5H4.5a.5.5 0 0 1 0 1H1.732l4.096 4.096a.5.5 0 0 1 0 .707z"}]},{name:"fileCheck",paths:[{d:"M10.854 6.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 8.793l2.646-2.647a.5.5 0 0 1 .708 0z"},{d:"M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"}]},{name:"filePlus",paths:[{d:"M8.5 6a.5.5 0 0 0-1 0v1.5H6a.5.5 0 0 0 0 1h1.5V10a.5.5 0 0 0 1 0V8.5H10a.5.5 0 0 0 0-1H8.5V6z"},{d:"M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"}]},{name:"envelope",paths:[{d:"M0 4a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V4Zm2-1a1 1 0 0 0-1 1v.217l7 4.2 7-4.2V4a1 1 0 0 0-1-1H2Zm13 2.383-4.708 2.825L15 11.105V5.383Zm-.034 6.876-5.64-3.471L8 9.583l-1.326-.795-5.64 3.47A1 1 0 0 0 2 13h12a1 1 0 0 0 .966-.741ZM1 11.105l4.708-2.897L1 5.383v5.722Z"}]},{name:"clipboard2Pulse",paths:[{d:"M9.5 0a.5.5 0 0 1 .5.5.5.5 0 0 0 .5.5.5.5 0 0 1 .5.5V2a.5.5 0 0 1-.5.5h-5A.5.5 0 0 1 5 2v-.5a.5.5 0 0 1 .5-.5.5.5 0 0 0 .5-.5.5.5 0 0 1 .5-.5h3Z"},{d:"M3 2.5a.5.5 0 0 1 .5-.5H4a.5.5 0 0 0 0-1h-.5A1.5 1.5 0 0 0 2 2.5v12A1.5 1.5 0 0 0 3.5 16h9a1.5 1.5 0 0 0 1.5-1.5v-12A1.5 1.5 0 0 0 12.5 1H12a.5.5 0 0 0 0 1h.5a.5.5 0 0 1 .5.5v12a.5.5 0 0 1-.5.5h-9a.5.5 0 0 1-.5-.5v-12Z"},{d:"M9.979 5.356a.5.5 0 0 0-.968.04L7.92 10.49l-.94-3.135a.5.5 0 0 0-.926-.08L4.69 10H4.5a.5.5 0 0 0 0 1H5a.5.5 0 0 0 .447-.276l.936-1.873 1.138 3.793a.5.5 0 0 0 .968-.04L9.58 7.51l.94 3.135A.5.5 0 0 0 11 11h.5a.5.5 0 0 0 0-1h-.128L9.979 5.356Z"}]},{name:"plus",paths:[{d:"M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"}]},{name:"whatsapp",paths:[{d:"M13.601 2.326A7.854 7.854 0 0 0 7.994 0C3.627 0 .068 3.558.064 7.926c0 1.399.366 2.76 1.057 3.965L0 16l4.204-1.102a7.933 7.933 0 0 0 3.79.965h.004c4.368 0 7.926-3.558 7.93-7.93A7.898 7.898 0 0 0 13.6 2.326zM7.994 14.521a6.573 6.573 0 0 1-3.356-.92l-.24-.144-2.494.654.666-2.433-.156-.251a6.56 6.56 0 0 1-1.007-3.505c0-3.626 2.957-6.584 6.591-6.584a6.56 6.56 0 0 1 4.66 1.931 6.557 6.557 0 0 1 1.928 4.66c-.004 3.639-2.961 6.592-6.592 6.592zm3.615-4.934c-.197-.099-1.17-.578-1.353-.646-.182-.065-.315-.099-.445.099-.133.197-.513.646-.627.775-.114.133-.232.148-.43.05-.197-.1-.836-.308-1.592-.985-.59-.525-.985-1.175-1.103-1.372-.114-.198-.011-.304.088-.403.087-.088.197-.232.296-.346.1-.114.133-.198.198-.33.065-.134.034-.248-.015-.347-.05-.099-.445-1.076-.612-1.47-.16-.389-.323-.335-.445-.34-.114-.007-.247-.007-.38-.007a.729.729 0 0 0-.529.247c-.182.198-.691.677-.691 1.654 0 .977.71 1.916.81 2.049.098.133 1.394 2.132 3.383 2.992.47.205.84.326 1.129.418.475.152.904.129 1.246.08.38-.058 1.171-.48 1.338-.943.164-.464.164-.86.114-.943-.049-.084-.182-.133-.38-.232z"}]}];return{get:t=>{const s=e.find((e=>e.name===t));return s?(e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width","16px"),t.setAttribute("height","16px"),t.setAttribute("fill","currentColor"),t.setAttribute("viewBox","0 0 16 16"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.paths.forEach((e=>{const s=document.createElementNS("http://www.w3.org/2000/svg","path");e.fillRule&&s.setAttribute("fill-rule",e.fillRule),s.setAttribute("d",e.d),t.appendChild(s)})),t})(s):null}}})(),d=class{constructor({title:e,description:t,accept:s,cancel:i}){this.title=e,this.description=t,this.accept=s,this.cancel=i,this.init()}init(){this.show()}question(){return new Promise(((e,t)=>{this.dialog&&this.acceptButton&&this.cancelButton&&this.closeButton?(this.dialog.addEventListener("click",(()=>{e(null),this.close()})),this.acceptButton.addEventListener("click",(()=>{e(!0),this.close()})),this.cancelButton.addEventListener("click",(()=>{e(!1),this.close()})),this.closeButton.addEventListener("click",(()=>{e(null),this.close()}))):t("There was a problem creating the modal window!")}))}show(){const e=this.create();document.body.appendChild(e)}create(){this.dialog=document.createElement("div"),this.dialog.classList.add("confirm");const e=document.createElement("div");e.classList.add("content"),e.addEventListener("click",(e=>e.stopPropagation())),this.dialog.appendChild(e);const t=document.createElement("div");t.classList.add("header"),e.appendChild(t);const s=document.createElement("div");s.classList.add("title"),s.textContent=this.title,t.appendChild(s),this.closeButton=document.createElement("button"),this.closeButton.type="button",this.closeButton.classList.add("close"),t.appendChild(this.closeButton);const i=l.get("xLg");this.closeButton.appendChild(i);const a=document.createElement("div");a.classList.add("body"),e.appendChild(a);const n=document.createElement("div");n.classList.add("description"),n.textContent=this.description,a.appendChild(n);const o=document.createElement("div");return o.classList.add("footer"),e.appendChild(o),this.cancelButton=document.createElement("button"),this.cancelButton.type="button",this.cancelButton.classList.add("cancel"),this.cancelButton.textContent=this.cancel,o.appendChild(this.cancelButton),this.acceptButton=document.createElement("button"),this.acceptButton.type="button",this.acceptButton.classList.add("accept"),this.acceptButton.textContent=this.accept,o.appendChild(this.acceptButton),this.dialog}"rehabilitacion-oral-protesis-dentales";"rehabilitacion-oral-protesis-dentales";async close(){this.dialog.classList.add("fadeOut"),this.dialog.firstChild.classList.add("slideOutTop"),await this.animationend(this.dialog),this.dialog.remove()}async transitionend(e){return new Promise((t=>{e.addEventListener("transitionend",t,{once:!0})}))}async animationend(e){return new Promise((t=>{e.addEventListener("animationend",t,{once:!0})}))}},h=class{constructor(e,t,s,i){this.page=e,this.limit=t,this.total=s,this.url=i,5===this.limit?this.pages=Math.ceil(this.total/this.limit):this.pages=1+Math.ceil((this.total-5)/this.limit),this.pagination=[],this.init()}init(){this.setPagination(),this.showPagination()}setPagination(){if(this.pages>1){if(1===this.page?(this.pagination.push({type:"first",active:!1,page:""}),this.pagination.push({type:"prev",active:!1,page:""})):(this.pagination.push({type:"first",active:!0,page:1}),this.pagination.push({type:"prev",active:!0,page:this.page-1})),this.pages<8)for(let e=1;e<=this.pages;e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e});if(this.pages>=8){if(this.page<5)for(let e=1;e<=5&&!(e>this.pages);e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e});if(this.page>=5&&(this.pagination.push({type:"page",active:!0,page:1}),this.pagination.push({type:"dots"})),this.page>=5&&this.page<this.pages-3)for(let e=this.page-1;e<=this.page+1;e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e});if(this.page<this.pages-3&&(this.pagination.push({type:"dots"}),this.pagination.push({type:"page",active:!0,page:this.pages})),this.page>=this.pages-3)for(let e=this.pages-4;e<=this.pages&&!(e>this.pages);e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e})}this.page<this.pages?(this.pagination.push({type:"next",active:!0,page:this.page+1}),this.pagination.push({type:"last",active:!0,page:this.pages})):(this.pagination.push({type:"next",active:!1,page:""}),this.pagination.push({type:"last",active:!1,page:""}))}else this.pagination.push({type:"first",active:!1,page:""}),this.pagination.push({type:"prev",active:!1,page:""}),this.pagination.push({type:"next",active:!1,page:""}),this.pagination.push({type:"last",active:!1,page:""})}showPagination(){const e=document.querySelector("#pagination"),t=this.createPagination();e.appendChild(t)}createPagination(){const e=document.createDocumentFragment();return this.pagination.forEach((t=>{const s=document.createElement("div");s.classList.add(t.type),s.classList.add(t.active?"active":"inactive"),e.appendChild(s);const i=document.createElement("a");1===t.page?i.href=`${this.url}`:i.href=`${this.url}/page/${t.page}`,s.appendChild(i),"first"===t.type&&i.appendChild(l.get("chevronDoubleLeft")),"prev"===t.type&&i.appendChild(l.get("chevronLeft")),"page"!==t.type&&"current"!==t.type||(i.textContent=t.page),"dots"===t.type&&i.appendChild(l.get("threeDots")),"next"===t.type&&i.appendChild(l.get("chevronRight")),"last"===t.type&&i.appendChild(l.get("chevronDoubleRight"))})),e}},p=e=>{const t=new Date(e);return new Intl.DateTimeFormat("es-ES",{dateStyle:"long"}).format(t)},u=e=>{const t="àáâäæãåāăąçćčđďèéêëēėęěğǵḧîïíīįìıİłḿñńǹňôöòóœøōõőṕŕřßśšşșťțûüùúūǘůűųẃẍÿýžźż·/_,:;",s=new RegExp(t.split("").join("|"),"g");return e.toString().toLowerCase().replace(/\s+/g,"-").replace(s,(e=>"aaaaaaaaaacccddeeeeeeeegghiiiiiiiilmnnnnoooooooooprrsssssttuuuuuuuuuwxyyzzz------".charAt(t.indexOf(e)))).replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},m=class{constructor({type:e,ariaLabel:t,buttonSize:s,svgSize:i,icon:a,callback:n}){this.type=e,this.ariaLabel=t,this.buttonSize=s,this.svgSize=i,this.icon=a,this.callback=n,this.init()}init(){this.iconButton=this.create()}get(){return this.iconButton}create(){const e=document.createElement("button");switch(e.type=this.type??"button",e.ariaLabel=this.ariaLabel??"",e.classList.add("mio-icon-btn"),this.buttonSize){case"small":e.classList.add("btn-size-small");break;case"medium":e.classList.add("btn-size-medium");break;case"large":e.classList.add("btn-size-large");break;case"xl":e.classList.add("btn-size-xl");break;default:e.classList.add("btn-medium-small")}switch(this.svgSize){case"xs":e.classList.add("svg-size-xs");break;case"small":e.classList.add("svg-size-small");break;case"medium":default:e.classList.add("svg-size-medium");break;case"large":e.classList.add("svg-size-large");break;case"xl":e.classList.add("svg-size-xl")}return e.addEventListener("click",this.callback),e.appendChild(this.icon),e}},g=class{constructor(e){this.columns=e.columns,this.customColumns=e.customColumns||[],this.rows=e.rows,this.copyRows=e.rows,this.findFields=e.findFields,this.container=e.container,this.visibleRows=e.visibleRows,this.rowsPerPage=e.rowsPerPage,this.update=e.update,this.delete=e.delete,this.deleteSelected=e.deleteSelected,this.showActionsMenu=e.showActionsMenu,this.extraActions=e.extraActions||[],this.extraActionsMultipleSelect=e.extraActionsMultipleSelect||[],this.selectedRows=[],this.sort=!1,this.sortColumn=null,this.page=1,this.pages=0,this.init()}init(){this.setPages(this.calculatePages()),this.createTable()}setRows(e){this.rows=e,this.destroy(),this.setPages(this.calculatePages()),this.createTable()}addRow(e){this.rows=[...this.rows,e],this.copyRows=[...this.copyRows,e],this.destroy(),this.setPages(this.calculatePages()),this.createTable()}updateRow(e){this.rows=this.rows.map((t=>t.id===e.id?e:t)),this.copyRows=this.copyRows.map((t=>t.id===e.id?e:t)),this.destroy(),this.setPages(this.calculatePages()),this.createTable()}deleteRow(e){this.rows=this.rows.filter((t=>t.id!==e.id)),this.copyRows=this.copyRows.filter((t=>t.id!==e.id)),this.clearSelectedRows(),this.setPages(this.calculatePages()),this.checkPage(),this.destroy(),this.createTable()}deleteRows(e){this.rows=this.rows.filter((t=>!e.some((e=>e.id===t.id)))),this.copyRows=this.copyRows.filter((t=>!e.some((e=>e.id===t.id)))),this.clearSelectedRows(),this.setPages(this.calculatePages()),this.checkPage(),this.destroy(),this.createTable()}searchRow(e){this.findFields?this.rows=this.copyRows.filter((t=>this.findFields.reduce(((e,s,i)=>i?e+" "+t[s]:t[s]),"").toLowerCase().includes(e.toLowerCase()))):this.rows=this.copyRows.filter((t=>Object.values(t).some((t=>t&&t.toString().toLowerCase().includes(e.toLowerCase()))))),this.clearSelectedRows(),this.setPages(this.calculatePages()),this.checkPage(),this.destroy(),this.createTable()}checkPage(){this.page>this.pages&&(this.page=this.pages)}setPages(e){this.pages=e}calculatePages(){return Math.ceil(this.rows.length/this.rowsPerPage)||1}clearSelectedRows(){this.selectedRows=[]}createTable(){this.table=document.createElement("div"),this.table.classList.add("table"),this.table.style.height=this.tableSizing().tableHeight+"px",this.container.appendChild(this.table);const e=document.createElement("div");e.style.height=this.tableSizing().wrapperHeight+"px",e.classList.add("wrapper"),this.table.appendChild(e);const t=document.createElement("table");e.appendChild(t);const s=this.createThead();t.appendChild(s);const i=this.createTbody();t.appendChild(i);const a=this.createFooter();this.table.appendChild(a)}tableSizing(){let e=0,t=0;return this.visibleRows>this.rowsPerPage&&(t=52*this.rowsPerPage+26+56,e=t+56),this.visibleRows<=this.rowsPerPage&&(t=52*this.visibleRows+26+56,e=t+56),{wrapperHeight:t,tableHeight:e}}createThead(){const e=document.createElement("thead"),t=document.createElement("tr");e.appendChild(t);const s=document.createElement("th");t.appendChild(s);const i=document.createElement("label");s.appendChild(i);const a=document.createElement("input");a.type="checkbox",this.selectedRows.length&&this.selectedRows.length===this.rows.length&&(a.checked=!0),a.addEventListener("change",this.handleCheckAll.bind(this)),i.appendChild(a),this.columns.forEach((e=>{const s=document.createElement("th");t.appendChild(s);const i=document.createElement("button");i.type="button",i.ariaLabel="Ordenar",i.addEventListener("click",this.handleSort.bind(this,e)),s.appendChild(i);const a=document.createElement("div");a.classList.add("name"),a.textContent=e.headerName,i.appendChild(a);const n=document.createElement("div");n.classList.add("sort","asc"),this.sortColumn===e&&this.sort&&(n.classList.remove("asc"),n.classList.add("asc")),this.sortColumn!==e||this.sort||(n.classList.remove("asc"),n.classList.add("desc")),i.appendChild(n);const o=l.get("arrowUpShort");n.appendChild(o)})),this.customColumns.forEach((e=>{const s=document.createElement("th");t.appendChild(s);const i=document.createElement("button");i.type="button",i.ariaLabel="Ordenar",i.addEventListener("click",this.handleSort.bind(this,e)),s.appendChild(i);const a=document.createElement("div");a.classList.add("name"),a.textContent=e.headerName,i.appendChild(a);const n=document.createElement("div");n.classList.add("sort","asc"),this.sortColumn===e&&this.sort&&(n.classList.remove("asc"),n.classList.add("asc")),this.sortColumn!==e||this.sort||(n.classList.remove("asc"),n.classList.add("desc")),i.appendChild(n);const o=l.get("arrowUpShort");n.appendChild(o)}));const n=document.createElement("th");return n.textContent="Acciones",t.appendChild(n),e}createTbody(){const e=document.createElement("tbody");return this.rows.forEach(((t,s)=>{if(s<this.rowsPerPage*(this.page-1)||s>=this.rowsPerPage*this.page)return;const i=document.createElement("tr"),a=this.selectedRows.some((e=>e===t));a&&i.classList.add("selected"),i.addEventListener("click",this.handleRowClick.bind(this,t)),e.appendChild(i);const n=document.createElement("td");i.appendChild(n);const o=document.createElement("label");n.appendChild(o);const r=document.createElement("input");r.type="checkbox",a&&(r.checked=!0),r.addEventListener("change",this.handleCheck.bind(this,t)),r.addEventListener("click",(e=>e.stopPropagation())),o.appendChild(r),this.columns.forEach((e=>{const s=document.createElement("td");s.textContent=t[e.field],i.appendChild(s)})),this.customColumns.forEach((e=>{const s=document.createElement("td");i.appendChild(s);const a=e.content(t);s.appendChild(a)}));const c=document.createElement("td");c.classList.add("actions"),i.appendChild(c);const d=document.createElement("div");if(c.appendChild(d),this.showActionsMenu){const e=new m({ariaLabel:"Menu Acciones",buttonSize:"medium",svgSize:"medium",icon:l.get("threeDotsVertical"),callback:e=>{e.stopPropagation()}});d.appendChild(e.get());let s=[];this.extraActions.forEach((e=>{s.push({type:"button",text:e.name,ariaLabel:e.name,icon:e.icon,onClick:()=>e.callback(t)})})),new class{constructor(e){Object.assign(this,e),this.isOpen=!1,this.isClose=!1,this.init()}init(){window.addEventListener("resize",(()=>{this.isOpen&&this.position()})),window.addEventListener("scroll",(()=>{this.isOpen&&this.position()})),this.target.addEventListener("click",(()=>{this.isOpen?this.close():this.open()}))}open(){this.isOpen=!0,this.create(),document.body.appendChild(this.menu),this.position(),this.menu.classList.add("in")}async close(){this.isOpen=!1,this.menu.classList.add("out"),await this.animationend(this.menu),this.menu.remove()}create(){this.menu=document.createElement("div"),this.menu.classList.add("mio-menu"),this.menu.addEventListener("mousedown",this.handleClose.bind(this)),this.menu.addEventListener("touchstart",this.handleClose.bind(this),{passive:!0}),this.menu.addEventListener("click",(()=>{this.isClose&&this.close()}));const e=document.createElement("div");e.classList.add("content"),e.addEventListener("click",(e=>e.stopPropagation())),this.menu.appendChild(e),this.items.forEach((t=>{if("button"===t.type){const s=document.createElement("button");s.type="button",s.ariaLabel=t.ariaLabel,s.classList.add("item"),s.addEventListener("click",(e=>{t.onClick(e),this.close()})),e.appendChild(s),t.icon&&s.appendChild(t.icon);const i=document.createElement("span");i.textContent=t.text,s.appendChild(i)}t.type}))}position(){const e=this.target.getBoundingClientRect();e.top+this.menu.firstChild.offsetHeight+this.target.offsetHeight>window.innerHeight?this.menu.firstChild.style.top=e.top-this.menu.firstChild.offsetHeight+"px":this.menu.firstChild.style.top=`${e.top+this.target.offsetHeight}px`,this.menu.firstChild.style.left=`${e.left-this.menu.firstChild.offsetWidth+this.target.offsetWidth}px`}handleClose(e){e.target===this.menu&&(this.isClose=!0)}async animationend(e){return new Promise((t=>{e.addEventListener("animationend",t,{once:!0})}))}}({target:e.get(),items:[{type:"button",text:"Editar",ariaLabel:"Editar",icon:l.get("pencilSquare"),onClick:this.handleUpdate.bind(this,t)},{type:"button",text:"Eliminar",ariaLabel:"Editar",icon:l.get("trash"),onClick:this.handleDelete.bind(this,t)},...s]})}else{const e=new m({ariaLabel:"Editar",buttonSize:"medium",svgSize:"medium",icon:l.get("pencilSquare"),callback:this.handleUpdate.bind(this,t)});d.appendChild(e.get());const s=new m({ariaLabel:"Eliminar",buttonSize:"medium",svgSize:"medium",icon:l.get("trash"),callback:this.handleDelete.bind(this,t)});d.appendChild(s.get()),this.extraActions.forEach((e=>{const s=new m({ariaLabel:e.ariaLabel,buttonSize:"medium",svgSize:"medium",icon:e.icon.cloneNode(!0),callback:s=>{s.stopPropagation(),e.callback(t)}});d.appendChild(s.get())}))}})),e}createFooter(){const e=document.createElement("div");e.classList.add("footer");const t=document.createElement("div");t.classList.add("col-left"),e.appendChild(t);const s=document.createElement("div");if(s.classList.add("selected-rows"),this.selectedRows.length&&1===this.selectedRows.length&&(s.textContent="1 fila seleccionada"),this.selectedRows.length&&this.selectedRows.length>1&&(s.textContent=this.selectedRows.length+" filas seleccionadas"),t.appendChild(s),this.selectedRows.length){const e=document.createElement("button");e.type="button",e.ariaLabel="Eliminar seleccionadas",e.addEventListener("click",this.handleDeleteSelected.bind(this)),t.appendChild(e);const s=l.get("trash");e.appendChild(s),this.extraActionsMultipleSelect.forEach((e=>{const s=document.createElement("button");s.type="button",s.ariaLabel=e.name,s.addEventListener("click",e.callback.bind(this,this.selectedRows)),t.appendChild(s),s.appendChild(e.icon)}))}const i=document.createElement("div");i.classList.add("col-right"),e.appendChild(i);const a=document.createElement("div");a.classList.add("rows");let n="";this.rows.length?n+=(this.page-1)*this.rowsPerPage+1+"-":n+="0-",this.page*this.rowsPerPage>this.rows.length?n+=this.rows.length+" de "+this.rows.length:n+=this.page*this.rowsPerPage+" de "+this.rows.length,a.textContent=n,i.appendChild(a);const o=document.createElement("div");o.classList.add("pagination"),i.appendChild(o);const r=document.createElement("button");r.type="button",r.ariaLabel="Anterior",this.page<=1&&(r.disabled=!0),r.addEventListener("click",this.handlePrev.bind(this)),o.appendChild(r);const c=l.get("chevronLeft");r.appendChild(c);const d=document.createElement("button");d.type="button",d.ariaLabel="Siguiente",this.page>=this.pages&&(d.disabled=!0),d.addEventListener("click",this.handleNext.bind(this)),o.appendChild(d);const h=l.get("chevronRight");return d.appendChild(h),e}handleCheckAll(e){const t=e.currentTarget.checked;this.table.querySelectorAll("tbody tr").forEach((e=>{e.querySelector("input[type=checkbox]").checked=t,t?e.classList.add("selected"):e.classList.remove("selected")})),this.selectedRows=t?this.rows:[],this.destroy(),this.createTable()}handleSort(e,t){t.currentTarget,this.sortColumn===e?this.sort=!this.sort:(this.sort=!0,this.sortColumn=e),this.rows.sort(((t,s)=>{const i=t[e.field],a=s[e.field];return this.sort?i>a?1:-1:i<a?1:-1})),this.destroy(),this.createTable()}handleCheck(e,t){const s=t.currentTarget,i=s.checked;s.parentNode.parentNode.parentNode.classList.toggle("selected"),this.selectedRows=i?[...this.selectedRows,e]:this.selectedRows.filter((t=>t!==e)),this.destroy(),this.createTable()}handleRowClick(e,t){const s=t.currentTarget;s.classList.toggle("selected");const i=s.querySelector("input[type=checkbox]");i.checked=!i.checked,i.checked?this.selectedRows=[...this.selectedRows,e]:this.selectedRows=this.selectedRows.filter((t=>t!==e)),this.destroy(),this.createTable()}handleUpdate(e,t){t.stopPropagation(),this.update(e)}handleDelete(e,t){t.stopPropagation(),this.delete(e)}handleDeleteSelected(e){e.stopPropagation(),this.deleteSelected(this.selectedRows)}handlePrev(){this.page--,this.destroy(),this.createTable()}handleNext(){this.page++,this.destroy(),this.createTable()}repaint(e){this.rows=e,this.copyRows=e,this.destroy(),this.createTable()}destroy(){this.table.remove()}},b=class{constructor({title:e,customTitle:t,content:s,action:i,maxWidth:a,fullscreenButton:n,actionCallback:o,closeCallback:r,fullscreenCallback:c,customHeaderButtons:l}){this.title=e,this.customTitle=t,this.content=s,this.action=i,this.maxWidth=a||null,this.fullscreenButton=n||!1,this.actionCallback=o,this.closeCallback=r,this.fullscreenCallback=c,this.customHeaderButtons=l||[],this.isClose=!1,this.isFullscreen=!1,this.init()}async init(){this.modal=this.create(),document.body.classList.add("noscroll"),document.body.appendChild(this.modal),this.modal.classList.add("fade-in"),this.modal.firstChild.classList.add("slide-in-top"),await this.animationend()}handleClose(e){e.target===this.modal&&(this.isClose=!0)}async close(){this.actionButton.stop(),this.modal.classList.add("fade-out"),this.modal.firstChild.classList.add("slide-out-top"),await this.animationend(this.modal),this.modal.remove(),document.querySelector(".modal")||document.body.classList.remove("noscroll"),this.closeCallback&&this.closeCallback()}async animationend(){return new Promise((e=>{this.modal.addEventListener("animationend",e,{once:!0})}))}create(){const e=document.createElement("div");e.classList.add("modal"),this.isFullscreen&&e.classList.add("fullscreen"),e.addEventListener("mousedown",this.handleClose.bind(this)),e.addEventListener("touchstart",this.handleClose.bind(this),{passive:!0}),e.addEventListener("click",(()=>{this.isClose&&this.close()}));const t=document.createElement("div");t.classList.add("content"),this.isFullscreen||(t.style.maxWidth=this.maxWidth?this.maxWidth:""),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t);const s=document.createElement("div");if(s.classList.add("header"),t.appendChild(s),this.customTitle)s.appendChild(this.customTitle());else{const e=document.createElement("div");e.classList.add("title"),e.textContent=this.title,s.appendChild(e)}const i=document.createElement("div");if(i.classList.add("actions"),s.appendChild(i),this.customHeaderButtons.forEach((e=>{const t=document.createElement("button");t.setAttribute("aria-label",e.ariaLabel),t.addEventListener("click",(()=>{e.callback()})),i.appendChild(t),t.appendChild(e.icon)})),this.fullscreenButton){const s=document.createElement("button");s.classList.add("fullscreen"),s.setAttribute("aria-label","Pantalla completa"),s.addEventListener("click",(()=>{this.isFullscreen=!this.isFullscreen,this.isFullscreen?(e.classList.add("fullscreen"),t.removeAttribute("style")):(e.classList.remove("fullscreen"),t.style.maxWidth=this.maxWidth?this.maxWidth:""),this.fullscreenCallback&&this.fullscreenCallback()})),i.appendChild(s);const a=l.get("arrowsFullscreen");s.appendChild(a)}const a=document.createElement("button");a.classList.add("close"),a.setAttribute("aria-label","Cerrar modal"),a.addEventListener("click",(()=>{this.isClose=!0,this.close()})),i.appendChild(a);const n=l.get("xLg");a.appendChild(n);const o=document.createElementNS("http://www.w3.org/2000/svg","svg");o.setAttribute("width","16"),o.setAttribute("height","16"),o.setAttribute("fill","currentColor"),o.setAttribute("viewBox","0 0 16 16"),n.appendChild(o);const r=document.createElementNS("http://www.w3.org/2000/svg","path");r.setAttribute("fill-rule","evenodd"),r.setAttribute("d","M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z"),o.appendChild(r);const d=document.createElementNS("http://www.w3.org/2000/svg","path");d.setAttribute("fill-rule","evenodd"),d.setAttribute("d","M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0Z"),o.appendChild(d),this.body=document.createElement("div"),this.body.classList.add("body"),this.body.appendChild(this.content),t.appendChild(this.body);const h=document.createElement("div");h.classList.add("footer"),t.appendChild(h);const p=document.createElement("button");return p.classList.add("btn","tertiary-btn"),p.setAttribute("aria-label","Cerrar modal"),p.textContent="Cerrar",p.addEventListener("click",(()=>{this.isClose=!0,this.close()})),h.appendChild(p),this.actionButton=new c({type:"button",text:this.action,ariaLabel:"Acción modal",classes:["btn","primary-btn"],onClick:this.actionCallback}),h.appendChild(this.actionButton.get()),e}repaint(e){this.content=e,this.modal.remove(),this.modal=this.create(),document.body.appendChild(this.modal)}};class v{constructor(e,t){this.loader=e,this.url=`/api/editor/${t}/upload/image`}upload(){return this.loader.file.then((e=>new Promise(((t,s)=>{this._initRequest(),this._initListeners(t,s,e),this._sendRequest(e)}))))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}_initListeners(e,t,s){const i=this.xhr,a=this.loader,n=`No se ha podido subir la imagen: ${s.name}.`;i.addEventListener("error",(()=>t(n))),i.addEventListener("abort",(()=>t())),i.addEventListener("load",(()=>{const s=i.response;if(!s||"error"===s.response)return t(s&&"error"===s.response?s.response.msg:n);e({default:s.url})})),i.upload&&i.upload.addEventListener("progress",(e=>{e.lengthComputable&&(a.uploadTotal=e.total,a.uploaded=e.loaded)}))}_sendRequest(e){const t=new FormData;t.append("image",e),t.append("action","uploadImage"),this.xhr.send(t)}}function w(e){e.plugins.get("FileRepository").createUploadAdapter=e=>new v(e,"blog")}function C(e){e.plugins.get("FileRepository").createUploadAdapter=e=>new v(e,"cases")}const f=class extends a{constructor(e){super(e),Object.assign(this,e),this.activeOptions=!1,this.findText="",this.timeout=null,this.activeIndex=0,this.selectedIndex=0,this.init()}init(){window.addEventListener("resize",this.handleResize.bind(this)),window.addEventListener("scroll",this.handleResize.bind(this)),this.create()}handleResize(){this.customOptions&&this.position()}create(){this.field=this.createField();const e=this.createWrapper();if(this.field.appendChild(e),this.customSelect=this.createCustomSelect(),e.appendChild(this.customSelect),this.labelEl=this.createLabel(),e.appendChild(this.labelEl),this.selectEl=this.createSelect(),e.appendChild(this.selectEl),this.optionsEl=this.createOptions(),this.selectEl.appendChild(this.optionsEl),this.message){const e=this.createMessage();this.field.appendChild(e)}}createField(){const e=document.createElement("div");return e.classList.add("mio-field"),this.selected&&e.classList.add("active"),this.error&&e.classList.add("error"),e}createCustomSelect(){const e=document.createElement("div");e.classList.add("mio-input"),e.addEventListener("click",this.open.bind(this));const t=document.createElement("span");t.textContent="​",e.appendChild(t);const s=this.createAdornment();return e.appendChild(s),e}createAdornment(){const e=document.createElement("div");e.classList.add("mio-adornment");const t=new m({type:"button",ariaLabel:"Button icon",buttonSize:"medium",svgSize:"xs",icon:this.createCaretDownFillIcon(),callback:e=>{e.stopPropagation(),this.open()}});return e.appendChild(t.get()),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-label"),e.textContent=this.label.text,e.htmlFor=this.label.for,e.addEventListener("click",this.open.bind(this)),e}createSelect(){const e=document.createElement("select");return e.name=this.select.name,e.id=this.select.id,e.addEventListener("focus",this.focusSelect.bind(this)),e.addEventListener("keydown",this.handleKeydown.bind(this)),e.addEventListener("change",this.handleInput.bind(this)),e}createOptions(){const e=document.createDocumentFragment(),t=new Option;return e.appendChild(t),this.options.forEach(((t,s)=>{const i=new Option(t[this.option.text],t[this.option.value]);this.selected&&this.selected[this.option.value].toString()===t[this.option.value].toString()&&(i.selected=!0,this.field.classList.add("active"),this.selectOption(t,s),this.selectEl.dispatchEvent(new Event("change"))),e.appendChild(i)})),e}focusSelect(){this.selectEl.focus(),this.field.classList.add("active"),this.field.classList.add("focus")}blurSelect(){this.selectEl.blur(),this.selectedOption||this.field.classList.remove("active"),this.field.classList.remove("focus")}handleKeydown(e){switch(e.key){case"Tab":this.blurSelect(),this.closeCustomOptions();break;case"ArrowDown":this.activeOptions?(this.blurOption(),this.activeIndex=(this.activeIndex+1)%this.optionsNodes.childNodes.length,this.focusOption()):this.open();break;case"ArrowUp":this.activeOptions&&(this.blurOption(),this.activeIndex=(this.optionsNodes.childNodes.length+(this.activeIndex-1))%this.optionsNodes.childNodes.length,this.focusOption());break;case"Enter":this.activeOptions?(this.selectOption(this.options[this.activeIndex],this.activeIndex),this.selectEl.dispatchEvent(new Event("change")),this.onSelect(this.options[this.activeIndex]),this.closeCustomOptions()):this.open();break;default:this.findOption(e.key)}}async open(){this.activeOptions=!0,this.focusSelect(),this.customOptions=this.createCustomOptions(),document.body.appendChild(this.customOptions),this.position(),this.focusOption(),this.customOptions.classList.add("in")}async closeCustomOptions(){this.activeOptions=!1,this.activeIndex=this.selectedIndex,this.blurSelect(),this.customOptions.classList.add("out"),this.customOptions.remove()}createCustomOptions(){const e=document.createElement("div");e.classList.add("mio-options"),e.addEventListener("click",this.closeCustomOptions.bind(this));const t=document.createElement("div");return t.classList.add("content"),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t),this.optionsNodes=t,this.options.forEach(((e,s)=>{const i=document.createElement("div");i.classList.add("option"),e===this.selectedOption&&i.classList.add("selected"),s===this.activeIndex&&i.classList.add("focus"),i.addEventListener("click",(()=>{this.selectOption(e,s),this.selectEl.dispatchEvent(new Event("change")),this.onSelect(e),this.closeCustomOptions()})),t.appendChild(i);const a=document.createElement("span");a.textContent=e[this.option.text],i.appendChild(a)})),e}position(){const e=this.field.getBoundingClientRect();this.customOptions.firstChild.style.maxHeight="210px",e.top+this.customOptions.firstChild.offsetHeight+this.field.offsetHeight+2>window.innerHeight?this.customOptions.firstChild.style.top=e.top-this.customOptions.firstChild.offsetHeight-2+"px":this.customOptions.firstChild.style.top=`${e.top+this.field.offsetHeight+2}px`,this.customOptions.firstChild.style.left=`${e.left}px`,this.customOptions.firstChild.style.width=`${this.field.offsetWidth}px`}focusOption(){this.optionsNodes.childNodes[this.activeIndex].scrollIntoView(!1),this.optionsNodes.childNodes[this.activeIndex].classList.add("focus")}blurOption(){this.optionsNodes.childNodes[this.activeIndex].classList.remove("focus")}selectOption(e,t){this.selectedOption=e,this.activeIndex=t,this.selectedIndex=t,this.selectEl.value=e[this.option.value],this.customSelect.firstElementChild.textContent=e[this.option.text]}findOption(e){this.findText+=e,clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.findText=""),500),this.options.forEach(((e,t)=>{const s=e[this.option.text].toLowerCase(),i=this.findText.toLowerCase();if(s.includes(i))return this.selectEl.options[t].selected=!0,this.blurOption(),this.selectOption(e,t),this.selectEl.dispatchEvent(new Event("change")),this.onSelect(e),void this.focusOption()}))}async animationend(e){return new Promise((t=>{e.addEventListener("animationend",t,{once:!0})}))}createCaretDownFillIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"),e.appendChild(t),e}},E=class{constructor(e){Object.assign(this,e),this.init()}init(){this.field=this.create()}getField(){return this.field}getInput(){return this.inputEl}getLabel(){return this.labelEl}getSrc(){const e=this.inputEl.files[0];return this.src=URL.createObjectURL(e),this.src}create(){const e=document.createElement("div");e.classList.add("field","file"),this.error&&e.classList.add("error"),this.labelEl=document.createElement("label"),this.labelEl.htmlFor=this.label.for,e.appendChild(this.labelEl);const t=this.createIcon();this.labelEl.appendChild(t);const s=document.createElement("span");return s.textContent="Selecciona una imagen...",this.labelEl.appendChild(s),this.inputEl=document.createElement("input"),this.inputEl.type="file",this.inputEl.id=this.input.id,this.inputEl.name=this.input.name,this.inputEl.accept=this.input.accept,this.inputEl.addEventListener("change",(()=>{this.error&&(e.classList.remove("error"),this.errorEl.remove()),this.callback(this.getSrc())})),e.appendChild(this.inputEl),this.error&&(this.errorEl=document.createElement("p"),this.errorEl.classList.add("error-message"),this.errorEl.textContent=this.error,e.appendChild(this.errorEl)),e}createIcon(){const e=document.createElement("figure"),t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("width","20"),t.setAttribute("height","17"),t.setAttribute("fill","currentColor"),t.setAttribute("viewBox","0 0 20 17"),e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d","M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"),t.appendChild(s),e}},y=class{constructor(e,t,s){this.target=e,this.before=t,this.after=s,this.isStart=!1,this.isMove=!1,this.isOut=!1,this.initialPosX=0,this.currentPosX=0,this.finalPosX=0,this.moveX=0,this.init()}async init(){document.addEventListener("mouseup",this.end.bind(this)),document.addEventListener("touchend",this.end.bind(this)),this.target.appendChild(this.create())}handleClick(e){const t=e.currentTarget.getBoundingClientRect();this.currentPosX=e.clientX??e.touches[0].clientX;const s=t.left,i=this.currentPosX-s,a=this.beforeAndAfter.offsetWidth,n=a/2-i,o=(50*a-100*n)/a;this.before.style.clipPath=`polygon(0 0, ${o}% 0, ${o}% 100%, 0 100%)`,this.after.style.clipPath=`polygon(${o}% 0, 100% 0, 100% 100%, ${o}% 100%)`,this.handle.style.left=`${o}%`,this.finalPosX=n}start(e){this.isStart=!0,this.disableTransition(),this.initialPosX=e.clientX??e.touches[0].clientX,this.moveListener=this.move.bind(this),this.endListener=this.end.bind(this),document.addEventListener("mousemove",this.moveListener),document.addEventListener("touchmove",this.moveListener),document.addEventListener("mouseup",this.endListener),document.addEventListener("touchend",this.endListener)}move(e){if(!this.isStart)return;this.isMove=!0,this.currentPosX=e.clientX??e.touches[0].clientX,this.moveX=this.finalPosX+this.initialPosX-this.currentPosX;const t=this.beforeAndAfter.offsetWidth,s=(50*t-100*this.moveX)/t;return s<0?(this.moveX=t/2,this.before.style.clipPath="polygon(0 0, 0 0, 0 100%, 0 100%)",this.after.style.clipPath="polygon(0 0, 100% 0, 100% 100%, 0 100%)",void(this.handle.style.left="0")):s>100?(this.moveX=-t/2,this.before.style.clipPath="polygon(0 0, 100% 0, 100% 100%, 0 100%)",this.after.style.clipPath="polygon(100% 0, 100% 0, 100% 100%, 100% 100%)",void(this.handle.style.left="100%")):(this.before.style.clipPath=`polygon(0 0, ${s}% 0, ${s}% 100%, 0 100%)`,this.after.style.clipPath=`polygon(${s}% 0, 100% 0, 100% 100%, ${s}% 100%)`,void(this.handle.style.left=`${s}%`))}end(){this.isStart&&(this.finalPosX=this.moveX,this.isStart=!1,this.isMove=!1,this.enableTransition(),document.removeEventListener("mousemove",this.moveListener),document.removeEventListener("touchmove",this.moveListener),document.removeEventListener("mouseup",this.endListener),document.removeEventListener("touchend",this.endListener))}out(){this.isStart&&(this.isOut=!0)}create(){this.beforeAndAfter=document.createElement("div"),this.beforeAndAfter.classList.add("before-and-after"),this.before.style.clipPath="polygon(0 0, 50% 0, 50% 100%, 0 100%)",this.before.classList.add("before"),this.beforeAndAfter.appendChild(this.before),this.after.style.clipPath="polygon(50% 0, 100% 0, 100% 100%, 50% 100%)",this.after.classList.add("after"),this.beforeAndAfter.appendChild(this.after);const e=document.createElement("div");e.classList.add("overlay"),e.addEventListener("click",this.handleClick.bind(this)),this.beforeAndAfter.appendChild(e),this.handle=document.createElement("div"),this.handle.classList.add("handle"),this.handle.style.left="50%",this.handle.addEventListener("mousedown",this.start.bind(this)),this.handle.addEventListener("touchstart",this.start.bind(this),{passive:!0}),this.handle.addEventListener("mouseout",this.out.bind(this)),this.beforeAndAfter.appendChild(this.handle);const t=document.createElement("div");t.classList.add("circle"),this.handle.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("width","16"),s.setAttribute("height","16"),s.setAttribute("fill","currentColor"),s.setAttribute("viewBox","0 0 16 16"),t.appendChild(s);const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"),s.appendChild(i);const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("width","16"),a.setAttribute("height","16"),a.setAttribute("fill","currentColor"),a.setAttribute("viewBox","0 0 16 16"),t.appendChild(a);const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"),a.appendChild(n),this.beforeAndAfter}enableTransition(){this.before.classList.remove("notransition"),this.after.classList.remove("notransition"),this.handle.classList.remove("notransition")}disableTransition(){this.before.classList.add("notransition"),this.after.classList.add("notransition"),this.handle.classList.add("notransition")}destroy(){this.beforeAndAfter.remove()}},L=class{constructor(e){Object.assign(this,e),this.drawing=!1,this.cp=null,this.base64="",this.blob=null,this.init()}init(){window.addEventListener("resize",this.resize.bind(this));const e=document.createElement("div");if(e.classList.add("signature"),this.container.appendChild(e),this.title){const t=document.createElement("p");t.classList.add("title"),t.textContent=this.title,e.appendChild(t)}if(this.canvas=document.createElement("canvas"),this.canvas.addEventListener("mousedown",this.start.bind(this)),this.canvas.addEventListener("touchstart",this.start.bind(this),{passive:!0}),this.canvas.addEventListener("mousemove",this.move.bind(this)),this.canvas.addEventListener("touchmove",this.move.bind(this),{passive:!1}),this.canvas.addEventListener("mouseup",this.end.bind(this)),this.canvas.addEventListener("touchend",this.end.bind(this)),document.body.addEventListener("mouseup",this.end.bind(this)),document.body.addEventListener("touchend",this.end.bind(this)),e.appendChild(this.canvas),new MutationObserver((async()=>{if(this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight,this.signature){const e=await this.createImage(this.signature);this.ctx.drawImage(e,0,0,this.canvas.width,this.canvas.height)}})).observe(e,{childList:!0}),this.ctx=this.canvas.getContext("2d"),this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height),this.clear){const t=document.createElement("button");t.classList.add("clear"),t.type="button",t.addEventListener("click",(()=>{this.ctx.fillStyle="#ffffff",this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height),this.ctx.fillRect(0,0,this.canvas.width,this.canvas.height)})),e.appendChild(t);const s=l.get("eraserFill");t.appendChild(s)}}start(e){this.drawing=!0;const{x:t,y:s}=this.getCursorPosition(e);this.ctx.beginPath(),this.ctx.moveTo(t,s),this.ctx.lineWidth=2,this.ctx.strokeStyle="#32539a",this.ctx.lineJoin="round",this.ctx.lineCap="round",this.cp={x:t,y:s},this.draw(t,s)}move(e){if(e.preventDefault(),!this.drawing)return;const{x:t,y:s}=this.getCursorPosition(e);this.draw(t,s)}end(){this.drawing=!1}getCursorPosition(e){const t=this.canvas.getBoundingClientRect();return{x:(e.clientX??e.touches[0].clientX)-t.left,y:(e.clientY??e.touches[0].clientY)-t.top}}draw(e,t){const s=this.cp.x,i=this.cp.y,a=(this.cp.x+e)/2,n=(this.cp.y+t)/2;this.ctx.quadraticCurveTo(s,i,a,n),this.ctx.stroke(),this.ctx.beginPath(),this.ctx.moveTo(a,n),this.cp={x:a,y:n}}resize(){this.canvas.width=this.canvas.offsetWidth,this.canvas.height=this.canvas.offsetHeight}base64toBlob(e,t="",s=512){const i=atob(e),a=[];for(let e=0,t=i.length;e<t;e+=s){const t=i.slice(e,e+s),n=new Array(t.length);for(let e=0;e<t.length;e++)n[e]=t.charCodeAt(e);const o=new Uint8Array(n);a.push(o)}return new Blob(a,{type:t})}blobToImage(e){const t=URL.createObjectURL(e),s=new Image;return s.src=t,s}getBase64(){return this.canvas.toDataURL("image/png")}getBlob(){return this.canvas.toDataURL("image/png"),this.base64toBlob(this.base64.split(",")[1],"image/png")}createImage(e,t=""){return new Promise(((s,i)=>{const a=new Image;a.src=e,a.alt=t,a.addEventListener("load",(()=>s(a))),a.addEventListener("error",(()=>i(new Error("Error loading image"))))}))}},x=class extends a{constructor(e){super(e),Object.assign(this,e),this.init()}init(){this.field=this.create()}create(){const e=this.createField(),t=this.createWrapper();e.appendChild(t),this.switch=this.createSwitch(),t.appendChild(this.switch);const s=this.createLabel();if(t.appendChild(s),this.message){const t=this.createMessage();e.appendChild(t)}return e}createSwitch(){const e=document.createElement("input");return e.classList.add("mio-switch-input"),e.type="checkbox",e.name=this.input.name,e.id=this.input.id,this.input.value&&(e.checked=!0),e.addEventListener("change",(()=>{this.removeMessage(),this.callback(e.checked)})),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-switch-label",this.size),e.textContent=this.label.text,e.htmlFor=this.label.for,e.addEventListener("click",(async t=>{t.preventDefault(),t.stopPropagation(),this.switch.checked=!this.switch.checked,await this.transitionend(e),this.switch.dispatchEvent(new Event("change"))})),e}async transitionend(e){return new Promise((t=>{e.addEventListener("transitionend",t,{once:!0})}))}},S=class{constructor(e){this.target=e.target,this.data=e.data,this.findFields=e.findFields,this.showFields=e.showFields,this.size=e.size,this.callback=e.callback,this.filteredData=[],this.autocomplete=null,this.search="",this.isSelect=!1,this.isClose=!1,this.init()}init(){window.addEventListener("resize",this.position.bind(this)),this.target.addEventListener("keyup",this.handleKeyup.bind(this))}getShowFields(){return this.showFields.reduce(((e,t,s)=>s?e+" "+row[t]:row[t]),"")}handleKeyup(e){this.search=e.target.value,this.autocomplete&&this.autocomplete.remove(),this.filterData(),0!==this.filteredData.length&&(this.show(),this.position())}filterData(){let e=0;this.filteredData=this.data.filter((t=>!(e>20)&&(!!this.findFields.reduce(((e,s,i)=>i?e+" "+t[s]:t[s]),"").toLowerCase().includes(this.search.toLowerCase())&&(e++,!0))))}show(){this.autocomplete=this.create(),document.body.appendChild(this.autocomplete)}create(){const e=document.createElement("div");e.classList.add("autocomplete"),e.addEventListener("mousedown",this.handleClose.bind(this)),e.addEventListener("touchstart",this.handleClose.bind(this),{passive:!0}),e.addEventListener("click",(()=>{this.isClose&&this.close()}));const t=document.createElement("div");return t.classList.add("content"),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t),this.filteredData.forEach(((e,s)=>{const i=document.createElement("div");i.addEventListener("click",this.handleSelect.bind(this,e)),i.classList.add("item");const a=document.createElement("div");a.classList.add("search-icon"),i.appendChild(a);const n=this.createSearchIcon();a.appendChild(n);const o=document.createElement("span"),r=this.showFields.reduce(((t,s,i)=>i?t+" "+e[s]:e[s]),"");o.innerHTML=this.boldString(r,this.search),i.appendChild(o);const c=document.createElement("div");c.classList.add("arrow-icon"),i.appendChild(c);const l=this.createArrowIcon();c.appendChild(l),t.appendChild(i)})),e}handleSelect(e){this.isSelect=!0;const t=this.showFields.reduce(((t,s,i)=>i?t+" "+e[s]:e[s]),"");this.target.value=t,this.callback(e),this.close()}handleClose(e){e.target===this.autocomplete&&(this.isClose=!0)}position(){if(!this.autocomplete)return;const e=this.target.getBoundingClientRect();this.autocomplete.firstChild.style.maxWidth=`${this.target.offsetWidth}px`,window.innerWidth<768?this.autocomplete.firstChild.style.maxHeight=44*this.size+20+"px":window.innerWidth>=768&&window.innerWidth<1024?this.autocomplete.firstChild.style.maxHeight=46*this.size+20+"px":this.autocomplete.firstChild.style.maxHeight=48*this.size+20+"px",e.top+this.autocomplete.firstChild.offsetHeight+this.target.offsetHeight+2>window.innerHeight?this.autocomplete.firstChild.style.top=e.top-this.autocomplete.firstChild.offsetHeight-2+"px":this.autocomplete.firstChild.style.top=`${e.top+this.target.offsetHeight+2}px`,this.autocomplete.firstChild.style.left=`${e.left}px`}boldString(e,t){const s=e.toLowerCase().indexOf(t.toLowerCase());return-1===s?e:e.substring(0,s)+"<b>"+e.substring(s,s+t.length)+"</b>"+e.substring(s+t.length)}close(){this.isSelect||(this.target.value="",this.callback(null)),this.isSelect=!1,this.isClose=!1,this.autocomplete.remove()}createSearchIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 24 24");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M21.71,20.29,18,16.61A9,9,0,1,0,16.61,18l3.68,3.68a1,1,0,0,0,1.42,0A1,1,0,0,0,21.71,20.29ZM11,18a7,7,0,1,1,7-7A7,7,0,0,1,11,18Z"),e.appendChild(t),e}createArrowIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"),e.appendChild(t),e}},k=class{constructor({budgeteds:e,callback:t}){this.budgeteds=e,this.callback=t,this.treatments=[],this.total=0,this.errors=[],this.id=1,this.targetFocus="",this.columns=[{field:"treatment_id",headerName:"Tratamiento"},{field:"piece",headerName:"Pieza"},{field:"unit_price",headerName:"Precio"},{field:"discount",headerName:"Dto."},{field:"total_price",headerName:"Total"}]}getBudgeteds(){return this.budgeteds}addBudgeted(e){this.budgeteds=[...this.budgeteds,e]}updateBudgeted(e){this.budgeteds=this.budgeteds.map((t=>t.id===e.id?e:t))}deleteBudgeted(e){this.budgeteds=this.budgeteds.filter((t=>t.id!==e.id))}clearBudgeteds(){this.budgeteds=[]}getBudgetedsEl(){return this.budgetedsEl}async readAllTreatments(){const e=await F.get("/api/admin/treatments");"error"!==e.status&&(this.treatments=e.treatments)}show(){this.budgetedsEl=document.createElement("div"),this.budgetedsEl.classList.add("budgeted");const e=document.createElement("div");e.classList.add("wrapper"),this.budgetedsEl.appendChild(e);const t=this.createTable();e.appendChild(t);const s=this.createAddRow();this.budgetedsEl.appendChild(s)}repaint(){this.show()}createTable(){const e=document.createElement("table"),t=this.createThead();e.appendChild(t),this.tbody=this.createTbody(),e.appendChild(this.tbody);const s=this.createTfoot();return e.appendChild(s),e}createThead(){const e=document.createElement("thead"),t=document.createElement("tr");e.appendChild(t),this.columns.forEach((e=>{const s=document.createElement("th");s.textContent=e.headerName,t.appendChild(s)}));const s=document.createElement("th");return s.textContent="",t.appendChild(s),e}createTbody(){const e=document.createElement("tbody");return this.budgeteds.forEach((t=>{const s=this.createRow(t);e.appendChild(s)})),e}createTfoot(){const e=document.createElement("tfoot"),t=document.createElement("tr");e.appendChild(t);const s=document.createElement("td");s.colSpan=this.columns.length-1,s.textContent="Total",t.appendChild(s);const i=document.createElement("td");return i.textContent=this.getTotal().toFixed(2).replace(".",","),t.appendChild(i),e}createRow(e){const t=document.createElement("tr"),s=document.createElement("td");t.appendChild(s);const i=document.createElement("input");e.errors&&i.classList.add("error"),i.type="text",i.name="treatment",i.value=e.treatment?e.treatment.name:"",i.placeholder="Tratamiento",i.addEventListener("input",(t=>{i.classList.remove("error"),r.classList.remove("error"),e.errors=null,this.targetFocus={budgeted:e,input:i,position:i.selectionStart}})),new MutationObserver((()=>{this.targetFocus&&this.targetFocus.budgeted===e&&this.targetFocus.input.isEqualNode(i)&&(i.focus(),i.setSelectionRange(this.targetFocus.position,this.targetFocus.position))})).observe(s,{childList:!0}),s.appendChild(i),new S({target:i,data:this.treatments,findFields:["name","description"],showFields:["name"],size:6,callback:t=>{e.treatment=t,e.unit_price=t?t.price:null,r.value=t?t.price:"",h.value=this.getTotalTreatment(e).toFixed(2),this.callback()}});const a=document.createElement("td");t.appendChild(a);const n=document.createElement("input");n.type="text",n.name="piece",n.value=e.piece?e.piece:"",n.placeholder="Pieza",n.readOnly=!0,n.addEventListener("click",(async()=>{this.pieces=new class{constructor({selectedPieces:e,selectedGroup:t,callback:s}){this.selectedPieces=e||[],this.selectedGroup=t||null,this.callback=s,this.pieces=[],this.groups=[],this.lines=[{class:"top"},{class:"bottom"},{class:"left"},{class:"right"}]}async init(){await Promise.all([this.readAllPieces(),this.readAllGroups()]),this.piecesEl=this.createPieces()}repaint(){this.piecesEl=this.createPieces()}setPieces(e){this.pieces=e}setGroups(e){this.groups=e}getPiecesEl(){return this.piecesEl}getSelectedPieces(){return this.selectedPieces}getSelectedGroup(){return this.selectedGroup}async readAllPieces(){const e=await F.get("/api/admin/pieces");"error"!==e.status&&this.setPieces(e.pieces)}async readAllGroups(){const e=await F.get("/api/admin/groups");"error"!==e.status&&this.setGroups(e.groups)}createPieces(){const e=document.createElement("div");return e.classList.add("pieces"),this.pieces.forEach((t=>{const s=document.createElement("button");s.classList.add("piece",t.class),this.selectedPieces.forEach((e=>{e.id===t.id&&s.classList.add("active")})),s.addEventListener("click",(()=>{this.selectedGroup&&(this.selectedPieces=[],this.selectedGroup=null);const e=this.selectedPieces.some((e=>e.id===t.id));this.selectedPieces=e?this.selectedPieces.filter((e=>e.id!==t.id)).sort():[...this.selectedPieces,t].sort(),this.repaint(),this.callback()})),e.appendChild(s);const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox",`0 0 ${t.width} ${t.height}`),i.setAttribute("width",t.width),i.setAttribute("height",t.height),i.setAttribute("fill","currentColor"),s.appendChild(i);const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("transform",`translate(0, ${t.height}) scale(0.1, -0.1)`),i.appendChild(a);const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",t.d),a.appendChild(n);const o=document.createElement("span");o.innerText=t.number,s.appendChild(o)})),this.groups.forEach((t=>{const s=document.createElement("button");s.classList.add("group",t.class),this.selectedGroup&&this.selectedGroup.id===t.id&&s.classList.add("active"),s.textContent=t.name,s.addEventListener("click",(()=>{this.selectedPieces=[],this.pieces.forEach((e=>{(e.number>=t.adult.from&&e.number<=t.adult.to||e.number>=t.child.from&&e.number<=t.child.to)&&(this.selectedPieces=[...this.selectedPieces,e].sort())})),this.selectedGroup=t,s.classList.add("active"),this.repaint(),this.callback()})),e.appendChild(s)})),this.lines.forEach((t=>{const s=document.createElement("div");s.classList.add("line",t.class),e.appendChild(s)})),e}}({selectedPieces:e.selectedPieces,selectedGroup:e.selectedGroup,callback:()=>{this.modal.repaint(this.pieces.getPiecesEl())}}),await this.pieces.init(),this.modal=new b({title:"Seleccionar piezas",content:this.pieces.getPiecesEl(),action:"Seleccionar",actionCallback:async()=>{const t=this.pieces.getSelectedPieces(),s=this.pieces.getSelectedGroup();e.selectedPieces=t,e.selectedGroup=s,e.piece=s?s.name:t.map((e=>e.number)).join(", "),await this.modal.close(),this.callback()}})})),a.appendChild(n);const o=document.createElement("td");t.appendChild(o);const r=document.createElement("input");e.errors&&r.classList.add("error"),r.type="text",r.name="price",r.step="0.01",r.placeholder="0,00",r.value=e.unit_price?e.unit_price:"",r.addEventListener("input",(()=>{r.classList.remove("error"),e.errors=null,e.treatment&&(e.unit_price=r.value),this.targetFocus={budgeted:e,input:r,position:r.selectionStart},this.callback()})),new MutationObserver((()=>{this.targetFocus&&this.targetFocus.budgeted===e&&this.targetFocus.input.isEqualNode(r)&&(r.focus(),r.setSelectionRange(this.targetFocus.position,this.targetFocus.position))})).observe(o,{childList:!0}),o.appendChild(r);const c=document.createElement("td");t.appendChild(c);const l=document.createElement("input");l.type="text",l.name="discount",l.placeholder="0",l.value=e.discount?e.discount:"",l.addEventListener("input",(()=>{e.treatment&&(e.discount=l.value),this.targetFocus={budgeted:e,input:l,position:l.selectionStart},this.callback()})),new MutationObserver((()=>{this.targetFocus&&this.targetFocus.budgeted===e&&this.targetFocus.input.isEqualNode(l)&&(l.focus(),l.setSelectionRange(this.targetFocus.position,this.targetFocus.position))})).observe(c,{childList:!0}),c.appendChild(l);const d=document.createElement("td");t.appendChild(d);const h=document.createElement("input");h.type="number",h.name="total",h.step="0.01",h.placeholder="0.00",h.value=this.getTotalTreatment(e).toFixed(2),h.disabled=!0,d.appendChild(h);const p=document.createElement("td");t.appendChild(p);const u=document.createElement("button");u.type="button",u.ariaLabel="Eliminar",u.addEventListener("click",(()=>{this.deleteBudgeted(e),this.callback()})),p.appendChild(u);const m=this.createDeleteIcon();return u.appendChild(m),t}getTotalTreatment(e){const t=e.unit_price?parseFloat(e.unit_price):0;return t-t*(e.discount?parseFloat(e.discount):0)/100}getTotal(){return this.budgeteds.reduce(((e,t)=>{const s=t.unit_price?parseFloat(t.unit_price):0;return e+s-s*(t.discount?parseFloat(t.discount):0)/100}),0)}createAddRow(){const e=document.createElement("div");e.classList.add("row");const t=document.createElement("button");return t.type="button",t.ariaLabel="Añadir tratamiento",t.textContent="Añadir tratamiento",t.classList.add("btn","primary-btn"),t.addEventListener("click",(()=>{const e={id:crypto.randomUUID(),treatment:null,piece:null,unit_price:null,discount:null,selectedPieces:[],selectedGroup:null};this.addBudgeted(e);const t=this.createRow(e);this.tbody.appendChild(t)})),e.appendChild(t),e}createDeleteIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("fill-rule","evenodd"),t.setAttribute("d","M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"),e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("fill-rule","evenodd"),s.setAttribute("d","M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"),e.appendChild(s),e}},P=new class{constructor(){this.popup,this.type,this.title,this.message,this.timer}setOptions(e){this.type=e.type,this.title=e.title,this.message=e.message,this.timer=e.timer}async open(e){this.setOptions(e),this.popup=this.createPopup(),document.body.appendChild(this.popup);const t=this.popup.getAnimations();await Promise.all(t.map((e=>e.finished))),this.timer&&(await new Promise((e=>setTimeout(e,this.timer))),await this.close(this.popup))}async close(){this.popup.classList.add("fadeOut"),this.popup.firstChild.classList.add("slideOutTop");const e=this.popup.getAnimations();return Promise.all(e.map((e=>e.finished))).then((()=>this.popup.remove()))}createPopup(){const e=document.createElement("div");e.classList.add("popup"),e.addEventListener("click",this.close.bind(this));const t=document.createElement("div");t.classList.add("content"),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t);const s=document.createElement("div");s.classList.add("header"),t.appendChild(s);const i=this.createIcon(this.type);s.appendChild(i);const a=document.createElement("div");if(a.classList.add("main"),t.appendChild(a),this.title){const e=document.createElement("div");e.classList.add("title"),e.textContent=this.title,a.appendChild(e)}if(this.message){const e=document.createElement("div");e.classList.add("message"),e.textContent=this.message,a.appendChild(e)}return e}createIcon(e){if("success"===e){const e=document.createElement("div");e.classList.add("animated-icon");const t=document.createElement("div");t.classList.add("success"),e.appendChild(t);const s=document.createElement("div");s.classList.add("line","tip"),t.appendChild(s);const i=document.createElement("div");i.classList.add("line","long"),t.appendChild(i);const a=document.createElement("div");a.classList.add("circle"),t.appendChild(a);const n=document.createElement("div");return n.classList.add("fix"),t.appendChild(n),e}if("error"===e){const e=document.createElement("div");e.classList.add("animated-icon");const t=document.createElement("div");t.classList.add("error"),e.appendChild(t);const s=document.createElement("div");s.classList.add("x"),t.appendChild(s);const i=document.createElement("div");i.classList.add("left"),s.appendChild(i);const a=document.createElement("div");a.classList.add("right"),s.appendChild(a);const n=document.createElement("div");n.classList.add("placeholder"),t.appendChild(n);const o=document.createElement("div");return o.classList.add("fix"),t.appendChild(o),e}}},F=new class{constructor(){this.config={headers:{Accept:"*/*"}}}async request(e){try{const t=await fetch(e,this.config);return await t.json()}catch(e){console.log(e)}}get(e){return this.config.method="GET",this.config.body=null,this.request(e)}post(e,t){return this.config.method="POST",this.config.body=this.isFormData(t)?t:JSON.stringify(t),this.request(e)}put(e,t){return this.config.method="PUT",this.config.body=this.isFormData(t)?t:JSON.stringify(t),this.request(e)}delete(e,t){return this.config.method="DELETE",this.config.body=this.isFormData(t)?t:JSON.stringify(t),this.request(e)}isFormData(e){return e instanceof FormData}};new class{constructor(){this.pageYOffset=0,this.isSidebarOpened=!1,this.isSidebarAnimated=!1,this.values={name:"",email:"",phone:"",message:"",accept:!1},this.errors=null,this.init()}init(){const e=document.querySelector("#hamburguer"),t=document.querySelector("#navbar"),i=document.querySelector("#sidebar"),a=document.querySelector("#accordion"),n=document.querySelector("#contact");window.addEventListener("DOMContentLoaded",this.loadEvent.bind(this)),window.addEventListener("scroll",this.scrollEvent.bind(this)),window.addEventListener("resize",this.resizeEvent.bind(this)),e.addEventListener("click",this.hamburguerEvent.bind(this)),t.addEventListener("click",this.navbarEvent.bind(this)),i.addEventListener("click",this.sidebarEvent.bind(this)),a&&a.addEventListener("click",this.accordionEvent.bind(this)),n&&this.createContactForm(),i.querySelectorAll("button").forEach((e=>{new s(e,e.nextElementSibling,!0)})),this.createWhatsappButton(),window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",this.themeChange.bind(this))}themeChange(){const e=window.matchMedia("(prefers-color-scheme: dark)"),t=document.querySelector('link[rel="shortcut icon"]'),s=document.querySelectorAll('link[rel="icon"]'),i=document.querySelectorAll('link[rel="apple-touch-icon"]');e.matches?(t.setAttribute("href","/build/img/iconos/icono16-light.ico"),s.forEach((e=>{e.setAttribute("href",e.getAttribute("href").replace("dark","light"))})),i.forEach((e=>{e.setAttribute("href",e.getAttribute("href").replace("dark","light"))}))):(t.setAttribute("href","/build/img/iconos/icono16-dark.ico"),s.forEach((e=>{e.setAttribute("href",e.getAttribute("href").replace("light","dark"))})),i.forEach((e=>{e.setAttribute("href",e.getAttribute("href").replace("light","dark"))})))}loadEvent(){const e=document.querySelector("#main-header");window.pageYOffset>0&&e.classList.add("active");const t=document.querySelector("#accordion");t&&t.querySelectorAll(".item").forEach((e=>{const t=e.firstElementChild,i=e.lastElementChild;new s(t,i,!0)})),this.themeChange()}scrollEvent(){const e=document.querySelector("#main-header");this.isSidebarOpened||(window.pageYOffset>0?e.classList.add("active"):e.classList.remove("active"))}async resizeEvent(){const e=document.querySelector("#hamburguer"),t=document.querySelector("#main-header"),s=document.querySelector("#sidebar");if(window.innerWidth>=1024&&this.isSidebarOpened)return this.isSidebarOpened=!1,this.isSidebarAnimated=!0,document.body.removeAttribute("style"),document.body.classList.remove("noscroll"),window.scroll(0,this.pageYOffset),e.classList.remove("active"),t.classList.remove("active"),s.classList.add("out"),await this.animationend(s),s.classList.remove("active","in","out"),void(this.isSidebarAnimated=!1)}async hamburguerEvent(){const e=document.querySelector("#hamburguer"),t=document.querySelector("#main-header"),s=document.querySelector("#sidebar");return this.isSidebarOpened&&!this.isSidebarAnimated?(this.isSidebarOpened=!1,this.isSidebarAnimated=!0,document.body.removeAttribute("style"),document.body.classList.remove("noscroll"),window.scroll(0,this.pageYOffset),window.pageYOffset||t.classList.remove("active"),e.classList.remove("active"),s.classList.add("out"),await this.animationend(s),s.classList.remove("active","in","out"),this.isSidebarAnimated=!1,void(this.pageYOffset=0)):this.isSidebarOpened||this.isSidebarAnimated?void 0:(this.pageYOffset=window.pageYOffset,this.isSidebarOpened=!0,this.isSidebarAnimated=!0,document.body.style.top=`-${this.pageYOffset}px`,document.body.classList.add("noscroll"),e.classList.add("active"),t.classList.add("active"),s.classList.add("active","in"),await this.animationend(s),void(this.isSidebarAnimated=!1))}async navbarEvent(e){if(e.target.closest("button")){const t=e.target.closest("button"),s=t.nextElementSibling;requestAnimationFrame((()=>{s.classList.remove("hidden"),s.classList.add("flex"),requestAnimationFrame((()=>{s.classList.remove("out")}))})),s.classList.add("in"),await this.transitionend(s),t.ariaExpanded=!0}if(e.target.closest(".menu")){const t=e.target.closest(".menu"),s=t.previousElementSibling;t.classList.remove("in"),t.classList.add("out"),await this.transitionend(t),t.classList.remove("flex"),t.classList.add("hidden"),s.ariaExpanded=!1}}async sidebarEvent(e){const t=document.querySelector("#hamburguer"),s=document.querySelector("#main-header"),i=document.querySelector("#sidebar");"sidebar"===e.target.id&&this.isSidebarOpened&&!this.isSidebarAnimated&&(this.isSidebarOpened=!1,this.isSidebarAnimated=!0,document.body.removeAttribute("style"),document.body.classList.remove("noscroll"),window.scroll(0,this.pageYOffset),window.pageYOffset||s.classList.remove("active"),t.classList.remove("active"),i.classList.add("out"),await this.animationend(i),i.classList.remove("active","in","out"),this.isSidebarAnimated=!1)}async accordionEvent(e){const t=e.target.closest(".item");if(t&&t.firstElementChild.classList.contains("active")){const t=document.querySelector("#accordion").querySelectorAll(".item"),s=e.target.closest(".item");t.forEach((e=>{e!==s&&e.firstElementChild.classList.contains("active")&&e.firstElementChild.click()}))}}async transitionend(e){return new Promise((t=>{e.addEventListener("transitionend",t,{once:!0})}))}async animationend(e){return new Promise((t=>{e.addEventListener("animationend",t,{once:!0})}))}createContactForm(){const e=document.querySelector("#contact");this.contactForm=document.createElement("form"),this.contactForm.classList.add("mio-form"),this.contactForm.noValidate=!0,this.contactForm.addEventListener("submit",this.handleSubmit.bind(this)),e.appendChild(this.contactForm);const t=new n({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values.name},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null}});this.contactForm.appendChild(t.getField());const s=new n({label:{text:"Email",for:"email"},input:{type:"text",name:"email",id:"email",value:this.values.email},error:this.errors&&this.errors.email,message:this.errors&&this.errors.email?this.errors.email:"",callback:e=>{this.values.email=e,this.errors=null}});this.contactForm.appendChild(s.getField());const i=new n({label:{text:"Teléfono",for:"phone"},input:{type:"tel",phone:"phone",id:"phone",value:this.values.phone},error:this.errors&&this.errors.phone,message:this.errors&&this.errors.phone?this.errors.phone:"",callback:e=>{this.values.phone=e,this.errors=null}});this.contactForm.appendChild(i.getField());const a=new o({label:{text:"Mensaje",for:"message"},input:{name:"message",id:"message",rows:3,value:this.values.message},error:this.errors&&this.errors.message,message:this.errors&&this.errors.message?this.errors.message:"",callback:e=>{this.values.message=e,this.errors=null}});this.contactForm.appendChild(a.getField());const l=new r({label:{text:"He leído y acepto la Política de Privacidad",for:"accept"},input:{name:"accept",id:"accept",value:this.values.accept},error:this.errors&&this.errors.accept,message:this.errors&&this.errors.accept?this.errors.accept:"",callback:e=>{this.values.accept=e,this.errors=null}});this.contactForm.appendChild(l.getField());const d=document.createElement("div");d.classList.add("mio-field"),this.contactForm.appendChild(d),this.submitButton=new c({type:"submit",text:"Enviar",ariaLabel:"Enviar mensaje de contacto",classes:["btn","primary-btn"],onClick:this.actionCallback}),d.appendChild(this.submitButton.get())}async handleSubmit(e){e.preventDefault();const t=await F.post("/api/contact",this.values);if(this.submitButton.stop(),"error"===t.status)return this.errors=t.errors,this.contactForm.remove(),void this.createContactForm();await P.open({type:"success",title:"¡Mensaje enviado!",message:"Gracias por contactar con nosotros. Nos pondremos en contacto contigo lo antes posible.",timer:3e3}),this.values={name:"",email:"",phone:"",message:"",accept:!1},this.errors=null,this.contactForm.remove(),this.createContactForm()}createWhatsappButton(){const e=document.createElement("a");e.classList.add("quick-access-btn","whatsapp"),e.href="https://wa.me/34622348982",e.target="_blank",e.rel="noopener noreferrer",e.ariaLabel="Abrir WhatsApp",document.body.appendChild(e),e.appendChild(l.get("whatsapp"));const t=document.createElement("a");t.classList.add("quick-access-btn","mail"),t.href="/contacto#contact",t.ariaLabel="Abrir formulario de contacto",document.body.appendChild(t),t.appendChild(l.get("envelope"))}},new class{constructor(){this.post=new class{constructor(e){this.post=e||null,this.auth=!1,this.init()}async init(){document.querySelector("#blog-post")&&(await this.readPost(),this.showPost())}setPost(e){this.post=e}setAuth(e){this.auth=e}async readPost(){const e=window.location.pathname.split("/").pop(),t=await F.get(`/api/blog/post/${e}`);"error"!==t.status&&(this.setPost(t.post),this.setAuth(t.auth))}showPost(){const e=document.querySelector("#blog-post"),t=this.createPost();e.appendChild(t)}createPost(){const e=document.createElement("article"),t=document.createElement("header");e.appendChild(t);const s=document.createElement("h1");if(s.textContent=this.post.title,t.appendChild(s),this.auth){const e=document.createElement("div");e.classList.add("actions"),t.appendChild(e);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/blog/${this.post.alias}`,e.appendChild(s);const i=l.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,this.post)),e.appendChild(a);const n=l.get("trash");a.appendChild(n)}const i=document.createElement("div");return i.classList.add("body"),i.innerHTML=this.post.html,e.appendChild(i),e}async deletePost(e){const t=new d({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,image_id:e.image_id};"error"!==(await F.delete("/api/blog",s)).status&&(await P.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido al blog",timer:3e3}),window.location.href="/blog")}},this.posts=new class{constructor(){this.posts=[],this.latestPosts=[],this.page=1,this.limit=5,this.total=0,this.category="",this.search="",this.auth=!1,this.init()}async init(){document.querySelector("#blog-posts")&&(await this.readPosts(),this.showPosts()),document.querySelector("#blog-posts-by-category")&&(await this.readPostsByCategory(),this.showPostsByCategory()),document.querySelector("#blog-posts-by-search")&&(await this.readPostsBySearch(),this.showPostsBySearch()),document.querySelector("#blog-latest-posts")&&(await this.readLatestPosts(),this.showLatestPosts())}setPosts(e){this.posts=e}setLatestPosts(e){this.latestPosts=e}setPage(e){this.page=e}setLimit(e){this.limit=e}setCategory(e){this.category=e}setSearch(e){this.search=e}setAuth(e){this.auth=e}setTotal(e){this.total=e}updatePost(e){this.posts=this.posts.map((t=>t.id===e.id?e:t))}deletePost(e){this.posts=this.posts.filter((t=>t.id!==e.id))}clearPosts(){this.posts=[]}async readPosts(){const e=window.location.pathname.split("/"),t=e.includes("page")?Number(e.pop()):1;this.setPage(t),this.setLimit(1===t?5:6);const s={page:this.page,limit:this.limit},i=await F.post("/api/blog",s);"error"!==i.status&&(!i.posts.length&&this.page>1?window.location.href="/blog":(this.setPosts(i.posts),this.setTotal(i.total),this.setAuth(i.auth)))}async readPostsByCategory(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[2]:e.pop(),i=t?Number(e.pop()):1;this.setCategory(s),this.setPage(i),this.setLimit(1===i?5:6);const a={category:this.category,page:this.page,limit:this.limit},n=await F.post("/api/blog/category",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/blog/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}async readLatestPosts(){const e=await F.get("/api/blog/latest");"error"!==e.status&&(this.setLatestPosts(e.posts),this.setAuth(e.auth))}async readPostsBySearch(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[3]:e.pop(),i=t?Number(e.pop()):1;this.setSearch(s),this.setPage(i),this.setLimit(1===i?5:6);const a={search:s.split("+").join(" "),page:this.page,limit:this.limit},n=await F.post("/api/blog/search",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/blog/search/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}showPosts(){const e=document.querySelector("#blog-posts"),t=this.createPosts();e.appendChild(t),new h(this.page,this.limit,this.total,"/blog")}showPostsByCategory(){const e=document.querySelector("#blog-posts-by-category"),t=this.createPosts();e.appendChild(t),new h(this.page,this.limit,this.total,`/blog/${this.category}`)}showPostsBySearch(){const e=document.querySelector("#blog-posts-by-search"),t=this.createPosts();e.appendChild(t),new h(this.page,this.limit,this.total,`/blog/search/${this.search}`)}showLatestPosts(){const e=document.querySelector("#blog-latest-posts"),t=this.createLatestPosts();e.appendChild(t)}createPosts(){const e=document.createDocumentFragment();if(!this.posts.length){const t=document.createElement("p");t.textContent="No se encontraron posts",e.appendChild(t)}return this.posts.forEach(((t,s)=>{const i=this.createPost(t,s);e.appendChild(i)})),e}createPost(e,t){const s=document.createElement("article");1===this.page&&0===t&&s.classList.add("post-big");const i=document.createElement("div");i.classList.add("image"),s.appendChild(i);const a=document.createElement("img");a.src=e.src,a.alt=e.alt,i.appendChild(a);const n=document.createElement("h2");n.classList.add("title"),s.appendChild(n);const o=document.createElement("a");o.href=`/blog/${e.category_alias}/${e.alias}`,o.textContent=e.title,n.appendChild(o);const r=document.createElement("p");r.classList.add("description"),r.textContent=e.description,s.appendChild(r);const c=document.createElement("div");c.classList.add("row"),s.appendChild(c);const d=document.createElement("time");d.classList.add("date"),d.textContent=p(e.created_at),c.appendChild(d);const h=document.createElement("a");if(h.classList.add("author"),h.textContent=`By ${e.author}`,h.href="/blog",c.appendChild(h),this.auth){const t=document.createElement("div");t.classList.add("actions"),c.appendChild(t);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/blog/${e.alias}`,t.appendChild(s);const i=l.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,e)),t.appendChild(a);const n=l.get("trash");a.appendChild(n)}if(1===this.page&&0===t){const t=document.createElement("a");t.classList.add("read-more"),t.href=`/blog/${e.category_alias}/${e.alias}`,c.appendChild(t);const s=document.createElement("span");s.textContent="Leer más",t.appendChild(s);const i=l.get("arrowRight");t.appendChild(i)}return s}createLatestPosts(){const e=document.createDocumentFragment();return this.latestPosts.forEach(((t,s)=>{const i=this.createLatestPost(t,s);e.appendChild(i)})),e}createLatestPost(e){const t=document.createElement("a");t.href=`/blog/${e.category_alias}/${e.alias}`;const s=document.createElement("article");t.appendChild(s);const i=document.createElement("div");i.classList.add("row"),s.appendChild(i);const a=document.createElement("time");a.classList.add("date"),a.textContent=p(e.created_at),i.appendChild(a);const n=document.createElement("p");n.classList.add("author"),n.textContent=`By ${e.author}`,i.appendChild(n);const o=document.createElement("p");return o.classList.add("title"),o.textContent=e.title,s.appendChild(o),t}async deletePost(e){const t=new d({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,image_id:e.image_id};"error"!==(await F.delete("/api/blog",s)).status&&(await P.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido al blog",timer:3e3}),window.location.href="/blog")}},this.search=new class{constructor(){this.init()}init(){document.querySelector("#blog-search-form")&&this.createSearch()}createSearch(){const e=document.querySelector("#blog-search-form");e.addEventListener("submit",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t);const s=document.createElement("div");s.classList.add("field"),e.appendChild(s);const i=document.createElement("button");i.classList.add("btn","primary-btn"),i.type="submit",i.ariaLabel="Buscar",s.appendChild(i);const a=l.get("search");i.appendChild(a)}async handleSearch(e){e.preventDefault();const t=new FormData(e.target),s=Object.fromEntries(t).search.trim().toLowerCase().split(" ").join("+");window.location.href=`/blog/search/${s}`}},this.categories=new class{constructor(){this.categories=[],this.category=null,this.values={name:"",alias:""},this.errors=null,this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"alias",headerName:"Alias"}],this.init()}async init(){const e=document.querySelector("#blog-categories"),t=document.querySelector("#blog-categories-table"),s=document.querySelector("#blog-categories-search");e&&(await this.readCategoriesInUse(),this.showCategoriesInUse()),t&&(await this.readAllCategories(),this.showCategoriesTable(),document.querySelector("#blog-categories-create").addEventListener("click",this.handleCreateCategory.bind(this))),s&&this.createSearch()}async readCategoriesInUse(){const e=await F.get("/api/blog/categories");"error"!==e.status&&(this.categories=e.categories)}async readAllCategories(){const e=await F.get("/api/admin/blog-categories");"error"!==e.status&&(this.categories=e.categories)}resetValues(){this.values={name:"",alias:""}}handleCreateCategory(){this.modal=new b({title:"Crear categoría",content:this.createCategoryForm(),action:"Crear",actionCallback:()=>this.createCategory(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async createCategory(){const e=await F.post("/api/admin/blog-categories",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await P.open({type:"success",title:"¡Categoría creada!",message:"La categoría ha sido creada correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.category)}handleUpdateCategory(e){this.category=e,this.values={name:e.name,alias:e.alias},this.modal=new b({title:"Actualizar categoría",content:this.createCategoryForm(),action:"Actualizar",actionCallback:()=>this.updateCategory(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async updateCategory(){this.category={id:this.category.id,name:this.values.name,alias:this.values.alias};const e=await F.put("/api/admin/blog-categories",this.category);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await P.open({type:"success",title:"¡Categoría actualizada!",message:"La categoría ha sido actualziada correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.category)}async deleteCategory(e){const t=new d({title:"¿Eliminar categoría?",description:"¿Estás seguro de eliminar esta categoría? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await F.delete("/api/admin/blog-categories",s)).status&&(await P.open({type:"success",title:"¡Categoría eliminada!",message:"La categoría ha sido eliminada correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteCategories(e){const t=new d({title:`¿Eliminar ${e.length>1?"categorías":"categoría"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estas categorías":"esta categoría"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/blog-categories/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Categorías eliminadas":"Categoría eliminada"}!`,message:(e.length>1?"Las categorías han sido eliminadas":"La categoría ha sido eliminada")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#blog-categories-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar categoría",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createCategoryForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new n({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.values.alias=u(e),this.errors=null,s.setValue(this.values.alias)}}).getField();e.appendChild(t);const s=new n({label:{text:"Alias",for:"alias"},input:{type:"text",name:"alias",id:"alias",value:this.values?this.values.alias:""},error:this.errors&&this.errors.alias,message:this.errors&&this.errors.alias?this.errors.alias:""}),i=s.getField();return e.appendChild(i),e}showCategoriesInUse(){const e=document.querySelector("#blog-categories"),t=this.createCategoriesFragment();e.appendChild(t)}showCategoriesTable(){const e=document.querySelector("#blog-categories-table");this.table=new g({columns:this.columns,rows:this.categories,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateCategory.bind(this),delete:this.deleteCategory.bind(this),deleteSelected:this.deleteCategories.bind(this)})}createCategoriesFragment(){const e=document.createDocumentFragment();return this.categories.forEach((t=>{const s=this.createCategoryElement(t);e.appendChild(s)})),e}createCategoryElement(e){const t=document.createElement("a");t.href=`/blog/${e.alias}`;const s=document.createElement("span");s.textContent=e.name,t.appendChild(s);const i=l.get("arrowRight");return t.appendChild(i),t}},this.editor=new class{constructor(){this.post=null,this.categories=[],this.values={title:"",description:"",category_id:"",alt:"",html:""},this.errors=null,this.init()}async init(){document.querySelector("#blog-editor")&&(await this.loadCKEditor(),await this.readAllCategories(),await this.loadPost(),this.createEditorForm())}async loadCKEditor(){if(!document.querySelector('script[src="/build/js/vendor/ckeditor/ckeditor.js"]'))return new Promise(((e,t)=>{const s=document.createElement("script");s.src="/build/js/vendor/ckeditor/ckeditor.js",s.onload=e,s.onerror=t,document.body.appendChild(s)}))}async createCKEditor(e){return new Promise(((t,s)=>{ClassicEditor.create(e,{image:{toolbar:["imageStyle:inline","imageStyle:wrapText","imageStyle:breakText","|","toggleImageCaption","imageTextAlternative"]},extraPlugins:[w]}).then((e=>{this.editor=e,this.values.html&&this.editor.setData(this.values.html),t()})).catch((e=>{console.log(e),s()}))}))}async readAllCategories(){const e=await F.get("/api/admin/blog-categories");"error"!==e.status&&(this.categories=e.categories)}async loadPost(){const e=window.location.pathname.split("/").filter((e=>e));if(2===e.length)return;const t=e[2],s=await F.get(`/api/editor/blog/read/${t}`);"error"!==s.status&&(this.post=s.post,this.values={title:this.post.title,description:this.post.description,category_id:this.post.category_id,alt:this.post.alt,html:this.post.html})}async createEditorForm(){const e=document.querySelector("#blog-editor");this.formEditor=document.createElement("form"),this.formEditor.classList.add("mio-form"),this.formEditor.addEventListener("submit",this.handleSubmit.bind(this)),e.appendChild(this.formEditor);const t=document.createElement("div");t.classList.add("col"),this.formEditor.appendChild(t);const s=document.createElement("h2");s.textContent="1. Título",t.appendChild(s);const i=document.createElement("p");i.textContent="Máximo 255 caracteres",t.appendChild(i);const a=new n({label:{text:"Título",for:"title"},input:{type:"text",name:"title",id:"title",maxlength:255,value:this.values.title},error:this.errors&&this.errors.title,message:this.errors&&this.errors.title?this.errors.title:"",callback:e=>{this.values.title=e,this.errors=null}});t.appendChild(a.getField());const r=document.createElement("div");r.classList.add("col"),this.formEditor.appendChild(r);const c=document.createElement("h2");c.textContent="2. Descripción",r.appendChild(c);const l=document.createElement("p");l.textContent="Máximo 255 caracteres",r.appendChild(l);const d=new o({label:{text:"Descripción",for:"description"},input:{name:"description",id:"description",rows:2,maxlength:255,value:this.values.description},error:this.errors&&this.errors.description,message:this.errors&&this.errors.description?this.errors.description:"",callback:e=>{this.values.description=e,this.errors=null}});r.appendChild(d.getField());const h=document.createElement("div");h.classList.add("col"),this.formEditor.appendChild(h);const p=document.createElement("h2");p.textContent="3. Categoría",h.appendChild(p);const u=document.createElement("p");u.textContent="Seleccionar la categoría a la que corresponde el post",h.appendChild(u);const m=new f({label:{text:"Categoría",for:"category_id"},select:{name:"category_id",id:"category_id"},option:{value:"id",text:"name"},options:this.categories,selected:this.values.category_id?{id:this.values.category_id}:null,error:this.errors&&this.errors.category_id,message:this.errors&&this.errors.category_id?this.errors.category_id:"",onSelect:e=>{this.values.category_id=e.id,this.errors=null}});h.appendChild(m.getField());const g=document.createElement("div");g.classList.add("col"),this.formEditor.appendChild(g);const b=document.createElement("h2");b.textContent="4. Imagen miniatura",g.appendChild(b);const v=document.createElement("p");if(v.textContent="Imagen para las miniaturas. Recomendado 750px por 500px",g.appendChild(v),this.inputFile&&this.inputFile.getInput().files.length||(this.inputFile=new E({label:{text:"Selecciona una imagen...",for:"image"},input:{name:"image",id:"image",accept:"image/jpeg, image/png"},error:this.errors&&this.errors.image?this.errors.image:"",callback:e=>{this.previewImage(e)}})),g.appendChild(this.inputFile.getField()),this.post){const e=this.post.src;this.previewImage(e)}const w=document.createElement("div");w.classList.add("col"),this.formEditor.appendChild(w);const C=document.createElement("h2");C.textContent="5. Descripción imagen",w.appendChild(C);const y=document.createElement("p");y.textContent="Descripción para imagen principal. Máximo 255 caracteres",w.appendChild(y);const L=new o({label:{text:"Descripción imagen",for:"alt"},input:{name:"alt",id:"alt",rows:2,maxlength:255,value:this.values.alt},error:this.errors&&this.errors.alt,message:this.errors&&this.errors.alt?this.errors.alt:"",callback:()=>{this.errors=null}});w.appendChild(L.getField());const x=document.createElement("div");x.classList.add("col"),this.formEditor.appendChild(x);const S=document.createElement("h2");S.textContent="6. Contenido",x.appendChild(S);const k=document.createElement("p");k.textContent="Contenido principal del post",x.appendChild(k);const P=document.createElement("div");P.classList.add("field"),this.errors&&this.errors.html&&P.classList.add("error"),x.appendChild(P);const F=document.createElement("textarea");if(F.id="html",F.name="html",P.appendChild(F),await this.createCKEditor(F),this.editor.model.document.on("change:data",(()=>{P.classList.remove("error"),P.querySelector(".error-message")&&P.querySelector(".error-message").remove(),this.values.html=this.editor.getData()})),this.post&&this.editor.setData(this.values.html),this.errors&&this.errors.html){const e=document.createElement("p");e.classList.add("error-message"),e.textContent=this.errors.html,P.appendChild(e)}const A=document.createElement("div");A.classList.add("field"),this.formEditor.appendChild(A);const R=document.createElement("input");R.type="submit",R.value=this.post?"Actualizar post":"Crear post",R.classList.add("btn","primary-btn"),A.appendChild(R)}async handleSubmit(e){e.preventDefault();const t=new FormData(e.currentTarget);t.append("html",this.editor.getData()),this.post&&t.append("id",this.post.id);const s=await F.post("/api/editor/blog/"+(this.post?"update":"create"),t);if("error"===s.status)return this.errors=s.errors,this.formEditor.remove(),void this.createEditorForm();await P.open({type:"success",title:`¡Post ${this.post?"actualizado":"creado"} correctamente!`,message:"Serás redirigido al blog",timer:3e3}),window.location.href="/blog"}async previewImage(e){const t=document.querySelector("#image"),s=document.querySelector("label[for='image']");s.classList.add("hidden");const i=document.createElement("div");i.classList.add("image-preview"),t.parentElement.appendChild(i);const a=await this.createImage(e);i.appendChild(a);const n=document.createElement("button");n.classList.add("close"),n.type="button",n.addEventListener("click",(()=>{t.value="",s.classList.remove("hidden"),i.remove()})),i.appendChild(n);const o=l.get("xLg");n.appendChild(o)}createImage(e,t=""){return new Promise(((s,i)=>{const a=new Image;a.src=e,a.alt=t,a.addEventListener("load",(()=>s(a))),a.addEventListener("error",(()=>i(new Error("Error loading image"))))}))}}}},new class{constructor(){this.values={email:"",password:""},this.errors=null,this.init()}init(){document.querySelector("#login")&&this.createLoginForm();const e=document.querySelector("#register-form");e&&e.addEventListener("submit",this.register.bind(this));const t=document.querySelector("#confirm");t&&t.addEventListener("click",this.confirm.bind(this));const s=document.querySelector("#recover-form");s&&s.addEventListener("submit",this.recover.bind(this));const i=document.querySelector("#restore-form");i&&i.addEventListener("submit",this.restore.bind(this))}createLoginForm(){const e=document.querySelector("#login");this.loginForm=document.createElement("form"),this.loginForm.classList.add("mio-form"),this.loginForm.noValidate=!0,this.loginForm.addEventListener("submit",this.login.bind(this)),e.appendChild(this.loginForm);const t=new n({label:{text:"Email",for:"email"},input:{type:"email",name:"email",id:"email",autocomplete:"username",value:this.values?this.values.email:""},error:this.errors&&this.errors.email,message:this.errors&&this.errors.email?this.errors.email:"",callback:e=>{this.values.email=e,this.errors=null}}).getField();this.loginForm.appendChild(t);const s=new n({label:{text:"Contraseña",for:"password"},input:{type:"password",name:"password",id:"password",autocomplete:"current-password",value:this.values?this.values.password:""},error:this.errors&&this.errors.password,message:this.errors&&this.errors.password?this.errors.password:"",callback:e=>{this.values.password=e,this.errors=null}}).getField();this.loginForm.appendChild(s);const i=document.createElement("input");i.type="submit",i.value="Iniciar sesión",i.classList.add("btn","primary-btn"),this.loginForm.appendChild(i)}repaintLoginForm(){this.loginForm.remove(),this.createLoginForm()}async login(e){e.preventDefault();const t=new FormData(e.currentTarget),s=await F.post("/api/user/login",t);if("error"===s.status)return this.errors=s.errors,void this.repaintLoginForm();await P.open({type:"success",title:"¡Login correcto!",message:"Serás redirigido al panel principal",timer:3e3}),window.location.href="/admin"}async register(){e.preventDefault(),new FormData(e.currentTarget),await F.post("/api/user/register")}async confirm(){const e=window.location.pathname.split("/").pop();(new FormData).append("token",e),await F.post("/api/user/confirm")}async recover(){(new FormData).append("token",token),await F.post("/api/user/recover")}async restore(){(new FormData).append("token",token),await F.post("/api/user/restore")}},new class{constructor(){this.post=new class{constructor(e){this.post=e||null,this.auth=!1,this.init()}async init(){document.querySelector("#cases-post")&&(await this.readPost(),this.showPost())}setPost(e){this.post=e}setAuth(e){this.auth=e}async readPost(){const e=window.location.pathname.split("/").pop(),t=await F.get(`/api/cases/post/${e}`);"error"!==t.status&&(this.setPost(t.post),this.setAuth(t.auth))}showPost(){const e=document.querySelector("#cases-post"),t=this.createPost();e.appendChild(t)}createPost(){const e=document.createElement("article"),t=document.createElement("header");e.appendChild(t);const s=document.createElement("h1");if(s.textContent=this.post.title,t.appendChild(s),this.auth){const e=document.createElement("div");e.classList.add("actions"),t.appendChild(e);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/casos/${this.post.alias}`,e.appendChild(s);const i=l.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,this.post)),e.appendChild(a);const n=l.get("trash");a.appendChild(n)}const i=document.createElement("div");i.classList.add("baf-container"),e.appendChild(i);const a=document.createElement("img");a.src=this.post.images.before.src,a.alt=this.post.images.before.alt;const n=document.createElement("img");n.src=this.post.images.after.src,n.alt=this.post.images.after.alt,this.beforeAndAfter=new y(i,a,n);const o=document.createElement("div");return o.classList.add("body"),o.innerHTML=this.post.html,e.appendChild(o),e}async deletePost(e){const t=new d({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,before_id:e.before_id,after_id:e.after_id};"error"!==(await F.delete("/api/cases",s)).status&&(await P.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido a los casos",timer:3e3}),window.location.href="/casos")}},this.posts=new class{constructor(){this.posts=[],this.latestPosts=[],this.page=1,this.limit=5,this.total=0,this.category="",this.search="",this.auth=!1,this.init()}async init(){document.querySelector("#cases-posts")&&(await this.readPosts(),this.showPosts()),document.querySelector("#cases-posts-by-category")&&(await this.readPostsByCategory(),this.showPostsByCategory()),document.querySelector("#cases-posts-by-search")&&(await this.readPostsBySearch(),this.showPostsBySearch())}setPosts(e){this.posts=e}setLatestPosts(e){this.latestPosts=e}setPage(e){this.page=e}setLimit(e){this.limit=e}setCategory(e){this.category=e}setSearch(e){this.search=e}setAuth(e){this.auth=e}setTotal(e){this.total=e}updatePost(e){this.posts=this.posts.map((t=>t.id===e.id?e:t))}deletePost(e){this.posts=this.posts.filter((t=>t.id!==e.id))}clearPosts(){this.posts=[]}async readPosts(){const e=window.location.pathname.split("/"),t=e.includes("page")?Number(e.pop()):1;this.setPage(t),this.setLimit(1===t?5:6);const s={page:this.page,limit:this.limit},i=await F.post("/api/cases",s);"error"!==i.status&&(!i.posts.length&&this.page>1?window.location.href="/casos":(this.setPosts(i.posts),this.setTotal(i.total),this.setAuth(i.auth)))}async readPostsByCategory(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[2]:e.pop(),i=t?Number(e.pop()):1;this.setCategory(s),this.setPage(i),this.setLimit(1===i?5:6);const a={category:this.category,page:this.page,limit:this.limit},n=await F.post("/api/cases/category",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/casos/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}async readPostsBySearch(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[3]:e.pop(),i=t?Number(e.pop()):1;this.setSearch(s),this.setPage(i),this.setLimit(1===i?5:6);const a={search:s.split("+").join(" "),page:this.page,limit:this.limit},n=await F.post("/api/cases/search",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/casos/search/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}showPosts(){const e=document.querySelector("#cases-posts"),t=this.createPosts();e.appendChild(t),new h(this.page,this.limit,this.total,"/casos")}showPostsByCategory(){const e=document.querySelector("#cases-posts-by-category"),t=this.createPosts();e.appendChild(t),new h(this.page,this.limit,this.total,`/casos/${this.category}`)}showPostsBySearch(){const e=document.querySelector("#cases-posts-by-search"),t=this.createPosts();e.appendChild(t),new h(this.page,this.limit,this.total,`/casos/search/${this.search}`)}createPosts(){const e=document.createDocumentFragment();if(!this.posts.length){const t=document.createElement("p");t.textContent="No se encontraron posts",e.appendChild(t)}return this.posts.forEach(((t,s)=>{const i=this.createPost(t,s);e.appendChild(i)})),e}createPost(e,t){const s=document.createElement("article");1===this.page&&0===t&&s.classList.add("post-big");const i=document.createElement("div");i.classList.add("image"),s.appendChild(i);const a=document.createElement("img");a.src=e.images.before.src,a.alt=e.images.before.alt;const n=document.createElement("img");n.src=e.images.after.src,n.alt=e.images.after.alt,this.beforeAndAfter=new y(i,a,n);const o=document.createElement("h2");o.classList.add("title"),s.appendChild(o);const r=document.createElement("a");r.href=`/casos/${e.category_alias}/${e.alias}`,r.textContent=e.title,o.appendChild(r);const c=document.createElement("p");c.classList.add("description"),c.textContent=e.description,s.appendChild(c);const d=document.createElement("div");d.classList.add("row"),s.appendChild(d);const h=document.createElement("time");h.classList.add("date"),h.textContent=p(e.created_at),d.appendChild(h);const u=document.createElement("a");if(u.classList.add("author"),u.textContent=`By ${e.author}`,u.href="/casos",d.appendChild(u),this.auth){const t=document.createElement("div");t.classList.add("actions"),d.appendChild(t);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/casos/${e.alias}`,t.appendChild(s);const i=l.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,e)),t.appendChild(a);const n=l.get("trash");a.appendChild(n)}if(1===this.page&&0===t){const t=document.createElement("a");t.classList.add("read-more"),t.href=`/casos/${e.category_alias}/${e.alias}`,d.appendChild(t);const s=document.createElement("span");s.textContent="Leer más",t.appendChild(s);const i=l.get("arrowRight");t.appendChild(i)}return s}async deletePost(e){const t=new d({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,before_id:e.before_id,after_id:e.after_id};"error"!==(await F.delete("/api/cases",s)).status&&(await P.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido a los casos",timer:3e3}),window.location.href="/casos")}createImage(e,t=""){return new Promise(((s,i)=>{const a=new Image;a.src=e,a.alt=t,a.addEventListener("load",(()=>s(a))),a.addEventListener("error",(()=>i(new Error("Error loading image"))))}))}},this.search=new class{constructor(){this.init()}init(){document.querySelector("#cases-search-form")&&this.createSearch()}createSearch(){const e=document.querySelector("#cases-search-form");e.addEventListener("submit",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t);const s=document.createElement("div");s.classList.add("field"),e.appendChild(s);const i=document.createElement("button");i.classList.add("btn","primary-btn"),i.type="submit",i.ariaLabel="Buscar",s.appendChild(i);const a=l.get("search");i.appendChild(a)}async handleSearch(e){e.preventDefault();const t=new FormData(e.target),s=Object.fromEntries(t).search.trim().toLowerCase().split(" ").join("+");window.location.href=`/casos/search/${s}`}},this.categories=new class{constructor(){this.categories=[],this.category=null,this.values={name:"",alias:""},this.errors=null,this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"alias",headerName:"Alias"}],this.init()}async init(){const e=document.querySelector("#cases-categories"),t=document.querySelector("#cases-categories-table"),s=document.querySelector("#cases-categories-search");e&&(await this.readCategoriesInUse(),this.showCategoriesInUse()),t&&(await this.readAllCategories(),this.showCategoriesTable(),document.querySelector("#create-cases-category").addEventListener("click",this.handleCreateCategory.bind(this))),s&&this.createSearch()}setCategories(e){this.categories=e}async readCategoriesInUse(){const e=await F.get("/api/cases/categories");"error"!==e.status&&this.setCategories(e.categories)}async readAllCategories(){const e=await F.get("/api/admin/cases-categories");"error"!==e.status&&this.setCategories(e.categories)}resetValues(){this.values={name:"",alias:""}}handleCreateCategory(){this.modal=new b({title:"Crear categoría",content:this.createCategoryForm(),action:"Crear",actionCallback:()=>this.createCategory(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async createCategory(){const e=await F.post("/api/admin/cases-categories",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await P.open({type:"success",title:"¡Categoría creada!",message:"La categoría ha sido creada correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.category)}handleUpdateCategory(e){this.category=e,this.values={name:e.name,alias:e.alias},this.modal=new b({title:"Actualizar categoría",content:this.createCategoryForm(),action:"Actualizar",actionCallback:()=>this.updateCategory(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async updateCategory(){this.category={id:this.category.id,name:this.values.name,alias:this.values.alias};const e=await F.put("/api/admin/cases-categories",this.category);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await P.open({type:"success",title:"¡Categoría actualizada!",message:"La categoría ha sido actualziada correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.category)}async deleteCategory(e){const t=new d({title:"¿Eliminar categoría?",description:"¿Estás seguro de eliminar esta categoría? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await F.delete("/api/admin/cases-categories",s)).status&&(await P.open({type:"success",title:"¡Categoría eliminada!",message:"La categoría ha sido eliminada correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteCategories(e){const t=new d({title:`¿Eliminar ${e.length>1?"categorías":"categoría"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estas categorías":"esta categoría"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/cases-categories/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Categorías eliminadas":"Categoría eliminada"}!`,message:(e.length>1?"Las categorías han sido eliminadas":"La categoría ha sido eliminada")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#cases-categories-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar categoría",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createCategoryForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new n({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.values.alias=u(e),this.errors=null,s.setValue(this.values.alias)}}).getField();e.appendChild(t);const s=new n({label:{text:"Alias",for:"alias"},input:{type:"text",name:"alias",id:"alias",value:this.values?this.values.alias:""},error:this.errors&&this.errors.alias,message:this.errors&&this.errors.alias?this.errors.alias:""}),i=s.getField();return e.appendChild(i),e}showCategoriesInUse(){const e=document.querySelector("#cases-categories"),t=this.createCategoriesFragment();e.appendChild(t)}showCategoriesTable(){const e=document.querySelector("#cases-categories-table");this.table=new g({columns:this.columns,rows:this.categories,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateCategory.bind(this),delete:this.deleteCategory.bind(this),deleteSelected:this.deleteCategories.bind(this)})}createCategoriesFragment(){const e=document.createDocumentFragment();return this.categories.forEach((t=>{const s=this.createCategoryElement(t);e.appendChild(s)})),e}createCategoryElement(e){const t=document.createElement("a");t.href=`/casos/${e.alias}`;const s=document.createElement("span");s.textContent=e.name,t.appendChild(s);const i=l.get("arrowRight");return t.appendChild(i),t}},this.editor=new class{constructor(){this.post=null,this.categories=[],this.values={title:"",description:"",category_id:"",before_alt:"",after_alt:"",html:""},this.errors=null,this.previewBAF=!1,this.before=!1,this.after=!1,this.init()}async init(){document.querySelector("#cases-editor")&&(await this.loadCKEditor(),await this.readAllCategories(),await this.loadPost(),this.createEditorForm(),this.setFormEditorValues())}async loadCKEditor(){if(!document.querySelector('script[src="/build/js/vendor/ckeditor/ckeditor.js"]'))return new Promise(((e,t)=>{const s=document.createElement("script");s.src="/build/js/vendor/ckeditor/ckeditor.js",s.onload=e,s.onerror=t,document.body.appendChild(s)}))}createCKEditor(){return new Promise(((e,t)=>{ClassicEditor.create(html,{image:{toolbar:["imageStyle:inline","imageStyle:wrapText","imageStyle:breakText","|","toggleImageCaption","imageTextAlternative"]},extraPlugins:[C]}).then((t=>{this.editor=t,this.values.html&&this.editor.setData(this.values.html),e()})).catch((e=>{console.log(e),t()}))}))}async readAllCategories(){const e=await F.get("/api/admin/cases-categories");"error"!==e.status&&(this.categories=e.categories)}async loadPost(){const e=window.location.pathname.split("/").filter((e=>e));if(2===e.length)return;const t=e[2],s=await F.get(`/api/editor/cases/read/${t}`);"error"!==s.status&&(this.post=s.post,this.values={title:this.post.title,description:this.post.description,category_id:this.post.category_id,before_alt:this.post.images.before.alt,after_alt:this.post.images.after.alt,html:this.post.html})}async createEditorForm(){const e=document.querySelector("#cases-editor");this.formEditor=document.createElement("form"),this.formEditor.classList.add("mio-form"),this.formEditor.addEventListener("input",(e=>this.handleInput(e))),this.formEditor.addEventListener("submit",this.handleSubmit.bind(this)),e.appendChild(this.formEditor);const t=document.createElement("div");t.classList.add("col"),this.formEditor.appendChild(t);const s=document.createElement("h2");s.textContent="1. Título",t.appendChild(s);const i=document.createElement("p");i.textContent="Máximo 255 caracteres",t.appendChild(i);const a=new n({label:{text:"Título",for:"title"},input:{type:"text",name:"title",id:"title",maxlength:255,value:this.values.title},error:this.errors&&this.errors.title,message:this.errors&&this.errors.title?this.errors.title:"",callback:e=>{this.values.title=e,this.errors=null}});t.appendChild(a.getField());const r=document.createElement("div");r.classList.add("col"),this.formEditor.appendChild(r);const c=document.createElement("h2");c.textContent="2. Descripción",r.appendChild(c);const l=document.createElement("p");l.textContent="Máximo 255 caracteres",r.appendChild(l);const d=new o({label:{text:"Descripción",for:"description"},input:{name:"description",id:"description",rows:2,maxlength:255,value:this.values.description},error:this.errors&&this.errors.description,message:this.errors&&this.errors.description?this.errors.description:"",callback:e=>{this.values.description=e,this.errors=null}});r.appendChild(d.getField());const h=document.createElement("div");h.classList.add("col"),this.formEditor.appendChild(h);const p=document.createElement("h2");p.textContent="3. Categoría",h.appendChild(p);const u=document.createElement("p");u.textContent="Seleccionar la categoría a la que corresponde el post",h.appendChild(u);const m=new f({label:{text:"Categoría",for:"category_id"},select:{name:"category_id",id:"category_id"},option:{value:"id",text:"name"},options:this.categories,selected:this.values.category_id?{id:this.values.category_id}:null,error:this.errors&&this.errors.category_id,message:this.errors&&this.errors.category_id?this.errors.category_id:"",onSelect:e=>{this.values.category_id=e.id,this.errors=null}});h.appendChild(m.getField());const g=document.createElement("div");g.classList.add("row"),this.formEditor.appendChild(g);const b=document.createElement("div");b.classList.add("col"),g.appendChild(b);const v=document.createElement("h2");v.textContent="4. Imagen antes",b.appendChild(v);const w=document.createElement("p");w.textContent="Imagen antes. Recomendado 750px por 500px",b.appendChild(w),this.inputFileAfter&&this.inputFileAfter.getInput().files.length||(this.inputFileAfter=new E({label:{text:"Selecciona una imagen...",for:"before"},input:{name:"before",id:"before",accept:"image/jpeg, image/png"},error:this.errors&&this.errors.image?this.errors.image:"",callback:e=>{const t=this.inputFileAfter.getInput(),s=this.inputFileAfter.getLabel();this.previewImage(t,s,e)}})),b.appendChild(this.inputFileAfter.getField());const C=document.createElement("div");C.classList.add("col"),g.appendChild(C);const y=document.createElement("h2");y.textContent="5. Imagen después",C.appendChild(y);const L=document.createElement("p");L.textContent="Imagen después. Recomendado 750px por 500px",C.appendChild(L),this.inputFileBefore&&this.inputFileBefore.getInput().files.length||(this.inputFileBefore=new E({label:{text:"Selecciona una imagen...",for:"after"},input:{name:"after",id:"after",accept:"image/jpeg, image/png"},error:this.errors&&this.errors.image?this.errors.image:"",callback:e=>{const t=this.inputFileBefore.getInput(),s=this.inputFileBefore.getLabel();this.previewImage(t,s,e)}})),C.appendChild(this.inputFileBefore.getField());const x=document.createElement("div");x.classList.add("row"),this.formEditor.appendChild(x);const S=document.createElement("div");S.classList.add("before-alt"),x.appendChild(S);const k=document.createElement("h2");k.textContent="6. Descripción imagen antes",S.appendChild(k);const P=document.createElement("p");P.textContent="Descripción para imagen antes. Máximo 255 caracteres",S.appendChild(P);const F=new o({label:{text:"Descripción imagen antes",for:"before-alt"},input:{name:"before-alt",id:"before-alt",rows:2,maxlength:255,value:this.values.before_alt},error:this.errors&&this.errors.before_alt,message:this.errors&&this.errors.before_alt?this.errors.before_alt:"",callback:()=>{this.errors=null}});S.appendChild(F.getField());const A=document.createElement("div");A.classList.add("before-alt"),x.appendChild(A);const R=document.createElement("h2");R.textContent="7. Descripción imagen después",A.appendChild(R);const q=document.createElement("p");q.textContent="Descripción para imagen después. Máximo 255 caracteres",A.appendChild(q);const z=new o({label:{text:"Descripción imagen después",for:"after-alt"},input:{name:"after-alt",id:"after-alt",rows:2,maxlength:255,value:this.values.after_alt},error:this.errors&&this.errors.after_alt,message:this.errors&&this.errors.after_alt?this.errors.after_alt:"",callback:()=>{this.errors=null}});A.appendChild(z.getField());const T=document.createElement("div");T.classList.add("col"),this.formEditor.appendChild(T);const B=document.createElement("h2");B.textContent="8. Previsualización",T.appendChild(B);const D=document.createElement("p");D.textContent="Vista previa del deslizador antes y después",T.appendChild(D);const O=document.createElement("div");O.id="baf-preview",O.classList.add("field","baf-preview"),T.appendChild(O);const _=document.createElement("div");_.classList.add("col"),this.formEditor.appendChild(_);const N=document.createElement("h2");N.textContent="9. Contenido",_.appendChild(N);const I=document.createElement("p");I.textContent="Contenido principal del post",_.appendChild(I);const M=document.createElement("div");M.classList.add("field"),this.errors&&this.errors.html&&M.classList.add("error"),_.appendChild(M);const $=document.createElement("textarea");if($.id="html",$.name="html",M.appendChild($),await this.createCKEditor($),this.editor.model.document.on("change:data",(()=>{M.classList.remove("error"),M.querySelector(".error-message")&&M.querySelector(".error-message").remove(),this.values.html=this.editor.getData()})),this.post&&this.editor.setData(this.values.html),this.errors&&this.errors.image){const e=document.createElement("p");e.classList.add("error-message"),e.textContent=this.errors.html,M.appendChild(e)}const V=document.createElement("div");V.classList.add("field"),this.formEditor.appendChild(V);const H=document.createElement("input");H.type="submit",H.value=this.post?"Actualizar post":"Crear post",H.classList.add("btn","primary-btn"),V.appendChild(H)}async handleInput(e){const t=e.target,s=document.querySelector("#before"),i=document.querySelector("#after");if(this[t.name]=!0,s.value&&i.value&&!this.previewBAF){this.previewBAF=!0;const e=s.files[0],t=i.files[0],a=URL.createObjectURL(e),n=URL.createObjectURL(t);this.prevewBeforeAndAfter(a,n)}else if(this.isEdit()&&this.before&&this.after&&!this.previewBAF){if(this.previewBAF=!0,"before"===t.name){const e=this.post.images.after.src,t=s.files[0],i=URL.createObjectURL(t);this.prevewBeforeAndAfter(i,e)}if("after"===t.name){const e=this.post.images.before.src,t=i.files[0],s=URL.createObjectURL(t);this.prevewBeforeAndAfter(e,s)}}}async handleSubmit(e){e.preventDefault();const t=new FormData(e.currentTarget);t.append("html",this.editor.getData()),this.post&&t.append("id",this.post.id);const s=await F.post("/api/editor/cases/"+(this.post?"update":"create"),t);if("error"===s.status)return this.errors=s.errors,this.formEditor.remove(),void this.createEditorForm();await P.open({type:"success",title:`¡Post ${this.post?"actualizado":"creado"} correctamente!`,message:"Serás redirigido a los casos",timer:3e3}),window.location.href="/casos"}setFormEditorValues(){if(!this.isEdit())return;const e=document.querySelector("#before"),t=document.querySelector("label[for='before']"),s=this.post.images.before.src;this.before=!0,this.previewImage(e,t,s);const i=document.querySelector("#after"),a=document.querySelector("label[for='after']"),n=this.post.images.after.src;this.after=!0,this.previewImage(i,a,n),this.prevewBeforeAndAfter(s,n)}async previewImage(e,t,s){t.classList.add("hidden");const i=document.createElement("div");i.classList.add("image-preview"),e.parentElement.appendChild(i);const a=await this.createImage(s);i.appendChild(a);const n=document.createElement("button");n.classList.add("close"),n.type="button",n.addEventListener("click",(()=>{e.value="",t.classList.remove("hidden"),i.remove(),this.beforeAndAfter&&this.beforeAndAfter.destroy(),this.previewBAF=!1,this[e.name]=!1})),i.appendChild(n);const o=l.get("xLg");n.appendChild(o)}createImage(e,t=""){return new Promise(((s,i)=>{const a=new Image;a.src=e,a.alt=t,a.addEventListener("load",(()=>s(a))),a.addEventListener("error",(()=>i(new Error("Error loading image"))))}))}async prevewBeforeAndAfter(e,t){const s=await this.createImage(e),i=await this.createImage(t),a=document.querySelector("#baf-preview");this.beforeAndAfter=new y(a,s,i)}isEdit(){return window.location.pathname.split("/").filter((e=>e)).length>2}}}},new class{constructor(){this.patients=[],this.consents=[],this.doctors=[],this.patient=null,this.values={name:"",surname:"",phone:"",email:"",nif:"",birth_date:"",gender:"",meet:"",insurance:"",address:"",postcode:"",location:"",province:"",country:"",reason:"",medication:"",allergies:"",diseases:"",smoker:"",infectious:"",comment:"",signature:"",active:!0},this.errors=null,this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"surname",headerName:"Apellidos"},{field:"phone",headerName:"Telefono"}],this.consent={patient:null,doctor:null,representative:!1,representative_name:"",representative_nif:"",consent:null,signature:null},this.consentErrors=null,this.init()}async init(){const e=document.querySelector("#patients-table"),t=document.querySelector("#patients-search");e&&(await Promise.all([this.readAllPatients(),this.readAllConsents(),this.readAllDoctors()]),this.showPatientsTable(),document.querySelector("#patient-create").addEventListener("click",this.handleCreatePatient.bind(this))),t&&this.createSearch()}async readAllPatients(){const e=await F.get("/api/admin/patients");"error"!==e.status&&(this.patients=e.patients)}async readAllConsents(){const e=await F.get("/api/admin/consents");"error"!==e.status&&(this.consents=e.consents)}async readAllDoctors(){const e=await F.get("/api/admin/doctors");"error"!==e.status&&(this.doctors=e.doctors)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleCreatePatient(){this.modal=new b({title:"Crear paciente",customTitle:()=>{const e=document.createElement("img");return e.src="/build/img/varios/logo-blue.png",e.classList.add("custom-title"),e},content:this.createPatientForm(),action:"Guardar",maxWidth:"700px",fullscreenButton:!0,actionCallback:()=>this.createPatient(),closeCallback:()=>{this.resetValues(),this.errors=null,this.patient=null},fullscreenCallback:()=>{this.values.signature=this.signature.getBase64(),this.signature.resize(),this.modal.repaint(this.createPatientForm())}})}async createPatient(){this.values.signature=this.signature.getBase64();const e=await F.post("/api/admin/patients",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createPatientForm());await P.open({type:"success",title:"Paciente creado!",message:"El paciente ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.patient),this.resetValues(),this.errors=null}handleUpdatePatient(e){this.patient=e,this.setValues(e),e.consents.forEach((e=>{1===e.consent_id&&this.setValues(e.signature)})),this.modal=new b({title:"Actualizar paciente",content:this.createPatientForm(),action:"Actualizar",maxWidth:"700px",fullscreenButton:!0,actionCallback:()=>this.updatePatient(),closeCallback:()=>{this.resetValues(),this.errors=null,this.patient=null},fullscreenCallback:()=>{this.signature.resize()}})}async updatePatient(){const{signature:e,...t}=this.values;this.patient={...this.patient,...t},this.patient.consents.length>0?this.patient.consents.forEach((e=>{1===e.consent_id&&(e.signature.signature=this.signature.getBase64())})):this.patient.signature=this.signature.getBase64();const s=await F.put("/api/admin/patients",this.patient);if("error"===s.status)return this.errors=s.errors,void this.modal.repaint(this.createPatientForm());await P.open({type:"success",title:"¡Paciente actualizado!",message:"El paciente ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(s.patient),this.patient=null,this.resetValues(),this.errors=null}async updatePatientActive(){const e=await F.put("/api/admin/patients/active",this.patient);"error"!==e.status&&this.table.updateRow(e.patient)}async deletePatient(e){const t=new d({title:"¿Eliminar paciente?",description:"¿Estás seguro de eliminar esta paciente? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await F.delete("/api/admin/patients",s)).status&&(await P.open({type:"success",title:"Paciente eliminado!",message:"El paciente ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deletePatients(e){const t=new d({title:`¿Eliminar ${e.length>1?"pacientes":"paciente"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos pacientes":"esta paciente"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/patients/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Pacientes eliminados":"Paciente eliminado"}!`,message:(e.length>1?"Los pacientes han sido eliminados":"El paciente ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#patients-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar paciente",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createPatientForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=document.createElement("div");t.classList.add("mio-double"),e.appendChild(t);const s=new n({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values.name},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null}});t.appendChild(s.getField());const i=new n({label:{text:"Apellidos",for:"surname"},input:{type:"text",name:"surname",id:"surname",value:this.values.surname},callback:e=>{this.values.surname=e}});t.appendChild(i.getField());const a=document.createElement("div");a.classList.add("mio-double"),e.appendChild(a);const r=new n({label:{text:"Teléfono",for:"phone"},input:{type:"text",name:"phone",id:"phone",value:this.values.phone},callback:e=>{this.values.phone=e}});a.appendChild(r.getField());const c=new n({label:{text:"NIF",for:"nif"},input:{type:"text",name:"nif",id:"nif",value:this.values.nif},callback:e=>{this.values.nif=e}});a.appendChild(c.getField());const l=new n({label:{text:"Email",for:"email"},input:{type:"email",name:"email",id:"email",value:this.values.email},error:this.errors&&this.errors.email,message:this.errors&&this.errors.email?this.errors.email:"",callback:e=>{this.values.email=e}});e.appendChild(l.getField());const d=document.createElement("div");d.classList.add("mio-double"),e.appendChild(d);const h=new n({label:{text:"Fecha de nacimiento",for:"birth_date"},input:{type:"date",name:"birth_date",id:"birth_date",value:this.values.birth_date},callback:e=>{this.values.birth_date=e}});d.appendChild(h.getField());const p=new f({label:{text:"Género",for:"gender"},select:{name:"gender",id:"gender"},option:{value:"value",text:"text"},options:[{value:"male",text:"Hombre"},{value:"female",text:"Mujer"}],selected:this.values.gender?{value:this.values.gender}:null,onSelect:e=>{this.values.gender=e.value}});d.appendChild(p.getField());const u=new f({label:{text:"¿Cómo nos ha conocido?",for:"meet"},select:{name:"meet",id:"meet"},option:{value:"value",text:"text"},options:[{value:"recommendation",text:"Recomendación"},{value:"social-media",text:"Redes sociales"},{value:"web",text:"Web"},{value:"street",text:"Calle"},{value:"insurance",text:"Seguro"},{value:"other",text:"Otro"}],selected:this.values.meet?{value:this.values.meet}:null,onSelect:e=>{this.values.meet=e.value,this.modal.repaint(this.createPatientForm())}});if("insurance"===this.values.meet){const t=document.createElement("div");t.classList.add("mio-double"),e.appendChild(t),t.appendChild(u.getField());const s=new n({label:{text:"Seguro",for:"insurance"},input:{type:"text",name:"insurance",id:"insurance",value:this.values.insurance},callback:e=>{this.values.insurance=e}});t.appendChild(s.getField())}else e.appendChild(u.getField());const m=new n({label:{text:"Dirección",for:"address"},input:{type:"text",name:"address",id:"address",value:this.values.address},callback:e=>{this.values.address=e}});e.appendChild(m.getField());const g=document.createElement("div");g.classList.add("mio-double"),e.appendChild(g);const b=new n({label:{text:"Código postal",for:"postcode"},input:{type:"text",name:"postcode",id:"postcode",value:this.values.postcode},callback:e=>{this.values.postcode=e}});g.appendChild(b.getField());const v=new n({label:{text:"Localidad",for:"location"},input:{type:"text",name:"location",id:"location",value:this.values.location},callback:e=>{this.values.location=e}});g.appendChild(v.getField());const w=document.createElement("div");w.classList.add("mio-double"),e.appendChild(w);const C=new n({label:{text:"Provincia",for:"province"},input:{type:"text",name:"province",id:"province",value:this.values.province},callback:e=>{this.values.province=e}});w.appendChild(C.getField());const E=new n({label:{text:"País",for:"country"},input:{type:"text",name:"country",id:"country",value:this.values.country},callback:e=>{this.values.country=e}});w.appendChild(E.getField());const y=new o({label:{text:"Motivo de la consulta",for:"reason"},input:{name:"reason",id:"reason",rows:2,maxlength:255,value:this.values.reason},callback:e=>{this.values.reason=e}});e.appendChild(y.getField());const x=new o({label:{text:"Medicación",for:"medication"},input:{name:"medication",id:"medication",rows:2,maxlength:255,value:this.values.medication},callback:e=>{this.values.medication=e}});e.appendChild(x.getField());const S=new o({label:{text:"Alergias",for:"allergies"},input:{name:"allergies",id:"allergies",rows:2,maxlength:255,value:this.values.allergies},callback:e=>{this.values.allergies=e}});e.appendChild(S.getField());const k=new o({label:{text:"Enfermedades",for:"diseases"},input:{name:"diseases",id:"diseases",rows:2,maxlength:255,value:this.values.diseases},callback:e=>{this.values.diseases=e}});e.appendChild(k.getField());const P=document.createElement("div");P.classList.add("mio-double"),e.appendChild(P);const F=new f({label:{text:"Fumador",for:"smoker"},select:{name:"smoker",id:"smoker"},option:{value:"value",text:"text"},options:[{value:"1",text:"Sí"},{value:"0",text:"No"}],selected:""!==this.values.smoker?{value:this.values.smoker}:null,onSelect:e=>{this.values.smoker=e.value}});P.appendChild(F.getField());const A=new f({label:{text:"Enfermedades infecciosas",for:"infectious"},select:{name:"infectious",id:"infectious"},option:{value:"value",text:"text"},options:[{value:"none",text:"Ninguna"},{value:"hiv",text:"VIH - Sida"},{value:"tuberculosis",text:"Tuberculosis"},{value:"hepatitis_b",text:"Hepatitis B"},{value:"hepatitis_c",text:"Hepatitis C"},{value:"hepatitis_d",text:"Hepatitis D"},{value:"other",text:"Otras"}],selected:this.values.infectious?{value:this.values.infectious}:null,onSelect:e=>{this.values.infectious=e.value}});if(P.appendChild(A.getField()),this.patient){const t=new o({label:{text:"Comentario",for:"comment"},input:{name:"comment",id:"comment",rows:2,maxlength:255,value:this.values.comment},callback:e=>{this.values.comment=e}}).getField();e.appendChild(t)}const R=document.createElement("div");R.classList.add("mio-field"),e.appendChild(R),this.signature=new L({container:R,title:"Firma",clear:!0,signature:this.values.signature});const q=document.createElement("p");return q.classList.add("form-consent"),q.textContent=this.consents.find((e=>1===e.id)).description,e.appendChild(q),e}showPatientsTable(){const e=document.querySelector("#patients-table");this.table=new g({columns:this.columns,customColumns:[{field:"active",headerName:"Activo",content:this.createSwitchForm.bind(this)}],rows:this.patients,findFields:["name","surname","phone","email"],container:e,visibleRows:15,rowsPerPage:20,update:this.handleUpdatePatient.bind(this),delete:this.deletePatient.bind(this),deleteSelected:this.deletePatients.bind(this),showActionsMenu:!0,extraActions:[{name:"Consentimientos firmados",icon:l.get("fileCheck"),callback:this.handleConsentsAccepted.bind(this)},{name:"Crear consentimiento",icon:l.get("filePlus"),callback:this.handleCreateConsent.bind(this)},{name:"Historial médico",icon:l.get("clipboard2Pulse"),callback:this.handleManageHistory.bind(this)},{name:"Exportar a PDF",icon:l.get("filePDF"),callback:this.generatePatientPDF.bind(this)}],extraActionsMultipleSelect:[{name:"Enviar Email",icon:l.get("envelope"),callback:this.handleSendEmail.bind(this)}]})}createSwitchForm(e){const t=document.createElement("form");t.classList.add("mio-form");const s=new x({label:{text:"",for:"active"},input:{name:"active",id:"active",value:e.active},size:"small",callback:t=>{this.patient=e,this.patient.active=t,this.updatePatientActive()}});return t.appendChild(s.getField()),t}handleConsentsAccepted(e){this.patient=e,this.modal=new b({title:"Consentimientos firmados",content:this.createConsentsAccepted(),action:"Aceptar",maxWidth:"700px",fullscreenButton:!0,actionCallback:()=>{this.modal.close()},closeCallback:()=>{this.patient=null}})}createConsentsAccepted(){const e=document.createElement("div");return e.classList.add("consents"),this.patient.consents.forEach((t=>{const s=this.consents.find((e=>e.id===t.consent_id)),i=document.createElement("button");i.classList.add("consent-preview"),i.ariaLabel=s.name,i.addEventListener("click",(()=>{const{consents:e,...i}=this.patient,a={...t};a.consent=s,a.patient=i,a.doctor=this.doctors.find((e=>e.id===a.doctor_id)),a.created_at=p(a.created_at),this.generateConsentPDF(a)})),e.appendChild(i);const a=document.createElement("div");a.classList.add("icon"),i.appendChild(a);const n=l.get("filePDF");a.appendChild(n);const o=document.createElement("div");o.classList.add("text"),i.appendChild(o);const r=document.createElement("span");r.textContent=s.name,o.appendChild(r);const c=document.createElement("span");c.textContent=p(t.created_at),o.appendChild(c)})),e}async generateConsentPDF(e){const t=await F.post("/api/admin/consents/pdf",e),s=`data:application/pdf;base64,${t.base64}`,i=document.createElement("a"),a=t.fileName;i.href=s,i.download=a,i.click()}handleCreateConsent(e){this.consent.patient=e,this.createConsentModal=new b({title:"Crear consentimiento",content:this.createConsentForm(),action:"Guardar",maxWidth:"700px",fullscreenButton:!0,actionCallback:this.createConsent.bind(this),closeCallback:()=>{this.consent={patient:null,doctor:null,representative:!1,representative_name:null,representative_nif:null},this.consentErrors=null}})}async createConsent(){const e=await F.post("/api/admin/consents/accepted",this.consent);if("error"===e.status)return this.consentErrors=e.errors,void this.modal.repaint(this.createPatientForm());await P.open({type:"success",title:"¡Consentimiento creado!",message:"El consentimiento ha sido creado correctamente.",timer:3e3}),await this.createConsentModal.close(),this.table.updateRow(e.patient)}createConsentForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=document.createElement("div");t.classList.add("mio-double"),e.appendChild(t);const s=new n({label:{text:"Doctor",for:"doctor"},input:{name:"doctor",id:"doctor",type:"text",value:this.consent.doctor?this.consent.doctor.name+" "+this.consent.doctor.surname:""},error:this.consentErrors&&this.consentErrors.doctor,message:this.consentErrors&&this.consentErrors.doctor?this.consentErrors.doctor:"",callback:()=>{this.consentErrors=null}}).getField();t.appendChild(s),new S({target:s.querySelector("input"),data:this.doctors,findFields:["name","surname"],showFields:["name","surname"],size:6,callback:e=>{this.consent.doctor=e,this.createConsentModal.repaint(this.createConsentForm())}});const i=new n({label:{text:"Paciente",for:"patient"},input:{name:"patient",id:"patient",type:"text",value:this.consent.patient?this.consent.patient.name+" "+this.consent.patient.surname:""},error:this.consentErrors&&this.consentErrors.patient,message:this.consentErrors&&this.consentErrors.patient?this.consentErrors.patient:"",callback:()=>{this.consentErrors=null}}).getField();t.appendChild(i),new S({target:i.querySelector("input"),data:this.patients,findFields:["name","surname"],showFields:["name","surname"],size:6,callback:e=>{this.consent.patient=e,this.createConsentModal.repaint(this.createConsentForm())}});const a=new x({label:{text:"Representante legal",for:"representative"},input:{name:"representative",id:"representative",value:this.consent.representative},size:"small",callback:e=>{this.consent.representative=e,this.createConsentModal.repaint(this.createConsentForm())}});if(e.appendChild(a.getField()),this.consent.representative){const t=new n({label:{text:"Nombre del representante",for:"representative_name"},input:{name:"representative_name",id:"representative_name",type:"text",value:this.consent.representative_name},error:this.consentErrors&&this.consentErrors.representative_name,message:this.consentErrors&&this.consentErrors.representative_name?this.consentErrors.representative_name:"",callback:e=>{this.consent.representative_name=e,this.consentErrors=null}});e.appendChild(t.getField());const s=new n({label:{text:"NIF del representante",for:"representative_nif"},input:{name:"representative_nif",id:"representative_nif",type:"text",value:this.consent.representative_nif},error:this.consentErrors&&this.consentErrors.representative_nif,message:this.consentErrors&&this.consentErrors.representative_nif?this.consentErrors.representative_nif:"",callback:e=>{this.consent.representative_nif=e,this.consentErrors=null}});e.appendChild(s.getField())}const o=new f({label:{text:"Consentimientos",for:"consent"},select:{name:"consent",id:"consent"},option:{value:"id",text:"name"},options:this.consents.filter((e=>1!==e.id)),selected:this.consent.consent?{id:this.consent.consent.id}:null,error:this.consentErrors&&this.consentErrors.consent,message:this.consentErrors&&this.consentErrors.consent?this.consentErrors.consent:"",onSelect:e=>{this.consent.consent=e,this.consentErrors=null}});e.appendChild(o.getField());const r=document.createElement("div");r.classList.add("mio-field"),e.appendChild(r);const c=document.createElement("button");return c.classList.add("btn","tertiary-btn"),c.type="button",c.textContent="Firmar consentimiento",c.ariaLabel="Firma consentimiento",c.addEventListener("click",(()=>{let e=!1;this.consent.patient||(e=!0,this.consentErrors={...this.consentErrors,patient:"El paciente es obligatorio"}),this.consent.doctor||(e=!0,this.consentErrors={...this.consentErrors,doctor:"El doctor es obligatorio"}),this.consent.consent||(e=!0,this.consentErrors={...this.consentErrors,consent:"El consentimiento es obligatorio"}),this.consent.representative&&!this.consent.representative_name&&(e=!0,this.consentErrors={...this.consentErrors,representative_name:"El nombre del representante es obligatorio"}),this.consent.representative&&!this.consent.representative_nif&&(e=!0,this.consentErrors={...this.consentErrors,representative_nif:"El NIF del representante es obligatorio"}),e?this.createConsentModal.repaint(this.createConsentForm()):this.signConsentModal=new b({title:"Firmar consentimiento",customTitle:()=>{const e=document.createElement("img");return e.src="/build/img/varios/logo-blue.png",e.classList.add("custom-title"),e},content:this.createConsentSignForm(),action:"Guardar",maxWidth:"700px",fullscreenButton:!0,actionCallback:()=>{this.consent.signature=this.signature.getBase64(),this.signConsentModal.close()},closeCallback:()=>{},fullscreenCallback:()=>{this.signature.resize()}})})),r.appendChild(c),e}createConsentSignForm(){const{patient:e,doctor:t,consent:s,representative:i,representative_name:a,representative_nif:n,signature:o}=this.consent,r=document.createElement("div");r.classList.add("consent");const c=document.createElement("p");c.textContent=s.name,r.appendChild(c);const l=new Date;let d=s.description;d=i?d.replace("{intro}",`Yo ${a}, con DNI ${n} mayor de edad, en calidad de (representante legal) de ${e.name} ${e.surname} DECLARO:`):d.replace("{intro}",`Yo, ${e.name} ${e.surname} (como paciente), con DNI ${e.nif}, mayor de edad DECLARO:`),d=d.replace("{doctor}",t.name+" "+t.surname),d=d.replace("{date}",p(l));const h=document.createElement("p");h.textContent=d,r.appendChild(h);const u=document.createElement("div");return u.classList.add("mio-field"),r.appendChild(u),this.signature=new L({container:u,title:"Firma",clear:!0,signature:o&&o.signature?o.signature:o}),r}handleManageHistory(e){this.patient=structuredClone(e),this.history=new class{constructor({history:e,callback:t}){this.history=e,this.callback=t,this.columns=[{field:"date",headerName:"Fecha"},{field:"description",headerName:"Descripción"}],this.description="",this.create()}addReport(e){this.history.reports=[...this.history.reports,e]}updateReport(e){this.history.reports=this.history.reports.map((t=>t.id===e.id?e:t))}deleteReport(e){this.history.reports=this.history.reports.filter((t=>t.id!==e.id))}clearReports(){this.history.reports=[]}getHistory(){return this.history}getReports(){return this.history.reports}getHistoryEl(){return this.historyEl}create(){this.historyEl=document.createElement("div"),this.historyEl.classList.add("history");const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0,this.historyEl.appendChild(e),console.log(this.history.errors);const t=new o({label:{text:"Exploración y plan de tratamiento",for:"examination"},input:{name:"examination",id:"examination",rows:6,value:this.history.examination},error:this.history.errors?.examination,message:this.history.errors?.examination,callback:e=>{this.history.examination=e,this.history.errors=null}});e.appendChild(t.getField());const s=document.createElement("div");s.classList.add("wrapper"),this.historyEl.appendChild(s);const i=this.createTable();s.appendChild(i);const a=this.createAddRow();this.historyEl.appendChild(a)}repaint(){this.create()}createTable(){const e=document.createElement("table"),t=this.createThead();return e.appendChild(t),this.tbody=this.createTbody(),e.appendChild(this.tbody),e}createThead(){const e=document.createElement("thead"),t=document.createElement("tr");e.appendChild(t),this.columns.forEach((e=>{const s=document.createElement("th");s.textContent=e.headerName,t.appendChild(s)}));const s=document.createElement("th");return s.textContent="",t.appendChild(s),e}createTbody(){const e=document.createElement("tbody");return this.history.reports.sort(((e,t)=>new Date(e.date)-new Date(t.date))),this.history.reports.forEach((t=>{const s=this.createRow(t);e.appendChild(s)})),e}createRow(e){const t=document.createElement("tr"),s=document.createElement("td");t.appendChild(s);const i=document.createElement("input");e.errors&&e.errors.date&&i.classList.add("error"),i.type="date",i.name="date",i.value=e.date,i.placeholder="Fecha",i.addEventListener("input",(()=>{e.errors=null,e.date=i.value,i.classList.remove("error")})),s.appendChild(i);const a=document.createElement("td");t.appendChild(a);const n=document.createElement("input");e.errors&&e.errors.description&&n.classList.add("error"),n.type="text",n.name="description",n.value=e.description,n.placeholder="Descripción",n.readOnly=!0,n.addEventListener("click",(async()=>{e.errors=null,this.description=e.description,this.modal=new b({title:"Descripción",content:this.createDescriptionForm(),action:"Aceptar",maxWidth:"700px",fullscreenButton:!0,actionCallback:()=>{this.modal.close(),e.description=this.description,n.value=this.description,this.callback()},closeCallback:()=>{},fullscreenCallback:()=>{}})})),a.appendChild(n);const o=document.createElement("td");t.appendChild(o);const r=document.createElement("button");return r.type="button",r.ariaLabel="Eliminar",r.addEventListener("click",(()=>{this.deleteReport(e),this.callback()})),o.appendChild(r),r.appendChild(l.get("trash")),t}createAddRow(){const e=document.createElement("div");e.classList.add("row");const t=document.createElement("button");return t.type="button",t.ariaLabel="Añadir informe",t.textContent="Añadir informe",t.classList.add("btn","primary-btn"),t.addEventListener("click",(()=>{const e={id:crypto.randomUUID(),date:(new Date).toISOString().split("T")[0],description:"",errors:null};this.addReport(e);const t=this.createRow(e);this.tbody.appendChild(t)})),e.appendChild(t),e}createDescriptionForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new o({label:{text:"Descripción",for:"description"},input:{name:"description",id:"description",rows:20,value:this.description},callback:e=>{this.description=e}});return e.appendChild(t.getField()),e}}({history:this.patient.history||[],callback:()=>{this.history.repaint(),this.historyModal.repaint(this.history.getHistoryEl())}}),this.historyModal=new b({title:"Historial médico",content:this.history.getHistoryEl(),action:"Guardar cambios",maxWidth:"800px",fullscreenButton:!0,actionCallback:this.updateHistory.bind(this),closeCallback:()=>{},fullscreenCallback:()=>{}})}async updateHistory(){this.patient.history.reports=this.history.getReports();const e=await F.put("/api/admin/patients/history",this.patient);if("error"===e.status)return"history"===e.type&&(this.history.history.errors=e.errors),"reports"===e.type&&this.history.history.reports.forEach((t=>{e.errors.forEach((e=>{e.id===t.id&&(t.errors=e.errors)}))})),this.history.repaint(),void this.historyModal.repaint(this.history.getHistoryEl());await P.open({type:"success",title:"Historial actualizado!",message:"El historial ha sido actualziado correctamente.",timer:3e3}),await this.historyModal.close(),this.table.updateRow(e.patient)}async generatePatientPDF(e){this.patient=structuredClone(e);const t=await F.post("/api/admin/patients/pdf",this.patient),s=`data:application/pdf;base64,${t.base64}`,i=document.createElement("a"),a=t.fileName;i.href=s,i.download=a,i.click()}handleSendEmail(e){console.log(e);const t=document.createElement("div");t.textContent="Enviar email",this.modal=new b({title:"Enviar email",content:t,action:"Enviar",maxWidth:"700px",actionCallback:()=>{},closeCallback:()=>{}})}},new class{constructor(){this.treatments=[],this.treatment=null,this.values={name:"",description:"",price:""},this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"description",headerName:"Descripción"},{field:"price",headerName:"Precio"}],this.init()}async init(){const e=document.querySelector("#treatments-table"),t=document.querySelector("#treatments-search");e&&(await this.readAllTreatments(),this.showTreatmentsTable(),document.querySelector("#treatment-create").addEventListener("click",this.handleCreateTreatment.bind(this))),t&&this.createSearch()}async readAllTreatments(){const e=await F.get("/api/admin/treatments");"error"!==e.status&&(this.treatments=e.treatments)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleCreateTreatment(){this.modal=new b({title:"Crear tratamiento",content:this.createTreatmentForm(),action:"Crear",actionCallback:()=>this.createTreatment(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async createTreatment(){const e=await F.post("/api/admin/treatments",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createTreatmentForm());await P.open({type:"success",title:"Tratamiento creado!",message:"El tratamiento ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.treatment)}handleUpdateTreatment(e){this.treatment=e,this.setValues(e),this.modal=new b({title:"Actualizar tratamiento",content:this.createTreatmentForm(),action:"Actualizar",actionCallback:()=>this.updateTreatment(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async updateTreatment(){this.patient={id:this.treatment.id,...this.values};const e=await F.put("/api/admin/treatments",this.patient);if(console.log(e),"error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createTreatmentForm());await P.open({type:"success",title:"¡Tratamiento actualizado!",message:"El tratamiento ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.treatment)}async deleteTreatment(e){const t=new d({title:"¿Eliminar tratamiento?",description:"¿Estás seguro de eliminar esta tratamiento? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await F.delete("/api/admin/treatments",s)).status&&(await P.open({type:"success",title:"Tratamiento eliminado!",message:"El tratamiento ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteTreatments(e){const t=new d({title:`¿Eliminar ${e.length>1?"tratamientos":"tratamiento"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos tratamientos":"esta tratamiento"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/treatments/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Tratamientos eliminados":"Tratamiento eliminado"}!`,message:(e.length>1?"Los tratamientos han sido eliminados":"El tratamiento ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#treatments-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar tratamiento",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createTreatmentForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new n({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null}}).getField();e.appendChild(t);const s=new n({label:{text:"Descripción",for:"description"},input:{type:"text",name:"description",id:"description",value:this.values?this.values.description:""},callback:e=>{this.values.description=e}}).getField();e.appendChild(s);const i=new n({label:{text:"Precio",for:"price"},input:{type:"number",name:"price",id:"price",step:"0.01",value:this.values?this.values.price:""},error:this.errors&&this.errors.price,message:this.errors&&this.errors.price?this.errors.price:"",callback:e=>{this.values.price=e,this.errors=null}}).getField();return e.appendChild(i),e}showTreatmentsTable(){const e=document.querySelector("#treatments-table");this.table=new g({columns:this.columns,rows:this.treatments,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateTreatment.bind(this),delete:this.deleteTreatment.bind(this),deleteSelected:this.deleteTreatments.bind(this)})}},new class{constructor(){this.patients=[],this.budgets=[],this.budget={patient:null,comment:"Este presupuesto tiene una validez de 30 días naturales y puede variar por razón de los resultados de las pruebas radiológicas.",budgeteds:[],errors:null},this.init()}async init(){const e=document.querySelector("#budgets-table"),t=document.querySelector("#budgets-search");e&&(await this.readAllPatients(),await this.readAllBudgets(),this.showBudgetsTable(),document.querySelector("#budget-create").addEventListener("click",this.handleCreateBudget.bind(this))),t&&this.createSearch()}resetBudget(){this.budget={patient:null,comment:"",budgeteds:[],errors:null}}async readAllBudgets(){const e=await F.get("/api/admin/budgets");"error"!==e.status&&(this.budgets=e.budgets)}async readAllPatients(){const e=await F.get("/api/admin/patients");"error"!==e.status&&(this.patients=e.patients)}async handleCreateBudget(){this.budgeteds=new k({budgeteds:[...this.budget.budgeteds],callback:()=>{this.budgeteds.repaint(this.budgeteds.getBudgeteds()),this.modal.repaint(this.createBudgetForm())}}),await this.budgeteds.readAllTreatments(),this.budgeteds.show(),this.modal=new b({title:"Crear presupuesto",content:this.createBudgetForm(),action:"Crear",fullscreenButton:!0,actionCallback:()=>this.createBudget(),closeCallback:()=>{this.resetBudget()},maxWidth:"800px"})}async createBudget(){this.budget.budgeteds=this.budgeteds.getBudgeteds();const e=await F.post("/api/admin/budgets",this.budget);if("error"===e.status)return"budget"===e.type&&(this.budget.errors=e.errors),"budgeted"===e.type&&this.budget.budgeteds.forEach((t=>{e.errors.forEach((e=>{e.id===t.id&&(t.errors=e.errors)}))})),this.budgeteds.repaint(this.budgeteds.getBudgeteds()),void this.modal.repaint(this.createBudgetForm());await P.open({type:"success",title:"¡Presupuesto creado!",message:"El presupuesto ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.budget)}async handleUpdateBudget(e){this.budget=structuredClone(e),this.budgeteds=new k({budgeteds:this.budget.budgeteds,callback:()=>{this.budgeteds.repaint(this.budgeteds.getBudgeteds()),this.modal.repaint(this.createBudgetForm())}}),await this.budgeteds.readAllTreatments(),this.budgeteds.show(),this.modal=new b({title:"Actualizar presupuesto",content:this.createBudgetForm(),action:"Actualizar",fullscreenButton:!0,actionCallback:()=>this.updateBudget(),closeCallback:()=>{this.resetBudget()},maxWidth:"800px"})}async updateBudget(){this.budget.budgeteds=this.budgeteds.getBudgeteds();const e=await F.put("/api/admin/budgets",this.budget);if("error"===e.status)return"budget"===e.type&&(this.budget.errors=e.errors),"budgeted"===e.type&&this.budget.budgeteds.forEach((t=>{e.errors.forEach((e=>{e.id===t.id&&(t.errors=e.errors)}))})),this.budgeteds.repaint(this.budgeteds.getBudgeteds()),void this.modal.repaint(this.createBudgetForm());await P.open({type:"success",title:"¡Presupuesto actualizado!",message:"El presupuesto ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.budget)}async deleteBudget(e){const t=new d({title:"¿Eliminar presupuesto?",description:"¿Estás seguro de eliminar esta presupuesto? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/budgets",e)).status&&(await P.open({type:"success",title:"¡Presupuesto eliminado!",message:"El presupuesto ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteBudgets(e){const t=new d({title:`¿Eliminar ${e.length>1?"presupuestos":"presupuesto"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos presupuestos":"esta presupuesto"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/budgets/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Presupuestos eliminados":"Presupuesto eliminado"}!`,message:(e.length>1?"Los presupuestos han sido eliminados":"El presupuesto ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#budgets-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar presupuesto",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createBudgetForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new n({label:{text:"Paciente",for:"patient"},input:{type:"text",name:"patient",id:"patient",value:this.budget.patient?`${this.budget.patient.name} ${this.budget.patient.surname}`:""},error:this.budget.errors&&this.budget.errors.patient,message:this.budget.errors&&this.budget.errors.patient?this.budget.errors.patient:"",callback:()=>{this.budget.errors=null}}).getField();e.appendChild(t),new S({target:t.querySelector("input"),data:this.patients,findFields:["name","surname"],showFields:["name","surname"],size:6,callback:e=>{this.budget.patient=e}});const s=new o({label:{text:"Comentario",for:"comment"},input:{name:"comment",id:"comment",rows:3,value:this.budget.comment},callback:e=>{this.budget.comment=e}});return e.appendChild(s.getField()),e.appendChild(this.budgeteds.getBudgetedsEl()),e}showBudgetsTable(){const e=document.querySelector("#budgets-table");this.table=new g({columns:[{field:"id",headerName:"Id"},{field:"full_patient_name",headerName:"Paciente"},{field:"total",headerName:"Total"},{field:"created_at",headerName:"Fecha"}],rows:this.budgets,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateBudget.bind(this),delete:this.deleteBudget.bind(this),deleteSelected:this.deleteBudgets.bind(this),showActionsMenu:!0,extraActions:[{name:"Generar PDF",icon:l.get("filePDF"),callback:this.generatePDF.bind(this)},{name:"Crear factura",icon:l.get("fileText"),callback:this.createInvoice.bind(this)}]})}async generatePDF(e){const t=await F.post("/api/admin/budgets/pdf",e),s=`data:application/pdf;base64,${t.base64}`,i=document.createElement("a"),a=t.fileName;i.href=s,i.download=a,i.click()}async createInvoice(e){const t=await F.post("/api/admin/invoices",e);"error"!==t.status?await P.open({type:"success",title:"¡Factura creada!",message:"La factura ha sido creada correctamente.",timer:3e3}):await P.open({type:"error",title:"Error al crear la factura",message:t.message,timer:3e3})}dateFormat(){const e=new Date(date);return new Intl.DateTimeFormat("es-ES",{dateStyle:"short"}).format(e)}},new class{constructor(){this.invoices=[],this.invoice=null,this.values={number:"",created_at:""},this.init()}async init(){const e=document.querySelector("#invoices-table"),t=document.querySelector("#invoices-search");e&&(await this.readAllInvoices(),this.showInvoicesTable()),t&&this.createSearch()}async readAllInvoices(){const e=await F.get("/api/admin/invoices");console.log(e),"error"!==e.status&&(this.invoices=e.invoices)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleUpdateInvoice(e){this.invoice=e,this.setValues(e),this.modal=new b({title:"Actualizar factura",content:this.createInvoiceForm(),action:"Actualizar",actionCallback:()=>this.updateInvoice(),closeCallback:()=>this.resetValues()})}async updateInvoice(){this.invoice.number=this.values.number,this.invoice.created_at=this.values.created_at;const e=await F.put("/api/admin/invoices",this.invoice);if(console.log(e),"error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createInvoiceForm());await P.open({type:"success",title:"¡Factura actualizada!",message:"La factura ha sido actualziada correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.invoice)}async deleteInvoice(e){const t=new d({title:"¿Eliminar factura?",description:"¿Estás seguro de eliminar esta factura? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await F.delete("/api/admin/invoices",s)).status&&(await P.open({type:"success",title:"Factura eliminada!",message:"La factura ha sido eliminada correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteInvoices(e){const t=new d({title:`¿Eliminar ${e.length>1?"facturas":"factura"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estas facturas":"esta factura"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/invoices/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Facturas eliminadas":"Factura eliminada"}!`,message:(e.length>1?"Las facturas han sido eliminadas":"La factura ha sido eliminada")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#invoices-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar factura",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createInvoiceForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new n({label:{text:"Número de factura",for:"number"},input:{type:"text",name:"number",id:"number",value:this.values.number},error:this.errors&&this.errors.number,message:this.errors&&this.errors.number?this.errors.number:"",callback:e=>{this.values.number=e,this.errors=null}});e.appendChild(t.getField());const s=new n({label:{text:"Fecha de creación",for:"created_at"},input:{type:"date",name:"created_at",id:"created_at",value:this.values.created_at.split(" ")[0]},error:this.errors&&this.errors.created_at,message:this.errors&&this.errors.created_at?this.errors.created_at:"",callback:e=>{this.values.created_at=e,this.errors=null}});return e.appendChild(s.getField()),e}showInvoicesTable(){const e=document.querySelector("#invoices-table");this.table=new g({columns:[{field:"id",headerName:"Id"},{field:"number",headerName:"Número"},{field:"full_patient_name",headerName:"Paciente"},{field:"total",headerName:"Total"},{field:"created_at_format",headerName:"Fecha"}],rows:this.invoices,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateInvoice.bind(this),delete:this.deleteInvoice.bind(this),deleteSelected:this.deleteInvoices.bind(this),extraActions:[{name:"Generar PDF",icon:l.get("filePDF"),callback:this.generatePDF.bind(this)}]})}async generatePDF(e){const t=await F.post("/api/admin/invoices/pdf",e),s=`data:application/pdf;base64,${t.base64}`,i=document.createElement("a"),a=t.fileName;i.href=s,i.download=a,i.click()}},new class{constructor(){this.consents=[],this.consent=null,this.values={name:"",description:""},this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"}],this.init()}async init(){const e=document.querySelector("#consents-table"),t=document.querySelector("#consents-search");e&&(await this.readAllConsents(),this.showConsentsTable(),document.querySelector("#consent-create").addEventListener("click",this.handleCreateConsent.bind(this))),t&&this.createSearch()}async readAllConsents(){const e=await F.get("/api/admin/consents");"error"!==e.status&&(this.consents=e.consents)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleCreateConsent(){this.modal=new b({title:"Crear consentimiento",content:this.createConsentForm(),action:"Crear",maxWidth:"800px",actionCallback:()=>this.createConsent(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async createConsent(){const e=await F.post("/api/admin/consents",this.values);if(console.log(e),"error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createConsentForm());await P.open({type:"success",title:"Consentimiento creado!",message:"El consentimiento ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.consent)}handleUpdateConsent(e){this.consent=e,this.setValues(e),this.modal=new b({title:"Actualizar consentimiento",content:this.createConsentForm(),action:"Actualizar",maxWidth:"800px",actionCallback:()=>this.updateConsent(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async updateConsent(){this.patient={id:this.consent.id,...this.values};const e=await F.put("/api/admin/consents",this.patient);if(console.log(e),"error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createConsentForm());await P.open({type:"success",title:"¡Consentimiento actualizado!",message:"El consentimiento ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.consent)}async deleteConsent(e){const t=new d({title:"¿Eliminar consentimiento?",description:"¿Estás seguro de eliminar esta consentimiento? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await F.delete("/api/admin/consents",s)).status&&(await P.open({type:"success",title:"Consentimiento eliminado!",message:"El consentimiento ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteConsents(e){const t=new d({title:`¿Eliminar ${e.length>1?"consentimientos":"consentimiento"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos consentimientos":"esta consentimiento"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/consents/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Consentimientos eliminados":"Consentimiento eliminado"}!`,message:(e.length>1?"Los consentimientos han sido eliminados":"El consentimiento ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#consents-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar consentimiento",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createConsentForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new n({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null}}).getField();e.appendChild(t);const s=new o({label:{text:"Descripción",for:"description"},input:{name:"description",id:"description",rows:24,value:this.values?this.values.description:""},callback:e=>{this.values.description=e}}).getField();return e.appendChild(s),e}showConsentsTable(){const e=document.querySelector("#consents-table");this.table=new g({columns:this.columns,rows:this.consents,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateConsent.bind(this),delete:this.deleteConsent.bind(this),deleteSelected:this.deleteConsents.bind(this)})}},new class{constructor(){this.doctors=[],this.doctor=null,this.values={name:"",surname:"",email:"",phone:"",number:""},this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"surname",headerName:"Apellidos"},{field:"email",headerName:"Email"},{field:"phone",headerName:"Teléfono"}],this.init()}async init(){const e=document.querySelector("#doctors-table"),t=document.querySelector("#doctors-search");e&&(await this.readAllDoctors(),this.showDoctorsTable(),document.querySelector("#doctor-create").addEventListener("click",this.handleCreateDoctor.bind(this))),t&&this.createSearch()}async readAllDoctors(){const e=await F.get("/api/admin/doctors");"error"!==e.status&&(this.doctors=e.doctors)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleCreateDoctor(){this.modal=new b({title:"Crear doctor",content:this.createDoctorForm(),action:"Crear",actionCallback:()=>this.createDoctor(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async createDoctor(){const e=await F.post("/api/admin/doctors",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createDoctorForm());await P.open({type:"success",title:"Doctor creado!",message:"El doctor ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.doctor)}handleUpdateDoctor(e){this.doctor=e,this.setValues(e),this.modal=new b({title:"Actualizar doctor",content:this.createDoctorForm(),action:"Actualizar",actionCallback:()=>this.updateDoctor(),closeCallback:()=>{this.resetValues(),this.errors=null}})}async updateDoctor(){this.patient={id:this.doctor.id,...this.values};const e=await F.put("/api/admin/doctors",this.patient);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createDoctorForm());await P.open({type:"success",title:"¡Doctor actualizado!",message:"El doctor ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.doctor)}async deleteDoctor(e){const t=new d({title:"¿Eliminar doctor?",description:"¿Estás seguro de eliminar esta doctor? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await F.delete("/api/admin/doctors",s)).status&&(await P.open({type:"success",title:"Doctor eliminado!",message:"El doctor ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteDoctors(e){const t=new d({title:`¿Eliminar ${e.length>1?"doctores":"doctor"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos doctores":"esta doctor"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await F.delete("/api/admin/doctors/multiple",e)).status&&(await P.open({type:"success",title:`¡${e.length>1?"Doctores eliminados":"Doctor eliminado"}!`,message:(e.length>1?"Los doctores han sido eliminados":"El doctor ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#doctors-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new n({label:{text:"Buscar doctor",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createDoctorForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new n({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null}});e.appendChild(t.getField());const s=new n({label:{text:"Apellidos",for:"surname"},input:{type:"text",name:"surname",id:"surname",value:this.values?this.values.surname:""},error:this.errors&&this.errors.surname,message:this.errors&&this.errors.surname?this.errors.surname:"",callback:e=>{this.values.surname=e,this.errors=null}});e.appendChild(s.getField());const i=new n({label:{text:"Email",for:"email"},input:{type:"email",name:"email",id:"email",value:this.values?this.values.email:""},error:this.errors&&this.errors.email,message:this.errors&&this.errors.email?this.errors.email:"",callback:e=>{this.values.email=e,this.errors=null}});e.appendChild(i.getField());const a=new n({label:{text:"Teléfono",for:"phone"},input:{type:"text",name:"phone",id:"phone",value:this.values?this.values.phone:""},error:this.errors&&this.errors.phone,message:this.errors&&this.errors.phone?this.errors.phone:"",callback:e=>{this.values.phone=e,this.errors=null}});e.appendChild(a.getField());const o=new n({label:{text:"Número de colegiado",for:"number"},input:{type:"text",name:"number",id:"number",value:this.values?this.values.number:""},error:this.errors&&this.errors.number,message:this.errors&&this.errors.number?this.errors.number:"",callback:e=>{this.values.number=e,this.errors=null}});return e.appendChild(o.getField()),e}showDoctorsTable(){const e=document.querySelector("#doctors-table");this.table=new g({columns:this.columns,rows:this.doctors,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateDoctor.bind(this),delete:this.deleteDoctor.bind(this),deleteSelected:this.deleteDoctors.bind(this)})}}})();