(()=>{"use strict";var t={d:(e,s)=>{for(var i in s)t.o(s,i)&&!t.o(e,i)&&Object.defineProperty(e,i,{enumerable:!0,get:s[i]})},o:(e,t)=>Object.prototype.hasOwnProperty.call(e,t)};t.d({},{hi:()=>L,gk:()=>y});class s{constructor(){if(this.constructor===s)throw new TypeError("Abstract class 'Form' cannot be instantiated directly.")}getField(){return this.field}createField(){const e=document.createElement("div");return e.classList.add("mio-field"),this.input.value&&e.classList.add("active"),this.error&&e.classList.add("error"),e}createWrapper(){const e=document.createElement("div");return e.classList.add("mio-wrapper"),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-label"),e.textContent=this.label.text,e.htmlFor=this.label.for,e}createAdornment(){const e=document.createElement("div");return e.classList.add("mio-adornment"),e.appendChild(this.adornment),e}createMessage(){if(this.message)return this.messageEl=document.createElement("div"),this.messageEl.classList.add("mio-message"),this.error&&this.messageEl.classList.add("mio-error"),this.messageEl.textContent=this.message,this.messageEl}removeMessage(){this.messageEl&&(this.messageEl.remove(),this.error&&(this.field.classList.remove("error"),this.messageEl.classList.remove("mio-error")))}setValue(e){this.input.value=e,this.field.classList.add("active"),this.removeMessage()}handleBlur(e){e.target.value||this.field.classList.remove("active"),this.field.classList.remove("focus")}handleFocus(){this.field.classList.add("active"),this.field.classList.add("focus")}handleInput(e){this.removeMessage(),this.callback&&this.callback(e.target.value)}}const i=s,a=class extends i{constructor(e){super(e),Object.assign(this,e),this.init()}init(){this.field=this.create()}create(){const e=this.createField(),t=this.createWrapper();e.appendChild(t);const s=this.createLabel();if(t.appendChild(s),this.input=this.createInput(),t.appendChild(this.input),this.message){const t=this.createMessage();e.appendChild(t)}if(this.adornment){const e=this.createAdornment();t.appendChild(e)}return e}createInput(){const e=document.createElement("input");return e.classList.add("mio-input"),e.type=this.input.type,e.name=this.input.name,e.id=this.input.id,e.value=this.input.value??"",this.step&&(e.step=this.step),e.addEventListener("focus",this.handleFocus.bind(this)),e.addEventListener("blur",this.handleBlur.bind(this)),e.addEventListener("input",this.handleInput.bind(this)),e}},n=class extends i{constructor(e){super(e),Object.assign(this,e),this.init()}init(){this.field=this.create()}create(){const e=this.createField(),t=this.createWrapper();e.appendChild(t);const s=this.createLabel();t.appendChild(s);const i=this.createTextarea();if(t.appendChild(i),this.message){const t=this.createMessage();e.appendChild(t)}return e}createTextarea(){const e=document.createElement("textarea");return e.classList.add("mio-input"),e.name=this.input.name,e.id=this.input.id,e.rows=this.input.rows??"",e.value=this.input.value??"",this.input.maxlength&&(e.maxLength=this.input.maxlength),e.addEventListener("focus",this.handleFocus.bind(this)),e.addEventListener("blur",this.handleBlur.bind(this)),e.addEventListener("input",this.handleInput.bind(this)),e}},r=class extends i{constructor(e){super(e),Object.assign(this,e),this.init()}init(){this.field=this.create()}create(){const e=this.createField(),t=this.createWrapper();e.appendChild(t),this.checkbox=this.createCheckbox(),t.appendChild(this.checkbox);const s=this.createLabel();if(t.appendChild(s),this.message){const t=this.createMessage();e.appendChild(t)}return e}createCheckbox(){const e=document.createElement("input");return e.classList.add("mio-checkbox-input"),e.type="checkbox",e.name=this.input.name,e.id=this.input.id,this.input.value&&(e.checked=!0),e.addEventListener("change",(()=>{this.removeMessage(),this.callback(e.checked)})),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-checkbox-label"),e.textContent=this.label.text,e.htmlFor=this.label.for,e}},o=(()=>{const e=[{name:"pencilSquare",paths:[{d:"M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"},{fillRule:"evenodd",d:"M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"}]},{name:"search",paths:[{d:"M11.742 10.344a6.5 6.5 0 1 0-1.397 1.398h-.001c.03.04.062.078.098.115l3.85 3.85a1 1 0 0 0 1.415-1.414l-3.85-3.85a1.007 1.007 0 0 0-.115-.1zM12 6.5a5.5 5.5 0 1 1-11 0 5.5 5.5 0 0 1 11 0z"}]},{name:"trash",paths:[{d:"M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"},{fillRule:"evenodd",d:"M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"}]},{name:"chevronRight",paths:[{fillRule:"evenodd",d:"M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"}]},{name:"chevronDown",paths:[{fillRule:"evenodd",d:"M1.646 4.646a.5.5 0 0 1 .708 0L8 10.293l5.646-5.647a.5.5 0 0 1 .708.708l-6 6a.5.5 0 0 1-.708 0l-6-6a.5.5 0 0 1 0-.708z"}]},{name:"chevronLeft",paths:[{fillRule:"evenodd",d:"M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0"}]},{name:"chevronDoubleRight",paths:[{fillRule:"evenodd",d:"M3.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L9.293 8 3.646 2.354a.5.5 0 0 1 0-.708z"},{fillRule:"evenodd",d:"M7.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L13.293 8 7.646 2.354a.5.5 0 0 1 0-.708z"}]},{name:"chevronDoubleLeft",paths:[{fillRule:"evenodd",d:"M8.354 1.646a.5.5 0 0 1 0 .708L2.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"},{fillRule:"evenodd",d:"M12.354 1.646a.5.5 0 0 1 0 .708L6.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"}]},{name:"caretDownFill",paths:[{d:"M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"}]},{name:"xLg",paths:[{d:"M2.146 2.854a.5.5 0 1 1 .708-.708L8 7.293l5.146-5.147a.5.5 0 0 1 .708.708L8.707 8l5.147 5.146a.5.5 0 0 1-.708.708L8 8.707l-5.146 5.147a.5.5 0 0 1-.708-.708L7.293 8 2.146 2.854Z"}]},{name:"arrowRight",paths:[{fillRule:"evenodd",d:"M1 8a.5.5 0 0 1 .5-.5h11.793l-3.147-3.146a.5.5 0 0 1 .708-.708l4 4a.5.5 0 0 1 0 .708l-4 4a.5.5 0 0 1-.708-.708L13.293 8.5H1.5A.5.5 0 0 1 1 8z"}]},{name:"threeDots",paths:[{fillRule:"evenodd",d:"M3 9.5a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3zm5 0a1.5 1.5 0 1 1 0-3 1.5 1.5 0 0 1 0 3z"}]},{name:"filePDF",paths:[{d:"M4 0a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2V2a2 2 0 0 0-2-2H4zm0 1h8a1 1 0 0 1 1 1v12a1 1 0 0 1-1 1H4a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1z"},{d:"M4.603 12.087a.81.81 0 0 1-.438-.42c-.195-.388-.13-.776.08-1.102.198-.307.526-.568.897-.787a7.68 7.68 0 0 1 1.482-.645 19.701 19.701 0 0 0 1.062-2.227 7.269 7.269 0 0 1-.43-1.295c-.086-.4-.119-.796-.046-1.136.075-.354.274-.672.65-.823.192-.077.4-.12.602-.077a.7.7 0 0 1 .477.365c.088.164.12.356.127.538.007.187-.012.395-.047.614-.084.51-.27 1.134-.52 1.794a10.954 10.954 0 0 0 .98 1.686 5.753 5.753 0 0 1 1.334.05c.364.065.734.195.96.465.12.144.193.32.2.518.007.192-.047.382-.138.563a1.04 1.04 0 0 1-.354.416.856.856 0 0 1-.51.138c-.331-.014-.654-.196-.933-.417a5.716 5.716 0 0 1-.911-.95 11.642 11.642 0 0 0-1.997.406 11.311 11.311 0 0 1-1.021 1.51c-.29.35-.608.655-.926.787a.793.793 0 0 1-.58.029zm1.379-1.901c-.166.076-.32.156-.459.238-.328.194-.541.383-.647.547-.094.145-.096.25-.04.361.01.022.02.036.026.044a.27.27 0 0 0 .035-.012c.137-.056.355-.235.635-.572a8.18 8.18 0 0 0 .45-.606zm1.64-1.33a12.647 12.647 0 0 1 1.01-.193 11.666 11.666 0 0 1-.51-.858 20.741 20.741 0 0 1-.5 1.05zm2.446.45c.15.162.296.3.435.41.24.19.407.253.498.256a.107.107 0 0 0 .07-.015.307.307 0 0 0 .094-.125.436.436 0 0 0 .059-.2.095.095 0 0 0-.026-.063c-.052-.062-.2-.152-.518-.209a3.881 3.881 0 0 0-.612-.053zM8.078 5.8a6.7 6.7 0 0 0 .2-.828c.031-.188.043-.343.038-.465a.613.613 0 0 0-.032-.198.517.517 0 0 0-.145.04c-.087.035-.158.106-.196.283-.04.192-.03.469.046.822.024.111.054.227.09.346z"}]},{name:"fileText",paths:[{d:"M5 4a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm-.5 2.5A.5.5 0 0 1 5 6h6a.5.5 0 0 1 0 1H5a.5.5 0 0 1-.5-.5zM5 8a.5.5 0 0 0 0 1h6a.5.5 0 0 0 0-1H5zm0 2a.5.5 0 0 0 0 1h3a.5.5 0 0 0 0-1H5z"},{d:"M2 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V2zm10-1H4a1 1 0 0 0-1 1v12a1 1 0 0 0 1 1h8a1 1 0 0 0 1-1V2a1 1 0 0 0-1-1z"}]}];return{get:t=>{const s=e.find((e=>e.name===t));return s?(e=>{const t=document.createElementNS("http://www.w3.org/2000/svg","svg");return t.setAttribute("width","16px"),t.setAttribute("height","16px"),t.setAttribute("fill","currentColor"),t.setAttribute("viewBox","0 0 16 16"),t.setAttribute("xmlns","http://www.w3.org/2000/svg"),e.paths.forEach((e=>{const s=document.createElementNS("http://www.w3.org/2000/svg","path");e.fillRule&&s.setAttribute("fill-rule",e.fillRule),s.setAttribute("d",e.d),t.appendChild(s)})),t})(s):null}}})(),c=class{constructor({title:e,description:t,accept:s,cancel:i}){this.title=e,this.description=t,this.accept=s,this.cancel=i,this.init()}init(){this.show()}question(){return new Promise(((e,t)=>{this.dialog&&this.acceptButton&&this.cancelButton&&this.closeButton?(this.dialog.addEventListener("click",(()=>{e(null),this.close()})),this.acceptButton.addEventListener("click",(()=>{e(!0),this.close()})),this.cancelButton.addEventListener("click",(()=>{e(!1),this.close()})),this.closeButton.addEventListener("click",(()=>{e(null),this.close()}))):t("There was a problem creating the modal window!")}))}show(){const e=this.create();document.body.appendChild(e)}create(){this.dialog=document.createElement("div"),this.dialog.classList.add("confirm");const e=document.createElement("div");e.classList.add("content"),e.addEventListener("click",(e=>e.stopPropagation())),this.dialog.appendChild(e);const t=document.createElement("div");t.classList.add("header"),e.appendChild(t);const s=document.createElement("div");s.classList.add("title"),s.textContent=this.title,t.appendChild(s),this.closeButton=document.createElement("button"),this.closeButton.type="button",this.closeButton.classList.add("close"),t.appendChild(this.closeButton);const i=o.get("xLg");this.closeButton.appendChild(i);const a=document.createElement("div");a.classList.add("body"),e.appendChild(a);const n=document.createElement("div");n.classList.add("description"),n.textContent=this.description,a.appendChild(n);const r=document.createElement("div");return r.classList.add("footer"),e.appendChild(r),this.cancelButton=document.createElement("button"),this.cancelButton.type="button",this.cancelButton.classList.add("cancel"),this.cancelButton.textContent=this.cancel,r.appendChild(this.cancelButton),this.acceptButton=document.createElement("button"),this.acceptButton.type="button",this.acceptButton.classList.add("accept"),this.acceptButton.textContent=this.accept,r.appendChild(this.acceptButton),this.dialog}"rehabilitacion-oral-protesis-dentales";"rehabilitacion-oral-protesis-dentales";async close(){this.dialog.classList.add("fadeOut"),this.dialog.firstChild.classList.add("slideOutTop"),await this.animationend(this.dialog),this.dialog.remove()}async transitionend(e){return new Promise((t=>{e.addEventListener("transitionend",t,{once:!0})}))}async animationend(e){return new Promise((t=>{e.addEventListener("animationend",t,{once:!0})}))}},l=class{constructor(e,t,s,i){this.page=e,this.limit=t,this.total=s,this.url=i,5===this.limit?this.pages=Math.ceil(this.total/this.limit):this.pages=1+Math.ceil((this.total-5)/this.limit),this.pagination=[],this.init()}init(){this.setPagination(),this.showPagination()}setPagination(){if(this.pages>1){if(1===this.page?(this.pagination.push({type:"first",active:!1,page:""}),this.pagination.push({type:"prev",active:!1,page:""})):(this.pagination.push({type:"first",active:!0,page:1}),this.pagination.push({type:"prev",active:!0,page:this.page-1})),this.pages<8)for(let e=1;e<=this.pages;e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e});if(this.pages>=8){if(this.page<5)for(let e=1;e<=5&&!(e>this.pages);e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e});if(this.page>=5&&(this.pagination.push({type:"page",active:!0,page:1}),this.pagination.push({type:"dots"})),this.page>=5&&this.page<this.pages-3)for(let e=this.page-1;e<=this.page+1;e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e});if(this.page<this.pages-3&&(this.pagination.push({type:"dots"}),this.pagination.push({type:"page",active:!0,page:this.pages})),this.page>=this.pages-3)for(let e=this.pages-4;e<=this.pages&&!(e>this.pages);e++)this.page===e?this.pagination.push({type:"current",active:!1,page:e}):this.pagination.push({type:"page",active:!0,page:e})}this.page<this.pages?(this.pagination.push({type:"next",active:!0,page:this.page+1}),this.pagination.push({type:"last",active:!0,page:this.pages})):(this.pagination.push({type:"next",active:!1,page:""}),this.pagination.push({type:"last",active:!1,page:""}))}else this.pagination.push({type:"first",active:!1,page:""}),this.pagination.push({type:"prev",active:!1,page:""}),this.pagination.push({type:"next",active:!1,page:""}),this.pagination.push({type:"last",active:!1,page:""})}showPagination(){const e=document.querySelector("#pagination"),t=this.createPagination();e.appendChild(t)}createPagination(){const e=document.createDocumentFragment();return this.pagination.forEach((t=>{const s=document.createElement("div");s.classList.add(t.type),s.classList.add(t.active?"active":"inactive"),e.appendChild(s);const i=document.createElement("a");1===t.page?i.href=`${this.url}`:i.href=`${this.url}/page/${t.page}`,s.appendChild(i),"first"===t.type&&i.appendChild(o.get("chevronDoubleLeft")),"prev"===t.type&&i.appendChild(o.get("chevronLeft")),"page"!==t.type&&"current"!==t.type||(i.textContent=t.page),"dots"===t.type&&i.appendChild(o.get("threeDots")),"next"===t.type&&i.appendChild(o.get("chevronRight")),"last"===t.type&&i.appendChild(o.get("chevronDoubleRight"))})),e}},d=e=>{const t=new Date(e);return new Intl.DateTimeFormat("es-ES",{dateStyle:"long"}).format(t)},h=e=>{const t="àáâäæãåāăąçćčđďèéêëēėęěğǵḧîïíīįìıİłḿñńǹňôöòóœøōõőṕŕřßśšşșťțûüùúūǘůűųẃẍÿýžźż·/_,:;",s=new RegExp(t.split("").join("|"),"g");return e.toString().toLowerCase().replace(/\s+/g,"-").replace(s,(e=>"aaaaaaaaaacccddeeeeeeeegghiiiiiiiilmnnnnoooooooooprrsssssttuuuuuuuuuwxyyzzz------".charAt(t.indexOf(e)))).replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").replace(/^-+/,"").replace(/-+$/,"")},p=class{constructor(e){this.columns=e.columns,this.rows=e.rows,this.copyRows=this.rows,this.findFields=e.findFields,this.container=e.container,this.visibleRows=e.visibleRows,this.rowsPerPage=e.rowsPerPage,this.update=e.update,this.delete=e.delete,this.deleteSelected=e.deleteSelected,this.extraActions=e.extraActions||[],this.selectedRows=[],this.sort=!1,this.sortColumn=null,this.page=1,this.pages=0,this.init()}init(){this.setPages(this.calculatePages()),this.createTable()}setRows(e){this.rows=e,this.destroy(),this.setPages(this.calculatePages()),this.createTable()}addRow(e){this.rows=[...this.rows,e],this.copyRows=this.rows,this.destroy(),this.setPages(this.calculatePages()),this.createTable()}updateRow(e){this.rows=this.rows.map((t=>t.id===e.id?e:t)),this.copyRows=this.rows,this.destroy(),this.setPages(this.calculatePages()),this.createTable()}deleteRow(e){this.rows=this.rows.filter((t=>t.id!==e.id)),this.copyRows=this.rows,this.clearSelectedRows(),this.setPages(this.calculatePages()),this.checkPage(),this.destroy(),this.createTable()}deleteRows(e){this.rows=this.rows.filter((t=>!e.some((e=>e.id===t.id)))),this.copyRows=this.rows,this.clearSelectedRows(),this.setPages(this.calculatePages()),this.checkPage(),this.destroy(),this.createTable()}searchRow(e){this.findFields?this.rows=this.copyRows.filter((t=>this.findFields.reduce(((e,s,i)=>i?e+" "+t[s]:t[s]),"").toLowerCase().includes(e.toLowerCase()))):this.rows=this.copyRows.filter((t=>Object.values(t).some((t=>t&&t.toString().toLowerCase().includes(e.toLowerCase()))))),this.clearSelectedRows(),this.setPages(this.calculatePages()),this.checkPage(),this.destroy(),this.createTable()}checkPage(){this.page>this.pages&&(this.page=this.pages)}setPages(e){this.pages=e}calculatePages(){return Math.ceil(this.rows.length/this.rowsPerPage)||1}clearSelectedRows(){this.selectedRows=[]}createTable(){this.table=document.createElement("div"),this.table.classList.add("table"),this.table.style.height=this.tableSizing().tableHeight+"px",this.container.appendChild(this.table);const e=document.createElement("div");e.style.height=this.tableSizing().wrapperHeight+"px",e.classList.add("wrapper"),this.table.appendChild(e);const t=document.createElement("table");e.appendChild(t);const s=this.createThead();t.appendChild(s);const i=this.createTbody();t.appendChild(i);const a=this.createFooter();this.table.appendChild(a)}tableSizing(){let e=0,t=0;return this.visibleRows>this.rowsPerPage&&(t=52*this.rowsPerPage+26+56,e=t+56),this.visibleRows<=this.rowsPerPage&&(t=52*this.visibleRows+26+56,e=t+56),{wrapperHeight:t,tableHeight:e}}createThead(){const e=document.createElement("thead"),t=document.createElement("tr");e.appendChild(t);const s=document.createElement("th");t.appendChild(s);const i=document.createElement("label");s.appendChild(i);const a=document.createElement("input");a.type="checkbox",this.selectedRows.length&&this.selectedRows.length===this.rows.length&&(a.checked=!0),a.addEventListener("change",this.handleCheckAll.bind(this)),i.appendChild(a),this.columns.forEach((e=>{const s=document.createElement("th");t.appendChild(s);const i=document.createElement("button");i.type="button",i.ariaLabel="Ordenar",i.addEventListener("click",this.handleSort.bind(this,e)),s.appendChild(i);const a=document.createElement("div");a.classList.add("name"),a.textContent=e.headerName,i.appendChild(a);const n=document.createElement("div");n.classList.add("sort","asc"),this.sortColumn===e&&this.sort&&(n.classList.remove("asc"),n.classList.add("asc")),this.sortColumn!==e||this.sort||(n.classList.remove("asc"),n.classList.add("desc")),i.appendChild(n);const r=this.createSortIcon();n.appendChild(r)}));const n=document.createElement("th");return n.textContent="Acciones",t.appendChild(n),e}createTbody(){const e=document.createElement("tbody");return this.rows.forEach(((t,s)=>{if(s<this.rowsPerPage*(this.page-1)||s>=this.rowsPerPage*this.page)return;const i=document.createElement("tr"),a=this.selectedRows.some((e=>e===t));a&&i.classList.add("selected"),i.addEventListener("click",this.handleRowClick.bind(this,t)),e.appendChild(i);const n=document.createElement("td");i.appendChild(n);const r=document.createElement("label");n.appendChild(r);const o=document.createElement("input");o.type="checkbox",a&&(o.checked=!0),o.addEventListener("change",this.handleCheck.bind(this,t)),o.addEventListener("click",(e=>e.stopPropagation())),r.appendChild(o),this.columns.forEach((e=>{const s=document.createElement("td");s.textContent=t[e.field],i.appendChild(s)}));const c=document.createElement("td");c.classList.add("actions"),i.appendChild(c);const l=document.createElement("div");c.appendChild(l);const d=document.createElement("button");d.type="button",d.ariaLabel="Editar",d.addEventListener("click",this.handleUpdate.bind(this,t)),l.appendChild(d);const h=this.createEditIcon();d.appendChild(h);const p=document.createElement("button");p.type="button",p.ariaLabel="Eliminar",p.addEventListener("click",this.handleDelete.bind(this,t)),l.appendChild(p);const u=this.createDeleteIcon();p.appendChild(u),this.extraActions&&this.extraActions.forEach((e=>{const s=document.createElement("button");s.type="button",s.ariaLabel=e.name,s.addEventListener("click",(s=>{s.stopPropagation(),e.callback(t)})),l.appendChild(s),s.appendChild(e.icon.cloneNode(!0))}))})),e}createFooter(){const e=document.createElement("div");e.classList.add("footer");const t=document.createElement("div");t.classList.add("col-left"),e.appendChild(t);const s=document.createElement("div");if(s.classList.add("selected-rows"),this.selectedRows.length&&1===this.selectedRows.length&&(s.textContent="1 fila seleccionada"),this.selectedRows.length&&this.selectedRows.length>1&&(s.textContent=this.selectedRows.length+" filas seleccionadas"),t.appendChild(s),this.selectedRows.length){const e=document.createElement("button");e.type="button",e.ariaLabel="Eliminar seleccionadas",e.addEventListener("click",this.handleDeleteSelected.bind(this)),t.appendChild(e);const s=this.createDeleteIcon();e.appendChild(s)}const i=document.createElement("div");i.classList.add("col-right"),e.appendChild(i);const a=document.createElement("div");a.classList.add("rows");let n="";this.rows.length?n+=(this.page-1)*this.rowsPerPage+1+"-":n+="0-",this.page*this.rowsPerPage>this.rows.length?n+=this.rows.length+" de "+this.rows.length:n+=this.page*this.rowsPerPage+" de "+this.rows.length,a.textContent=n,i.appendChild(a);const r=document.createElement("div");r.classList.add("pagination"),i.appendChild(r);const o=document.createElement("button");o.type="button",o.ariaLabel="Anterior",this.page<=1&&(o.disabled=!0),o.addEventListener("click",this.handlePrev.bind(this)),r.appendChild(o);const c=this.createPrevIcon();o.appendChild(c);const l=document.createElement("button");l.type="button",l.ariaLabel="Siguiente",this.page>=this.pages&&(l.disabled=!0),l.addEventListener("click",this.handleNext.bind(this)),r.appendChild(l);const d=this.createNextIcon();return l.appendChild(d),e}handleCheckAll(e){const t=e.currentTarget.checked;this.table.querySelectorAll("tbody tr").forEach((e=>{e.querySelector("input[type=checkbox]").checked=t,t?e.classList.add("selected"):e.classList.remove("selected")})),this.selectedRows=t?this.rows:[],this.destroy(),this.createTable()}handleSort(e,t){t.currentTarget,this.sortColumn===e?this.sort=!this.sort:(this.sort=!0,this.sortColumn=e),this.rows.sort(((t,s)=>{const i=t[e.field],a=s[e.field];return this.sort?i>a?1:-1:i<a?1:-1})),this.destroy(),this.createTable()}handleCheck(e,t){const s=t.currentTarget,i=s.checked;s.parentNode.parentNode.parentNode.classList.toggle("selected"),this.selectedRows=i?[...this.selectedRows,e]:this.selectedRows.filter((t=>t!==e)),this.destroy(),this.createTable()}handleRowClick(e,t){const s=t.currentTarget;s.classList.toggle("selected");const i=s.querySelector("input[type=checkbox]");i.checked=!i.checked,i.checked?this.selectedRows=[...this.selectedRows,e]:this.selectedRows=this.selectedRows.filter((t=>t!==e)),this.destroy(),this.createTable()}handleUpdate(e,t){t.stopPropagation(),this.update(e)}handleDelete(e,t){t.stopPropagation(),this.delete(e)}handleDeleteSelected(e){e.stopPropagation(),this.deleteSelected(this.selectedRows)}handlePrev(){this.page--,this.destroy(),this.createTable()}handleNext(){this.page++,this.destroy(),this.createTable()}destroy(){this.table.remove()}createSortIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("fill-rule","evenodd"),t.setAttribute("d","M8 12a.5.5 0 0 0 .5-.5V5.707l2.146 2.147a.5.5 0 0 0 .708-.708l-3-3a.5.5 0 0 0-.708 0l-3 3a.5.5 0 1 0 .708.708L7.5 5.707V11.5a.5.5 0 0 0 .5.5z"),e.appendChild(t),e}createEditIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("fill-rule","evenodd"),t.setAttribute("d","M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"),e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("fill-rule","evenodd"),s.setAttribute("d","M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"),e.appendChild(s),e}createDeleteIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("fill-rule","evenodd"),t.setAttribute("d","M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"),e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("fill-rule","evenodd"),s.setAttribute("d","M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"),e.appendChild(s),e}createPrevIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("fill-rule","evenodd"),t.setAttribute("d","M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"),e.appendChild(t),e}createNextIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("fill-rule","evenodd"),t.setAttribute("d","M4.646 1.646a.5.5 0 0 1 .708 0l6 6a.5.5 0 0 1 0 .708l-6 6a.5.5 0 0 1-.708-.708L10.293 8 4.646 2.354a.5.5 0 0 1 0-.708z"),e.appendChild(t),e}},u=class{constructor({title:e,action:t,content:s,actionCallback:i,closeCallback:a,maxWidth:n}){this.title=e,this.content=s,this.action=t,this.actionCallback=i,this.closeCallback=a,this.maxWidth=n||null,this.isClose=!1,this.init()}async init(){this.modal=this.create(),document.body.classList.add("noscroll"),document.body.appendChild(this.modal),this.modal.classList.add("fade-in"),this.modal.firstChild.classList.add("slide-in-top"),await this.animationend()}handleClose(e){e.target===this.modal&&(this.isClose=!0)}async close(){this.modal.classList.add("fade-out"),this.modal.firstChild.classList.add("slide-out-top"),await this.animationend(this.modal),this.modal.remove(),document.querySelector(".modal")||document.body.classList.remove("noscroll"),this.closeCallback&&this.closeCallback()}async animationend(){return new Promise((e=>{this.modal.addEventListener("animationend",e,{once:!0})}))}create(){const e=document.createElement("div");e.classList.add("modal"),e.addEventListener("mousedown",this.handleClose.bind(this)),e.addEventListener("touchstart",this.handleClose.bind(this),{passive:!0}),e.addEventListener("click",(()=>{this.isClose&&this.close()}));const t=document.createElement("div");t.classList.add("content"),t.style.maxWidth=this.maxWidth?this.maxWidth:"",t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t);const s=document.createElement("div");s.classList.add("header"),t.appendChild(s);const i=document.createElement("div");i.classList.add("title"),i.textContent=this.title,s.appendChild(i);const a=document.createElement("button");a.classList.add("close"),a.setAttribute("aria-label","Cerrar modal"),a.addEventListener("click",(()=>{this.isClose=!0,this.close()})),s.appendChild(a);const n=o.get("xLg");a.appendChild(n);const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("width","16"),r.setAttribute("height","16"),r.setAttribute("fill","currentColor"),r.setAttribute("viewBox","0 0 16 16"),n.appendChild(r);const c=document.createElementNS("http://www.w3.org/2000/svg","path");c.setAttribute("fill-rule","evenodd"),c.setAttribute("d","M13.854 2.146a.5.5 0 0 1 0 .708l-11 11a.5.5 0 0 1-.708-.708l11-11a.5.5 0 0 1 .708 0Z"),r.appendChild(c);const l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("fill-rule","evenodd"),l.setAttribute("d","M2.146 2.146a.5.5 0 0 0 0 .708l11 11a.5.5 0 0 0 .708-.708l-11-11a.5.5 0 0 0-.708 0Z"),r.appendChild(l),this.body=document.createElement("div"),this.body.classList.add("body"),this.body.appendChild(this.content),t.appendChild(this.body);const d=document.createElement("div");d.classList.add("footer"),t.appendChild(d);const h=document.createElement("button");h.classList.add("btn","tertiary-btn"),h.setAttribute("aria-label","Cerrar modal"),h.textContent="Cerrar",h.addEventListener("click",(()=>{this.isClose=!0,this.close()})),d.appendChild(h);const p=document.createElement("button");return p.classList.add("btn","primary-btn"),p.setAttribute("aria-label","Acción modal"),p.textContent=this.action,p.addEventListener("click",this.actionCallback),d.appendChild(p),e}repaint(e){this.content=e,this.modal.remove(),this.modal=this.create(),document.body.appendChild(this.modal)}};class m{constructor(e,t){this.loader=e,this.url=`/api/editor/${t}/upload/image`}upload(){return this.loader.file.then((e=>new Promise(((t,s)=>{this._initRequest(),this._initListeners(t,s,e),this._sendRequest(e)}))))}abort(){this.xhr&&this.xhr.abort()}_initRequest(){const e=this.xhr=new XMLHttpRequest;e.open("POST",this.url,!0),e.responseType="json"}_initListeners(e,t,s){const i=this.xhr,a=this.loader,n=`No se ha podido subir la imagen: ${s.name}.`;i.addEventListener("error",(()=>t(n))),i.addEventListener("abort",(()=>t())),i.addEventListener("load",(()=>{const s=i.response;if(!s||"error"===s.response)return t(s&&"error"===s.response?s.response.msg:n);e({default:s.url})})),i.upload&&i.upload.addEventListener("progress",(e=>{e.lengthComputable&&(a.uploadTotal=e.total,a.uploaded=e.loaded)}))}_sendRequest(e){const t=new FormData;t.append("image",e),t.append("action","uploadImage"),this.xhr.send(t)}}function g(e){e.plugins.get("FileRepository").createUploadAdapter=e=>new m(e,"blog")}function b(e){e.plugins.get("FileRepository").createUploadAdapter=e=>new m(e,"cases")}const v=class extends i{constructor(e){super(e),Object.assign(this,e),this.activeOptions=!1,this.findText="",this.timeout=null,this.activeIndex=0,this.selectedIndex=0,this.init()}init(){window.addEventListener("resize",this.handleResize.bind(this)),window.addEventListener("scroll",this.handleResize.bind(this)),this.create()}handleResize(){this.customOptions&&this.position()}create(){this.field=this.createField();const e=this.createWrapper();if(this.field.appendChild(e),this.customSelect=this.createCustomSelect(),e.appendChild(this.customSelect),this.labelEl=this.createLabel(),e.appendChild(this.labelEl),this.selectEl=this.createSelect(),e.appendChild(this.selectEl),this.optionsEl=this.createOptions(),this.selectEl.appendChild(this.optionsEl),this.message){const e=this.createMessage();this.field.appendChild(e)}}createField(){const e=document.createElement("div");return e.classList.add("mio-field"),this.selected&&e.classList.add("active"),this.error&&e.classList.add("error"),e}createCustomSelect(){const e=document.createElement("div");e.classList.add("mio-input"),e.addEventListener("click",this.open.bind(this));const t=document.createElement("span");t.textContent="​",e.appendChild(t);const s=this.createAdornment();return e.appendChild(s),e}createAdornment(){const e=document.createElement("div");e.classList.add("mio-adornment");const t=new class{constructor({type:e,ariaLabel:t,buttonSize:s,svgSize:i,icon:a,callback:n}){this.type=e,this.ariaLabel=t,this.buttonSize=s,this.svgSize=i,this.icon=a,this.callback=n,this.init()}init(){this.iconButton=this.create()}get(){return this.iconButton}create(){const e=document.createElement("button");switch(e.type=this.type??"button",e.ariaLabel=this.ariaLabel??"",e.classList.add("mio-icon-btn"),this.buttonSize){case"small":e.classList.add("btn-size-small");break;case"medium":e.classList.add("btn-size-medium");break;case"large":e.classList.add("btn-size-large");break;case"xl":e.classList.add("btn-size-xl");break;default:e.classList.add("btn-medium-small")}switch(this.svgSize){case"xs":e.classList.add("svg-size-xs");break;case"small":e.classList.add("svg-size-small");break;case"medium":default:e.classList.add("svg-size-medium");break;case"large":e.classList.add("svg-size-large");break;case"xl":e.classList.add("svg-size-xl")}return e.addEventListener("click",(e=>{e.stopPropagation(),this.callback()})),e.appendChild(this.icon),e}}({type:"button",ariaLabel:"Button icon",buttonSize:"medium",svgSize:"xs",icon:this.createCaretDownFillIcon(),callback:()=>{this.open()}});return e.appendChild(t.get()),e}createLabel(){const e=document.createElement("label");return e.classList.add("mio-label"),e.textContent=this.label.text,e.htmlFor=this.label.for,e.addEventListener("click",this.open.bind(this)),e}createSelect(){const e=document.createElement("select");return e.name=this.select.name,e.id=this.select.id,e.addEventListener("focus",this.focusSelect.bind(this)),e.addEventListener("keydown",this.handleKeydown.bind(this)),e}createOptions(){const e=document.createDocumentFragment(),t=new Option;return e.appendChild(t),this.options.forEach(((t,s)=>{const i=new Option(t[this.option.text],t[this.option.value]);this.selected&&this.selected[this.option.value]===t[this.option.value]&&(i.selected=!0,this.field.classList.add("active"),this.selectOption(t,s)),e.appendChild(i)})),e}focusSelect(){this.selectEl.focus(),this.field.classList.add("active"),this.field.classList.add("focus")}blurSelect(){this.selectEl.blur(),this.selectedOption||this.field.classList.remove("active"),this.field.classList.remove("focus")}handleKeydown(e){switch(e.key){case"Tab":this.blurSelect(),this.closeCustomOptions();break;case"ArrowDown":this.activeOptions?(this.blurOption(),this.activeIndex=(this.activeIndex+1)%this.optionsNodes.childNodes.length,this.focusOption()):this.open();break;case"ArrowUp":this.activeOptions&&(this.blurOption(),this.activeIndex=(this.optionsNodes.childNodes.length+(this.activeIndex-1))%this.optionsNodes.childNodes.length,this.focusOption());break;case"Enter":this.activeOptions?(this.selectOption(this.options[this.activeIndex],this.activeIndex),this.closeCustomOptions()):this.open();break;default:this.findOption(e.key)}}async open(){this.activeOptions=!0,this.focusSelect(),this.customOptions=this.createCustomOptions(),this.position(),document.body.appendChild(this.customOptions),this.focusOption(),this.customOptions.classList.add("in")}async closeCustomOptions(){this.activeOptions=!1,this.activeIndex=this.selectedIndex,this.blurSelect(),this.customOptions.classList.add("out"),this.customOptions.remove()}createCustomOptions(){const e=document.createElement("div");e.classList.add("mio-options"),e.addEventListener("click",this.closeCustomOptions.bind(this));const t=document.createElement("div");return t.classList.add("content"),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t),this.optionsNodes=t,this.options.forEach(((e,s)=>{const i=document.createElement("div");i.classList.add("option"),e===this.selectedOption&&i.classList.add("selected"),s===this.activeIndex&&i.classList.add("focus"),i.addEventListener("click",(()=>{this.selectOption(e,s),this.closeCustomOptions()})),t.appendChild(i);const a=document.createElement("span");a.textContent=e[this.option.text],i.appendChild(a)})),e}position(){const e=this.field.getBoundingClientRect(),t=e.top+this.field.offsetHeight+2,s=e.left,i=this.field.offsetWidth,a=window.innerHeight>t+210;this.customOptions.firstChild.style.top=`${a?t:t+window.innerHeight-(t+210+10)}px`,this.customOptions.firstChild.style.left=`${s}px`,this.customOptions.firstChild.style.width=`${i}px`,this.customOptions.firstChild.style.maxHeight="210px"}focusOption(){this.optionsNodes.childNodes[this.activeIndex].scrollIntoView(!1),this.optionsNodes.childNodes[this.activeIndex].classList.add("focus")}blurOption(){this.optionsNodes.childNodes[this.activeIndex].classList.remove("focus")}selectOption(e,t){this.selectedOption=e,this.activeIndex=t,this.selectedIndex=t,this.selectEl.value=e[this.option.value],this.customSelect.firstElementChild.textContent=e[this.option.text],this.onSelect(e)}findOption(e){this.findText+=e,clearTimeout(this.timeout),this.timeout=setTimeout((()=>this.findText=""),500),this.options.forEach(((e,t)=>{const s=e[this.option.text].toLowerCase(),i=this.findText.toLowerCase();if(s.includes(i))return this.selectEl.options[t].selected=!0,this.blurOption(),this.selectOption(e,t),void this.focusOption()}))}async animationend(e){return new Promise((t=>{e.addEventListener("animationend",t,{once:!0})}))}createCaretDownFillIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z"),e.appendChild(t),e}},w=class{constructor(e){Object.assign(this,e),this.init()}init(){this.field=this.create()}getField(){return this.field}getInput(){return this.inputEl}getLabel(){return this.labelEl}getSrc(){const e=this.inputEl.files[0];return this.src=URL.createObjectURL(e),this.src}create(){const e=document.createElement("div");e.classList.add("field","file"),this.error&&e.classList.add("error"),this.labelEl=document.createElement("label"),this.labelEl.htmlFor=this.label.for,e.appendChild(this.labelEl);const t=this.createIcon();this.labelEl.appendChild(t);const s=document.createElement("span");return s.textContent="Selecciona una imagen...",this.labelEl.appendChild(s),this.inputEl=document.createElement("input"),this.inputEl.type="file",this.inputEl.id=this.input.id,this.inputEl.name=this.input.name,this.inputEl.accept=this.input.accept,this.inputEl.addEventListener("change",(()=>{this.error&&(e.classList.remove("error"),this.errorEl.remove()),this.callback(this.getSrc())})),e.appendChild(this.inputEl),this.error&&(this.errorEl=document.createElement("p"),this.errorEl.classList.add("error-message"),this.errorEl.textContent=this.error,e.appendChild(this.errorEl)),e}createIcon(){const e=document.createElement("figure"),t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.setAttribute("xmlns","http://www.w3.org/2000/svg"),t.setAttribute("width","20"),t.setAttribute("height","17"),t.setAttribute("fill","currentColor"),t.setAttribute("viewBox","0 0 20 17"),e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("d","M10 0l-5.2 4.9h3.3v5.1h3.8v-5.1h3.3l-5.2-4.9zm9.3 11.5l-3.2-2.1h-2l3.4 2.6h-3.5c-.1 0-.2.1-.2.1l-.8 2.3h-6l-.8-2.2c-.1-.1-.1-.2-.2-.2h-3.6l3.4-2.6h-2l-3.2 2.1c-.4.3-.7 1-.6 1.5l.6 3.1c.1.5.7.9 1.2.9h16.3c.6 0 1.1-.4 1.3-.9l.6-3.1c.1-.5-.2-1.2-.7-1.5z"),t.appendChild(s),e}},C=class{constructor(e,t,s){this.target=e,this.before=t,this.after=s,this.isStart=!1,this.isMove=!1,this.isOut=!1,this.initialPosX=0,this.currentPosX=0,this.finalPosX=0,this.moveX=0,this.init()}async init(){document.addEventListener("mouseup",this.end.bind(this)),document.addEventListener("touchend",this.end.bind(this)),this.target.appendChild(this.create())}handleClick(e){const t=e.currentTarget.getBoundingClientRect();this.currentPosX=e.clientX??e.touches[0].clientX;const s=t.left,i=this.currentPosX-s,a=this.beforeAndAfter.offsetWidth,n=a/2-i,r=(50*a-100*n)/a;this.before.style.clipPath=`polygon(0 0, ${r}% 0, ${r}% 100%, 0 100%)`,this.after.style.clipPath=`polygon(${r}% 0, 100% 0, 100% 100%, ${r}% 100%)`,this.handle.style.left=`${r}%`,this.finalPosX=n}start(e){this.isStart=!0,this.disableTransition(),this.initialPosX=e.clientX??e.touches[0].clientX,this.moveListener=this.move.bind(this),this.endListener=this.end.bind(this),document.addEventListener("mousemove",this.moveListener),document.addEventListener("touchmove",this.moveListener),document.addEventListener("mouseup",this.endListener),document.addEventListener("touchend",this.endListener)}move(e){if(!this.isStart)return;this.isMove=!0,this.currentPosX=e.clientX??e.touches[0].clientX,this.moveX=this.finalPosX+this.initialPosX-this.currentPosX;const t=this.beforeAndAfter.offsetWidth,s=(50*t-100*this.moveX)/t;return s<0?(this.moveX=t/2,this.before.style.clipPath="polygon(0 0, 0 0, 0 100%, 0 100%)",this.after.style.clipPath="polygon(0 0, 100% 0, 100% 100%, 0 100%)",void(this.handle.style.left="0")):s>100?(this.moveX=-t/2,this.before.style.clipPath="polygon(0 0, 100% 0, 100% 100%, 0 100%)",this.after.style.clipPath="polygon(100% 0, 100% 0, 100% 100%, 100% 100%)",void(this.handle.style.left="100%")):(this.before.style.clipPath=`polygon(0 0, ${s}% 0, ${s}% 100%, 0 100%)`,this.after.style.clipPath=`polygon(${s}% 0, 100% 0, 100% 100%, ${s}% 100%)`,void(this.handle.style.left=`${s}%`))}end(){this.isStart&&(this.finalPosX=this.moveX,this.isStart=!1,this.isMove=!1,this.enableTransition(),document.removeEventListener("mousemove",this.moveListener),document.removeEventListener("touchmove",this.moveListener),document.removeEventListener("mouseup",this.endListener),document.removeEventListener("touchend",this.endListener))}out(){this.isStart&&(this.isOut=!0)}create(){this.beforeAndAfter=document.createElement("div"),this.beforeAndAfter.classList.add("before-and-after"),this.before.style.clipPath="polygon(0 0, 50% 0, 50% 100%, 0 100%)",this.before.classList.add("before"),this.beforeAndAfter.appendChild(this.before),this.after.style.clipPath="polygon(50% 0, 100% 0, 100% 100%, 50% 100%)",this.after.classList.add("after"),this.beforeAndAfter.appendChild(this.after);const e=document.createElement("div");e.classList.add("overlay"),e.addEventListener("click",this.handleClick.bind(this)),this.beforeAndAfter.appendChild(e),this.handle=document.createElement("div"),this.handle.classList.add("handle"),this.handle.style.left="50%",this.handle.addEventListener("mousedown",this.start.bind(this)),this.handle.addEventListener("touchstart",this.start.bind(this),{passive:!0}),this.handle.addEventListener("mouseout",this.out.bind(this)),this.beforeAndAfter.appendChild(this.handle);const t=document.createElement("div");t.classList.add("circle"),this.handle.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","svg");s.setAttribute("xmlns","http://www.w3.org/2000/svg"),s.setAttribute("width","16"),s.setAttribute("height","16"),s.setAttribute("fill","currentColor"),s.setAttribute("viewBox","0 0 16 16"),t.appendChild(s);const i=document.createElementNS("http://www.w3.org/2000/svg","path");i.setAttribute("d","m3.86 8.753 5.482 4.796c.646.566 1.658.106 1.658-.753V3.204a1 1 0 0 0-1.659-.753l-5.48 4.796a1 1 0 0 0 0 1.506z"),s.appendChild(i);const a=document.createElementNS("http://www.w3.org/2000/svg","svg");a.setAttribute("xmlns","http://www.w3.org/2000/svg"),a.setAttribute("width","16"),a.setAttribute("height","16"),a.setAttribute("fill","currentColor"),a.setAttribute("viewBox","0 0 16 16"),t.appendChild(a);const n=document.createElementNS("http://www.w3.org/2000/svg","path");return n.setAttribute("d","m12.14 8.753-5.482 4.796c-.646.566-1.658.106-1.658-.753V3.204a1 1 0 0 1 1.659-.753l5.48 4.796a1 1 0 0 1 0 1.506z"),a.appendChild(n),this.beforeAndAfter}enableTransition(){this.before.classList.remove("notransition"),this.after.classList.remove("notransition"),this.handle.classList.remove("notransition")}disableTransition(){this.before.classList.add("notransition"),this.after.classList.add("notransition"),this.handle.classList.add("notransition")}destroy(){this.beforeAndAfter.remove()}},f=class{constructor(e){this.target=e.target,this.data=e.data,this.findFields=e.findFields,this.showFields=e.showFields,this.size=e.size,this.callback=e.callback,this.filteredData=[],this.autocomplete=null,this.search="",this.isSelect=!1,this.isClose=!1,this.init()}init(){window.addEventListener("resize",this.position.bind(this)),this.target.addEventListener("keyup",this.handleKeyup.bind(this))}getShowFields(){return this.showFields.reduce(((e,t,s)=>s?e+" "+row[t]:row[t]),"")}handleKeyup(e){this.search=e.target.value,this.autocomplete&&this.autocomplete.remove(),this.search.length<2?this.callback(null):(this.filterData(),0!==this.filteredData.length&&(this.show(),this.position()))}filterData(){this.filteredData=this.data.filter((e=>this.findFields.reduce(((t,s,i)=>i?t+" "+e[s]:e[s]),"").toLowerCase().includes(this.search.toLowerCase())))}show(){this.autocomplete=this.create(),document.body.appendChild(this.autocomplete)}create(){const e=document.createElement("div");e.classList.add("autocomplete"),e.addEventListener("mousedown",this.handleClose.bind(this)),e.addEventListener("touchstart",this.handleClose.bind(this)),e.addEventListener("click",(()=>{this.isClose&&this.close()}));const t=document.createElement("div");return t.classList.add("content"),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t),this.filteredData.forEach(((e,s)=>{const i=document.createElement("div");i.addEventListener("click",this.handleSelect.bind(this,e)),i.classList.add("item");const a=document.createElement("div");a.classList.add("search-icon"),i.appendChild(a);const n=this.createSearchIcon();a.appendChild(n);const r=document.createElement("span"),o=this.showFields.reduce(((t,s,i)=>i?t+" "+e[s]:e[s]),"");r.innerHTML=this.boldString(o,this.search),i.appendChild(r);const c=document.createElement("div");c.classList.add("arrow-icon"),i.appendChild(c);const l=this.createArrowIcon();c.appendChild(l),t.appendChild(i)})),e}handleSelect(e){this.isSelect=!0;const t=this.showFields.reduce(((t,s,i)=>i?t+" "+e[s]:e[s]),"");this.target.value=t,this.callback(e),this.close()}handleClose(e){e.target===this.autocomplete&&(this.isClose=!0)}position(){if(!this.autocomplete)return;const e=this.target.getBoundingClientRect();this.autocomplete.firstChild.style.top=`${e.top+this.target.offsetHeight}px`,this.autocomplete.firstChild.style.left=`${e.left}px`,this.autocomplete.firstChild.style.maxWidth=`${this.target.offsetWidth}px`,window.innerWidth<768?this.autocomplete.firstChild.style.maxHeight=44*this.size+20+"px":window.innerWidth>=768&&window.innerWidth<1024?this.autocomplete.firstChild.style.maxHeight=46*this.size+20+"px":this.autocomplete.firstChild.style.maxHeight=48*this.size+20+"px"}boldString(e,t){const s=e.toLowerCase().indexOf(t.toLowerCase());return-1===s?e:e.substring(0,s)+"<b>"+e.substring(s,s+t.length)+"</b>"+e.substring(s+t.length)}close(){this.isSelect||(this.target.value="",this.callback(null)),this.isSelect=!1,this.isClose=!1,this.autocomplete.remove()}createSearchIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","24"),e.setAttribute("height","24"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 24 24");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M21.71,20.29,18,16.61A9,9,0,1,0,16.61,18l3.68,3.68a1,1,0,0,0,1.42,0A1,1,0,0,0,21.71,20.29ZM11,18a7,7,0,1,1,7-7A7,7,0,0,1,11,18Z"),e.appendChild(t),e}createArrowIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");return t.setAttribute("d","M12 8a.5.5 0 0 1-.5.5H5.707l2.147 2.146a.5.5 0 0 1-.708.708l-3-3a.5.5 0 0 1 0-.708l3-3a.5.5 0 1 1 .708.708L5.707 7.5H11.5a.5.5 0 0 1 .5.5z"),e.appendChild(t),e}},E=class{constructor({budgeteds:e,callback:t}){this.budgeteds=e,this.callback=t,this.treatments=[],this.total=0,this.errors=[],this.id=1,this.targetFocus="",this.columns=[{field:"treatment_id",headerName:"Tratamiento"},{field:"piece",headerName:"Pieza"},{field:"unit_price",headerName:"Precio"},{field:"discount",headerName:"Dto."},{field:"total_price",headerName:"Total"}]}getBudgeteds(){return this.budgeteds}addBudgeted(e){this.budgeteds=[...this.budgeteds,e]}updateBudgeted(e){this.budgeteds=this.budgeteds.map((t=>t.id===e.id?e:t))}deleteBudgeted(e){this.budgeteds=this.budgeteds.filter((t=>t.id!==e.id))}clearBudgeteds(){this.budgeteds=[]}getBudgetedsEl(){return this.budgetedsEl}async readAllTreatments(){const e=await L.get("/api/admin/treatments");"error"!==e.status&&(this.treatments=e.treatments)}show(){this.budgetedsEl=document.createElement("div"),this.budgetedsEl.classList.add("budgeted");const e=document.createElement("div");e.classList.add("wrapper"),this.budgetedsEl.appendChild(e);const t=this.createTable();e.appendChild(t);const s=this.createAddRow();this.budgetedsEl.appendChild(s)}repaint(){this.show()}createTable(){const e=document.createElement("table"),t=this.createThead();e.appendChild(t),this.tbody=this.createTbody(),e.appendChild(this.tbody);const s=this.createTfoot();return e.appendChild(s),e}createThead(){const e=document.createElement("thead"),t=document.createElement("tr");e.appendChild(t),this.columns.forEach((e=>{const s=document.createElement("th");s.textContent=e.headerName,t.appendChild(s)}));const s=document.createElement("th");return s.textContent="",t.appendChild(s),e}createTbody(){const e=document.createElement("tbody");return this.budgeteds.forEach((t=>{const s=this.createRow(t);e.appendChild(s)})),e}createTfoot(){const e=document.createElement("tfoot"),t=document.createElement("tr");e.appendChild(t);const s=document.createElement("td");s.colSpan=this.columns.length-1,s.textContent="Total",t.appendChild(s);const i=document.createElement("td");return i.textContent=this.getTotal().toFixed(2).replace(".",","),t.appendChild(i),e}createRow(e){const t=document.createElement("tr"),s=document.createElement("td");t.appendChild(s);const i=document.createElement("input");e.errors&&i.classList.add("error"),i.type="text",i.name="treatment",i.value=e.treatment?e.treatment.name:"",i.placeholder="Tratamiento",i.addEventListener("input",(t=>{i.classList.remove("error"),o.classList.remove("error"),e.errors=null,this.targetFocus={budgeted:e,input:i,position:i.selectionStart}})),i.addEventListener("DOMNodeInsertedIntoDocument",(()=>{this.targetFocus&&this.targetFocus.budgeted===e&&this.targetFocus.input.isEqualNode(i)&&(i.focus(),i.setSelectionRange(this.targetFocus.position,this.targetFocus.position))})),s.appendChild(i),new f({target:i,data:this.treatments,findFields:["name","description"],showFields:["name"],size:6,callback:t=>{e.treatment=t,e.unit_price=t?t.price:null,o.value=t?t.price:"",h.value=this.getTotalTreatment(e).toFixed(2)}});const a=document.createElement("td");t.appendChild(a);const n=document.createElement("input");n.type="text",n.name="piece",n.value=e.piece?e.piece:"",n.placeholder="Pieza",n.readOnly=!0,n.addEventListener("click",(async()=>{this.pieces=new class{constructor({selectedPieces:e,selectedGroup:t,callback:s}){this.selectedPieces=e||[],this.selectedGroup=t||null,this.callback=s,this.pieces=[],this.groups=[],this.lines=[{class:"top"},{class:"bottom"},{class:"left"},{class:"right"}]}async init(){await Promise.all([this.readAllPieces(),this.readAllGroups()]),this.piecesEl=this.createPieces()}repaint(){this.piecesEl=this.createPieces()}setPieces(e){this.pieces=e}setGroups(e){this.groups=e}getPiecesEl(){return this.piecesEl}getSelectedPieces(){return this.selectedPieces}getSelectedGroup(){return this.selectedGroup}async readAllPieces(){const e=await L.get("/api/admin/pieces");"error"!==e.status&&this.setPieces(e.pieces)}async readAllGroups(){const e=await L.get("/api/admin/groups");"error"!==e.status&&this.setGroups(e.groups)}createPieces(){const e=document.createElement("div");return e.classList.add("pieces"),this.pieces.forEach((t=>{const s=document.createElement("button");s.classList.add("piece",t.class),this.selectedPieces.forEach((e=>{e.id===t.id&&s.classList.add("active")})),s.addEventListener("click",(()=>{this.selectedGroup&&(this.selectedPieces=[],this.selectedGroup=null);const e=this.selectedPieces.some((e=>e.id===t.id));this.selectedPieces=e?this.selectedPieces.filter((e=>e.id!==t.id)).sort():[...this.selectedPieces,t].sort(),this.repaint(),this.callback()})),e.appendChild(s);const i=document.createElementNS("http://www.w3.org/2000/svg","svg");i.setAttribute("viewBox",`0 0 ${t.width} ${t.height}`),i.setAttribute("width",t.width),i.setAttribute("height",t.height),i.setAttribute("fill","currentColor"),s.appendChild(i);const a=document.createElementNS("http://www.w3.org/2000/svg","g");a.setAttribute("transform",`translate(0, ${t.height}) scale(0.1, -0.1)`),i.appendChild(a);const n=document.createElementNS("http://www.w3.org/2000/svg","path");n.setAttribute("d",t.d),a.appendChild(n);const r=document.createElement("span");r.innerText=t.number,s.appendChild(r)})),this.groups.forEach((t=>{const s=document.createElement("button");s.classList.add("group",t.class),this.selectedGroup&&this.selectedGroup.id===t.id&&s.classList.add("active"),s.textContent=t.name,s.addEventListener("click",(()=>{this.selectedPieces=[],this.pieces.forEach((e=>{(e.number>=t.adult.from&&e.number<=t.adult.to||e.number>=t.child.from&&e.number<=t.child.to)&&(this.selectedPieces=[...this.selectedPieces,e].sort())})),this.selectedGroup=t,s.classList.add("active"),this.repaint(),this.callback()})),e.appendChild(s)})),this.lines.forEach((t=>{const s=document.createElement("div");s.classList.add("line",t.class),e.appendChild(s)})),e}}({selectedPieces:e.selectedPieces,selectedGroup:e.selectedGroup,callback:()=>{this.modal.repaint(this.pieces.getPiecesEl())}}),await this.pieces.init(),this.modal=new u({title:"Seleccionar piezas",content:this.pieces.getPiecesEl(),action:"Seleccionar",actionCallback:async()=>{const t=this.pieces.getSelectedPieces(),s=this.pieces.getSelectedGroup();e.selectedPieces=t,e.selectedGroup=s,e.piece=s?s.name:t.map((e=>e.number)).join(", "),await this.modal.close(),this.callback()}})})),a.appendChild(n);const r=document.createElement("td");t.appendChild(r);const o=document.createElement("input");e.errors&&o.classList.add("error"),o.type="text",o.name="price",o.step="0.01",o.placeholder="0,00",o.value=e.unit_price?e.unit_price:"",o.addEventListener("input",(()=>{o.classList.remove("error"),e.errors=null,e.treatment&&(e.unit_price=o.value),this.targetFocus={budgeted:e,input:o,position:o.selectionStart},this.callback()})),o.addEventListener("DOMNodeInsertedIntoDocument",(()=>{this.targetFocus&&this.targetFocus.budgeted===e&&this.targetFocus.input.isEqualNode(o)&&(o.focus(),o.setSelectionRange(this.targetFocus.position,this.targetFocus.position))})),r.appendChild(o);const c=document.createElement("td");t.appendChild(c);const l=document.createElement("input");l.type="text",l.name="discount",l.placeholder="0",l.value=e.discount?e.discount:"",l.addEventListener("input",(()=>{e.treatment&&(e.discount=l.value),this.targetFocus={budgeted:e,input:l,position:l.selectionStart},this.callback()})),l.addEventListener("DOMNodeInsertedIntoDocument",(()=>{this.targetFocus&&this.targetFocus.budgeted===e&&this.targetFocus.input.isEqualNode(l)&&(l.focus(),l.setSelectionRange(this.targetFocus.position,this.targetFocus.position))})),c.appendChild(l);const d=document.createElement("td");t.appendChild(d);const h=document.createElement("input");h.type="number",h.name="total",h.step="0.01",h.placeholder="0.00",h.value=this.getTotalTreatment(e).toFixed(2),h.disabled=!0,d.appendChild(h);const p=document.createElement("td");t.appendChild(p);const m=document.createElement("button");m.type="button",m.ariaLabel="Eliminar",m.addEventListener("click",(()=>{this.deleteBudgeted(e),this.callback()})),p.appendChild(m);const g=this.createDeleteIcon();return m.appendChild(g),t}getTotalTreatment(e){const t=e.unit_price?parseFloat(e.unit_price):0;return t-t*(e.discount?parseFloat(e.discount):0)/100}getTotal(){return this.budgeteds.reduce(((e,t)=>{const s=t.unit_price?parseFloat(t.unit_price):0;return e+s-s*(t.discount?parseFloat(t.discount):0)/100}),0)}createAddRow(){const e=document.createElement("div");e.classList.add("row");const t=document.createElement("button");return t.type="button",t.ariaLabel="Añadir tratamiento",t.textContent="Añadir tratamiento",t.classList.add("btn","primary-btn"),t.addEventListener("click",(()=>{const e={id:crypto.randomUUID(),treatment:null,piece:null,unit_price:null,discount:null,selectedPieces:[],selectedGroup:null};this.addBudgeted(e);const t=this.createRow(e);this.tbody.appendChild(t)})),e.appendChild(t),e}createDeleteIcon(){const e=document.createElementNS("http://www.w3.org/2000/svg","svg");e.setAttribute("width","16"),e.setAttribute("height","16"),e.setAttribute("fill","currentColor"),e.setAttribute("viewBox","0 0 16 16");const t=document.createElementNS("http://www.w3.org/2000/svg","path");t.setAttribute("fill-rule","evenodd"),t.setAttribute("d","M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"),e.appendChild(t);const s=document.createElementNS("http://www.w3.org/2000/svg","path");return s.setAttribute("fill-rule","evenodd"),s.setAttribute("d","M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"),e.appendChild(s),e}},y=new class{constructor(){this.popup,this.type,this.title,this.message,this.timer}setOptions(e){this.type=e.type,this.title=e.title,this.message=e.message,this.timer=e.timer}async open(e){this.setOptions(e),this.popup=this.createPopup(),document.body.appendChild(this.popup);const t=this.popup.getAnimations();await Promise.all(t.map((e=>e.finished))),this.timer&&(await new Promise((e=>setTimeout(e,this.timer))),await this.close(this.popup))}async close(){this.popup.classList.add("fadeOut"),this.popup.firstChild.classList.add("slideOutTop");const e=this.popup.getAnimations();return Promise.all(e.map((e=>e.finished))).then((()=>this.popup.remove()))}createPopup(){const e=document.createElement("div");e.classList.add("popup"),e.addEventListener("click",this.close.bind(this));const t=document.createElement("div");t.classList.add("content"),t.addEventListener("click",(e=>e.stopPropagation())),e.appendChild(t);const s=document.createElement("div");s.classList.add("header"),t.appendChild(s);const i=this.createIcon(this.type);s.appendChild(i);const a=document.createElement("div");if(a.classList.add("main"),t.appendChild(a),this.title){const e=document.createElement("div");e.classList.add("title"),e.textContent=this.title,a.appendChild(e)}if(this.message){const e=document.createElement("div");e.classList.add("message"),e.textContent=this.message,a.appendChild(e)}return e}createIcon(e){if("success"===e){const e=document.createElement("div");e.classList.add("animated-icon");const t=document.createElement("div");t.classList.add("success"),e.appendChild(t);const s=document.createElement("div");s.classList.add("line","tip"),t.appendChild(s);const i=document.createElement("div");i.classList.add("line","long"),t.appendChild(i);const a=document.createElement("div");a.classList.add("circle"),t.appendChild(a);const n=document.createElement("div");return n.classList.add("fix"),t.appendChild(n),e}if("error"===e){const e=document.createElement("div");e.classList.add("animated-icon");const t=document.createElement("div");t.classList.add("error"),e.appendChild(t);const s=document.createElement("div");s.classList.add("x"),t.appendChild(s);const i=document.createElement("div");i.classList.add("left"),s.appendChild(i);const a=document.createElement("div");a.classList.add("right"),s.appendChild(a);const n=document.createElement("div");n.classList.add("placeholder"),t.appendChild(n);const r=document.createElement("div");return r.classList.add("fix"),t.appendChild(r),e}}},L=new class{constructor(){this.config={headers:{Accept:"*/*"}}}async request(e){try{const t=await fetch(e,this.config);return await t.json()}catch(e){console.log(e)}}get(e){return this.config.method="GET",this.config.body=null,this.request(e)}post(e,t){return this.config.method="POST",this.config.body=this.isFormData(t)?t:JSON.stringify(t),this.request(e)}put(e,t){return this.config.method="PUT",this.config.body=this.isFormData(t)?t:JSON.stringify(t),this.request(e)}delete(e,t){return this.config.method="DELETE",this.config.body=this.isFormData(t)?t:JSON.stringify(t),this.request(e)}isFormData(e){return e instanceof FormData}};new class{constructor(){this.pageYOffset=0,this.isSidebarOpened=!1,this.isSidebarAnimated=!1,this.values={name:"",email:"",phone:"",message:"",accept:!1},this.errors=null,this.init()}init(){const e=document.querySelector("#hamburguer"),t=document.querySelector("#navbar"),s=document.querySelector("#sidebar"),i=document.querySelector("#accordion"),a=document.querySelector("#contact");window.addEventListener("DOMContentLoaded",this.loadEvent.bind(this)),window.addEventListener("scroll",this.scrollEvent.bind(this)),window.addEventListener("resize",this.resizeEvent.bind(this)),e.addEventListener("click",this.hamburguerEvent.bind(this)),t.addEventListener("click",this.navbarEvent.bind(this)),s.addEventListener("click",this.sidebarEvent.bind(this)),i&&i.addEventListener("click",this.accordionEvent.bind(this)),a&&this.createContactForm()}loadEvent(){const e=document.querySelector("#main-header");window.pageYOffset>0&&e.classList.add("active");const t=document.querySelector("#accordion");t&&t.querySelectorAll(".item").forEach((e=>{const t=e.firstElementChild,s=e.lastElementChild;new class{constructor(e,t,s){this.target=e,this.container=t,this.collapsed=s,this.type=s,this.start=!1,this.target&&this.target.addEventListener("click",this.toggle.bind(this))}async toggle(){this.setStart(!0),this.toggleClass(),this.collapsed?(this.setCollapsed(!1),await this.expandEl()):(this.setCollapsed(!0),await this.collapseEl()),this.heightAuto(),this.clean(),this.setStart(!1)}async expand(){this.setStart(!0),this.addClass(),this.setCollapsed(!1),await this.expandEl(),this.heightAuto(),this.clean(),this.setStart(!1)}async collapse(){this.setStart(!0),this.addClass(),this.setCollapsed(!0),await this.collapseEl(),this.heightAuto(),this.clean(),this.setStart(!1)}async expandEl(){return new Promise((e=>{this.container.style.height=this.container.scrollHeight+"px",this.container.addEventListener("transitionend",e,{once:!0})}))}async collapseEl(){return new Promise((e=>{requestAnimationFrame((()=>{this.container.style.height=this.container.scrollHeight+"px",requestAnimationFrame((()=>{this.container.style.height="0px"}))})),this.container.addEventListener("transitionend",e,{once:!0})}))}heightAuto(){this.type&&!this.collapsed&&(this.container.style.height="auto")}setStart(e){this.start=e}setCollapsed(e){this.collapsed=e}addClass(){this.target.classList.add("active")}removeClass(){this.target.classList.remove("active")}toggleClass(){this.target.classList.toggle("active")}clean(){(!this.type&&!this.collapsed||this.type&&this.collapsed)&&(this.container.removeAttribute("style"),""==this.target.className&&this.target.removeAttribute("class"))}}(t,s,!0)}))}scrollEvent(){const e=document.querySelector("#main-header");this.isSidebarOpened||"index"===e.dataset.page&&(window.pageYOffset>0?e.classList.remove("home"):e.classList.add("home"))}async resizeEvent(){const e=document.querySelector("#hamburguer"),t=document.querySelector("#main-header"),s=document.querySelector("#sidebar");if(window.innerWidth>=1024&&this.isSidebarOpened)return this.isSidebarOpened=!1,this.isSidebarAnimated=!0,document.body.removeAttribute("style"),document.body.classList.remove("noscroll"),window.scroll(0,this.pageYOffset),e.classList.remove("active"),t.classList.remove("active"),s.classList.add("out"),await this.animationend(s),s.classList.remove("active","in","out"),void(this.isSidebarAnimated=!1)}async hamburguerEvent(){const e=document.querySelector("#hamburguer"),t=document.querySelector("#main-header"),s=document.querySelector("#sidebar");return this.isSidebarOpened&&!this.isSidebarAnimated?(this.isSidebarOpened=!1,this.isSidebarAnimated=!0,document.body.removeAttribute("style"),document.body.classList.remove("noscroll"),window.scroll(0,this.pageYOffset),window.pageYOffset||t.classList.remove("active"),e.classList.remove("active"),s.classList.add("out"),await this.animationend(s),s.classList.remove("active","in","out"),this.isSidebarAnimated=!1,void(this.pageYOffset=0)):this.isSidebarOpened||this.isSidebarAnimated?void 0:(this.pageYOffset=window.pageYOffset,this.isSidebarOpened=!0,this.isSidebarAnimated=!0,document.body.style.top=`-${this.pageYOffset}px`,document.body.classList.add("noscroll"),e.classList.add("active"),t.classList.add("active"),s.classList.add("active","in"),await this.animationend(s),void(this.isSidebarAnimated=!1))}async navbarEvent(e){if(e.target.closest("button")){const t=e.target.closest("button"),s=t.nextElementSibling;requestAnimationFrame((()=>{s.classList.remove("hidden"),s.classList.add("flex"),requestAnimationFrame((()=>{s.classList.remove("out")}))})),s.classList.add("in"),await this.transitionend(s),t.ariaExpanded=!0}if(e.target.closest(".menu")){const t=e.target.closest(".menu"),s=t.previousElementSibling;t.classList.remove("in"),t.classList.add("out"),await this.transitionend(t),t.classList.remove("flex"),t.classList.add("hidden"),s.ariaExpanded=!1}}async sidebarEvent(e){const t=document.querySelector("#hamburguer"),s=document.querySelector("#main-header"),i=document.querySelector("#sidebar");"sidebar"===e.target.id&&this.isSidebarOpened&&!this.isSidebarAnimated&&(this.isSidebarOpened=!1,this.isSidebarAnimated=!0,document.body.removeAttribute("style"),document.body.classList.remove("noscroll"),window.scroll(0,this.pageYOffset),window.pageYOffset||s.classList.remove("active"),t.classList.remove("active"),i.classList.add("out"),await this.animationend(i),i.classList.remove("active","in","out"),this.isSidebarAnimated=!1)}async accordionEvent(e){const t=e.target.closest(".item");if(t&&t.firstElementChild.classList.contains("active")){const t=document.querySelector("#accordion").querySelectorAll(".item"),s=e.target.closest(".item");t.forEach((e=>{e!==s&&e.firstElementChild.classList.contains("active")&&e.firstElementChild.click()}))}}async transitionend(e){return new Promise((t=>{e.addEventListener("transitionend",t,{once:!0})}))}async animationend(e){return new Promise((t=>{e.addEventListener("animationend",t,{once:!0})}))}createContactForm(){const e=document.querySelector("#contact");this.contactForm=document.createElement("form"),this.contactForm.classList.add("mio-form"),this.contactForm.noValidate=!0,this.contactForm.addEventListener("submit",this.handleSubmit.bind(this)),e.appendChild(this.contactForm);const t=new a({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values.name},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null,console.log(this.values),console.log(this.errors)}});this.contactForm.appendChild(t.getField());const s=new a({label:{text:"Email",for:"email"},input:{type:"text",name:"email",id:"email",value:this.values.email},error:this.errors&&this.errors.email,message:this.errors&&this.errors.email?this.errors.email:"",callback:e=>{this.values.email=e,this.errors=null}});this.contactForm.appendChild(s.getField());const i=new a({label:{text:"Teléfono",for:"phone"},input:{type:"tel",phone:"phone",id:"phone",value:this.values.phone},error:this.errors&&this.errors.phone,message:this.errors&&this.errors.phone?this.errors.phone:"",callback:e=>{this.values.phone=e,this.errors=null}});this.contactForm.appendChild(i.getField());const o=new n({label:{text:"Mensaje",for:"message"},input:{name:"message",id:"message",rows:3,value:this.values.message},error:this.errors&&this.errors.message,message:this.errors&&this.errors.message?this.errors.message:"",callback:e=>{this.values.message=e,this.errors=null}});this.contactForm.appendChild(o.getField());const c=new r({label:{text:"He leído y acepto la Política de Privacidad",for:"accept"},input:{name:"accept",id:"accept",value:this.values.accept},error:this.errors&&this.errors.accept,message:this.errors&&this.errors.accept?this.errors.accept:"",callback:e=>{this.values.accept=e,this.errors=null}});this.contactForm.appendChild(c.getField());const l=document.createElement("div");l.classList.add("mio-field"),this.contactForm.appendChild(l);const d=document.createElement("button");d.classList.add("btn","primary-btn"),d.type="submit",d.textContent="Enviar",l.appendChild(d)}async handleSubmit(e){e.preventDefault();const t=await L.post("/api/contact",this.values);if("error"===t.status)return this.errors=t.errors,this.contactForm.remove(),void this.createContactForm();await y.open({type:"success",title:"¡Mensaje enviado!",message:"Gracias por contactar con nosotros. Nos pondremos en contacto contigo lo antes posible.",timer:3e3}),this.values={name:"",email:"",phone:"",message:"",accept:!1},this.errors=null,this.contactForm.remove(),this.createContactForm()}},new class{constructor(){this.post=new class{constructor(e){this.post=e||null,this.auth=!1,this.init()}async init(){document.querySelector("#blog-post")&&(await this.readPost(),this.showPost())}setPost(e){this.post=e}setAuth(e){this.auth=e}async readPost(){const e=window.location.pathname.split("/").pop(),t=await L.get(`/api/blog/post/${e}`);"error"!==t.status&&(this.setPost(t.post),this.setAuth(t.auth))}showPost(){const e=document.querySelector("#blog-post"),t=this.createPost();e.appendChild(t)}createPost(){const e=document.createElement("article"),t=document.createElement("header");e.appendChild(t);const s=document.createElement("h1");if(s.textContent=this.post.title,t.appendChild(s),this.auth){const e=document.createElement("div");e.classList.add("actions"),t.appendChild(e);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/blog/${this.post.alias}`,e.appendChild(s);const i=o.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,this.post)),e.appendChild(a);const n=o.get("trash");a.appendChild(n)}const i=document.createElement("div");return i.classList.add("body"),i.innerHTML=this.post.html,e.appendChild(i),e}async deletePost(e){const t=new c({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,image_id:e.image_id};"error"!==(await L.delete("/api/blog",s)).status&&(await y.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido al blog",timer:3e3}),window.location.href="/blog")}},this.posts=new class{constructor(){this.posts=[],this.latestPosts=[],this.page=1,this.limit=5,this.total=0,this.category="",this.search="",this.auth=!1,this.init()}async init(){document.querySelector("#blog-posts")&&(await this.readPosts(),this.showPosts()),document.querySelector("#blog-posts-by-category")&&(await this.readPostsByCategory(),this.showPostsByCategory()),document.querySelector("#blog-posts-by-search")&&(await this.readPostsBySearch(),this.showPostsBySearch()),document.querySelector("#blog-latest-posts")&&(await this.readLatestPosts(),this.showLatestPosts())}setPosts(e){this.posts=e}setLatestPosts(e){this.latestPosts=e}setPage(e){this.page=e}setLimit(e){this.limit=e}setCategory(e){this.category=e}setSearch(e){this.search=e}setAuth(e){this.auth=e}setTotal(e){this.total=e}updatePost(e){this.posts=this.posts.map((t=>t.id===e.id?e:t))}deletePost(e){this.posts=this.posts.filter((t=>t.id!==e.id))}clearPosts(){this.posts=[]}async readPosts(){const e=window.location.pathname.split("/"),t=e.includes("page")?Number(e.pop()):1;this.setPage(t),this.setLimit(1===t?5:6);const s={page:this.page,limit:this.limit},i=await L.post("/api/blog",s);"error"!==i.status&&(!i.posts.length&&this.page>1?window.location.href="/blog":(this.setPosts(i.posts),this.setTotal(i.total),this.setAuth(i.auth)))}async readPostsByCategory(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[2]:e.pop(),i=t?Number(e.pop()):1;this.setCategory(s),this.setPage(i),this.setLimit(1===i?5:6);const a={category:this.category,page:this.page,limit:this.limit},n=await L.post("/api/blog/category",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/blog/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}async readLatestPosts(){const e=await L.get("/api/blog/latest");"error"!==e.status&&(this.setLatestPosts(e.posts),this.setAuth(e.auth))}async readPostsBySearch(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[3]:e.pop(),i=t?Number(e.pop()):1;this.setSearch(s),this.setPage(i),this.setLimit(1===i?5:6);const a={search:s.split("+").join(" "),page:this.page,limit:this.limit},n=await L.post("/api/blog/search",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/blog/search/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}showPosts(){const e=document.querySelector("#blog-posts"),t=this.createPosts();e.appendChild(t),new l(this.page,this.limit,this.total,"/blog")}showPostsByCategory(){const e=document.querySelector("#blog-posts-by-category"),t=this.createPosts();e.appendChild(t),new l(this.page,this.limit,this.total,`/blog/${this.category}`)}showPostsBySearch(){const e=document.querySelector("#blog-posts-by-search"),t=this.createPosts();e.appendChild(t),new l(this.page,this.limit,this.total,`/blog/search/${this.search}`)}showLatestPosts(){const e=document.querySelector("#blog-latest-posts"),t=this.createLatestPosts();e.appendChild(t)}createPosts(){const e=document.createDocumentFragment();if(!this.posts.length){const t=document.createElement("p");t.textContent="No se encontraron posts",e.appendChild(t)}return this.posts.forEach(((t,s)=>{const i=this.createPost(t,s);e.appendChild(i)})),e}createPost(e,t){const s=document.createElement("article");1===this.page&&0===t&&s.classList.add("post-big");const i=document.createElement("div");i.classList.add("image"),s.appendChild(i);const a=document.createElement("img");a.src=`/build/img/blog/${e.src}`,a.alt=e.alt,i.appendChild(a);const n=document.createElement("h2");n.classList.add("title"),s.appendChild(n);const r=document.createElement("a");r.href=`/blog/${e.category_alias}/${e.alias}`,r.textContent=e.title,n.appendChild(r);const c=document.createElement("p");c.classList.add("description"),c.textContent=e.description,s.appendChild(c);const l=document.createElement("div");l.classList.add("row"),s.appendChild(l);const h=document.createElement("time");h.classList.add("date"),h.textContent=d(e.created_at),l.appendChild(h);const p=document.createElement("a");if(p.classList.add("author"),p.textContent=`By ${e.author}`,p.href="/blog",l.appendChild(p),this.auth){const t=document.createElement("div");t.classList.add("actions"),l.appendChild(t);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/blog/${e.alias}`,t.appendChild(s);const i=o.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,e)),t.appendChild(a);const n=o.get("trash");a.appendChild(n)}if(1===this.page&&0===t){const t=document.createElement("a");t.classList.add("read-more"),t.href=`/blog/${e.category_alias}/${e.alias}`,l.appendChild(t);const s=document.createElement("span");s.textContent="Leer más",t.appendChild(s);const i=o.get("arrowRight");t.appendChild(i)}return s}createLatestPosts(){const e=document.createDocumentFragment();return this.latestPosts.forEach(((t,s)=>{const i=this.createLatestPost(t,s);e.appendChild(i)})),e}createLatestPost(e){const t=document.createElement("a");t.href=`/blog/${e.category_alias}/${e.alias}`;const s=document.createElement("article");t.appendChild(s);const i=document.createElement("div");i.classList.add("row"),s.appendChild(i);const a=document.createElement("time");a.classList.add("date"),a.textContent=d(e.created_at),i.appendChild(a);const n=document.createElement("p");n.classList.add("author"),n.textContent=`By ${e.author}`,i.appendChild(n);const r=document.createElement("p");return r.classList.add("title"),r.textContent=e.title,s.appendChild(r),t}async deletePost(e){const t=new c({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,image_id:e.image_id};"error"!==(await L.delete("/api/blog",s)).status&&(await y.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido al blog",timer:3e3}),window.location.href="/blog")}},this.search=new class{constructor(){this.init()}init(){document.querySelector("#blog-search-form")&&this.createSearch()}createSearch(){const e=document.querySelector("#blog-search-form");e.addEventListener("submit",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t);const s=document.createElement("div");s.classList.add("field"),e.appendChild(s);const i=document.createElement("button");i.classList.add("btn","primary-btn"),i.type="submit",i.ariaLabel="Buscar",s.appendChild(i);const n=o.get("search");i.appendChild(n)}async handleSearch(e){e.preventDefault();const t=new FormData(e.target),s=Object.fromEntries(t).search.trim().toLowerCase().split(" ").join("+");window.location.href=`/blog/search/${s}`}},this.categories=new class{constructor(){this.categories=[],this.category=null,this.values={name:"",alias:""},this.errors=null,this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"alias",headerName:"Alias"}],this.init()}async init(){const e=document.querySelector("#blog-categories"),t=document.querySelector("#blog-categories-table"),s=document.querySelector("#blog-categories-search");e&&(await this.readCategoriesInUse(),this.showCategoriesInUse()),t&&(await this.readAllCategories(),this.showCategoriesTable(),document.querySelector("#blog-categories-create").addEventListener("click",this.handleCreateCategory.bind(this))),s&&this.createSearch()}async readCategoriesInUse(){const e=await L.get("/api/blog/categories");"error"!==e.status&&(this.categories=e.categories)}async readAllCategories(){const e=await L.get("/api/admin/blog-categories");"error"!==e.status&&(this.categories=e.categories)}resetValues(){this.values={name:"",alias:""}}handleCreateCategory(){this.modal=new u({title:"Crear categoría",content:this.createCategoryForm(),action:"Crear",actionCallback:()=>this.createCategory(),closeCallback:()=>this.resetValues()})}async createCategory(){const e=await L.post("/api/admin/blog-categories",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await y.open({type:"success",title:"¡Categoría creada!",message:"La categoría ha sido creada correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.category)}handleUpdateCategory(e){this.category=e,this.values={name:e.name,alias:e.alias},this.modal=new u({title:"Actualizar categoría",content:this.createCategoryForm(),action:"Actualizar",actionCallback:()=>this.updateCategory(),closeCallback:()=>this.resetValues()})}async updateCategory(){this.category={id:this.category.id,name:this.values.name,alias:this.values.alias};const e=await L.put("/api/admin/blog-categories",this.category);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await y.open({type:"success",title:"¡Categoría actualizada!",message:"La categoría ha sido actualziada correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.category)}async deleteCategory(e){const t=new c({title:"¿Eliminar categoría?",description:"¿Estás seguro de eliminar esta categoría? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await L.delete("/api/admin/blog-categories",s)).status&&(await y.open({type:"success",title:"¡Categoría eliminada!",message:"La categoría ha sido eliminada correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteCategories(e){const t=new c({title:`¿Eliminar ${e.length>1?"categorías":"categoría"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estas categorías":"esta categoría"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await L.delete("/api/admin/blog-categories/multiple",e)).status&&(await y.open({type:"success",title:`¡${e.length>1?"Categorías eliminadas":"Categoría eliminada"}!`,message:(e.length>1?"Las categorías han sido eliminadas":"La categoría ha sido eliminada")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#blog-categories-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar categoría",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createCategoryForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new a({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.values.alias=h(e),this.errors=null,s.setValue(this.values.alias)}}).getField();e.appendChild(t);const s=new a({label:{text:"Alias",for:"alias"},input:{type:"text",name:"alias",id:"alias",value:this.values?this.values.alias:""},error:this.errors&&this.errors.alias,message:this.errors&&this.errors.alias?this.errors.alias:""}),i=s.getField();return e.appendChild(i),e}showCategoriesInUse(){const e=document.querySelector("#blog-categories"),t=this.createCategoriesFragment();e.appendChild(t)}showCategoriesTable(){const e=document.querySelector("#blog-categories-table");this.table=new p({columns:this.columns,rows:this.categories,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateCategory.bind(this),delete:this.deleteCategory.bind(this),deleteSelected:this.deleteCategories.bind(this)})}createCategoriesFragment(){const e=document.createDocumentFragment();return this.categories.forEach((t=>{const s=this.createCategoryElement(t);e.appendChild(s)})),e}createCategoryElement(e){const t=document.createElement("a");t.href=`/blog/${e.alias}`;const s=document.createElement("span");s.textContent=e.name,t.appendChild(s);const i=o.get("arrowRight");return t.appendChild(i),t}},this.editor=new class{constructor(){this.post=null,this.categories=[],this.values={title:"",description:"",category_id:"",alt:"",html:""},this.errors=null,this.init()}async init(){document.querySelector("#blog-editor")&&(await this.loadCKEditor(),await this.readAllCategories(),await this.loadPost(),this.createEditorForm())}async loadCKEditor(){if(!document.querySelector('script[src="/build/js/vendor/ckeditor/ckeditor.js"]'))return new Promise(((e,t)=>{const s=document.createElement("script");s.src="/build/js/vendor/ckeditor/ckeditor.js",s.onload=e,s.onerror=t,document.body.appendChild(s)}))}async createCKEditor(e){return new Promise(((t,s)=>{ClassicEditor.create(e,{image:{toolbar:["imageStyle:inline","imageStyle:wrapText","imageStyle:breakText","|","toggleImageCaption","imageTextAlternative"]},extraPlugins:[g]}).then((e=>{this.editor=e,this.values.html&&this.editor.setData(this.values.html),t()})).catch((e=>{console.log(e),s()}))}))}async readAllCategories(){const e=await L.get("/api/admin/blog-categories");"error"!==e.status&&(this.categories=e.categories)}async loadPost(){const e=window.location.pathname.split("/").filter((e=>e));if(2===e.length)return;const t=e[2],s=await L.get(`/api/editor/blog/read/${t}`);"error"!==s.status&&(this.post=s.post,this.values={title:this.post.title,description:this.post.description,category_id:this.post.category_id,alt:this.post.alt,html:this.post.html})}async createEditorForm(){const e=document.querySelector("#blog-editor");this.formEditor=document.createElement("form"),this.formEditor.classList.add("mio-form"),this.formEditor.addEventListener("submit",this.handleSubmit.bind(this)),e.appendChild(this.formEditor);const t=document.createElement("div");t.classList.add("col"),this.formEditor.appendChild(t);const s=document.createElement("h2");s.textContent="1. Título",t.appendChild(s);const i=document.createElement("p");i.textContent="Máximo 255 caracteres",t.appendChild(i);const r=new a({label:{text:"Título",for:"title"},input:{type:"text",name:"title",id:"title",value:this.values.title},error:this.errors&&this.errors.title,message:this.errors&&this.errors.title?this.errors.title:"",callback:e=>{this.values.title=e,this.errors=null}});t.appendChild(r.getField());const o=document.createElement("div");o.classList.add("col"),this.formEditor.appendChild(o);const c=document.createElement("h2");c.textContent="2. Descripción",o.appendChild(c);const l=document.createElement("p");l.textContent="Máximo 255 caracteres",o.appendChild(l);const d=new n({label:{text:"Descripción",for:"description"},input:{name:"description",id:"description",rows:2,value:this.values.description},error:this.errors&&this.errors.description,message:this.errors&&this.errors.description?this.errors.description:"",callback:e=>{this.values.description=e,this.errors=null}});o.appendChild(d.getField());const h=document.createElement("div");h.classList.add("col"),this.formEditor.appendChild(h);const p=document.createElement("h2");p.textContent="3. Categoría",h.appendChild(p);const u=document.createElement("p");u.textContent="Seleccionar la categoría a la que corresponde el post",h.appendChild(u);const m=new v({label:{text:"Categoría",for:"category_id"},select:{name:"category_id",id:"category_id"},option:{value:"id",text:"name"},options:this.categories,selected:this.values.category_id?{id:this.values.category_id}:null,error:this.errors&&this.errors.category_id,message:this.errors&&this.errors.category_id?this.errors.category_id:"",onSelect:e=>{this.values.category_id=e.id,this.errors=null}});h.appendChild(m.getField());const g=document.createElement("div");g.classList.add("col"),this.formEditor.appendChild(g);const b=document.createElement("h2");b.textContent="4. Imagen miniatura",g.appendChild(b);const C=document.createElement("p");C.textContent="Imagen para las miniaturas. Recomendado 750px por 500px",g.appendChild(C),this.inputFile&&this.inputFile.getInput().files.length||(this.inputFile=new w({label:{text:"Selecciona una imagen...",for:"image"},input:{name:"image",id:"image",accept:"image/jpeg, image/png"},error:this.errors&&this.errors.image?this.errors.image:"",callback:e=>{this.previewImage(e)}})),g.appendChild(this.inputFile.getField());const f=document.createElement("div");f.classList.add("col"),this.formEditor.appendChild(f);const E=document.createElement("h2");E.textContent="5. Descripción imagen",f.appendChild(E);const y=document.createElement("p");y.textContent="Descripción para imagen principal. Máximo 255 caracteres",f.appendChild(y);const L=new n({label:{text:"Descripción imagen",for:"alt"},input:{name:"alt",id:"alt",rows:2,value:this.values.alt},error:this.errors&&this.errors.alt,message:this.errors&&this.errors.alt?this.errors.alt:"",callback:()=>{this.errors=null}});f.appendChild(L.getField());const x=document.createElement("div");x.classList.add("col"),this.formEditor.appendChild(x);const S=document.createElement("h2");S.textContent="6. Contenido",x.appendChild(S);const P=document.createElement("p");P.textContent="Contenido principal del post",x.appendChild(P);const A=document.createElement("div");A.classList.add("field"),this.errors&&this.errors.html&&A.classList.add("error"),x.appendChild(A);const F=document.createElement("textarea");if(F.id="html",F.name="html",A.appendChild(F),await this.createCKEditor(F),this.editor.model.document.on("change:data",(()=>{A.classList.remove("error"),A.querySelector(".error-message")&&A.querySelector(".error-message").remove(),this.values.html=this.editor.getData()})),this.post&&this.editor.setData(this.values.html),this.errors&&this.errors.html){const e=document.createElement("p");e.classList.add("error-message"),e.textContent=this.errors.html,A.appendChild(e)}const k=document.createElement("div");k.classList.add("field"),this.formEditor.appendChild(k);const q=document.createElement("input");q.type="submit",q.value=this.post?"Actualizar post":"Crear post",q.classList.add("btn","primary-btn"),k.appendChild(q)}async handleSubmit(e){e.preventDefault();const t=new FormData(e.currentTarget);t.append("html",this.editor.getData()),this.post&&t.append("id",this.post.id);const s=await L.post("/api/editor/blog/"+(this.post?"update":"create"),t);if("error"===s.status)return this.errors=s.errors,this.formEditor.remove(),void this.createEditorForm();await y.open({type:"success",title:`¡Post ${this.post?"actualizado":"creado"} correctamente!`,message:"Serás redirigido al blog",timer:3e3}),window.location.href="/blog"}async previewImage(e){const t=document.querySelector("#image"),s=document.querySelector("label[for='image']");s.classList.add("hidden");const i=document.createElement("div");i.classList.add("image-preview"),t.parentElement.appendChild(i);const a=await this.createImage(e);i.appendChild(a);const n=document.createElement("button");n.classList.add("close"),n.type="button",n.addEventListener("click",(()=>{t.value="",s.classList.remove("hidden"),i.remove()})),i.appendChild(n);const r=o.get("xLg");n.appendChild(r)}createImage(e,t=""){return new Promise(((s,i)=>{const a=new Image;a.src=e,a.alt=t,a.addEventListener("load",(()=>s(a))),a.addEventListener("error",(()=>i(new Error("Error loading image"))))}))}}}},new class{constructor(){this.values={email:"",password:""},this.errors=null,this.init()}init(){document.querySelector("#login")&&this.createLoginForm();const e=document.querySelector("#register-form");e&&e.addEventListener("submit",this.register.bind(this));const t=document.querySelector("#confirm");t&&t.addEventListener("click",this.confirm.bind(this));const s=document.querySelector("#recover-form");s&&s.addEventListener("submit",this.recover.bind(this));const i=document.querySelector("#restore-form");i&&i.addEventListener("submit",this.restore.bind(this))}createLoginForm(){const e=document.querySelector("#login");this.loginForm=document.createElement("form"),this.loginForm.classList.add("mio-form"),this.loginForm.noValidate=!0,this.loginForm.addEventListener("submit",this.login.bind(this)),e.appendChild(this.loginForm);const t=new a({label:{text:"Email",for:"email"},input:{type:"email",name:"email",id:"email",value:this.values?this.values.email:""},error:this.errors&&this.errors.email,message:this.errors&&this.errors.email?this.errors.email:"",callback:e=>{this.values.email=e,this.errors=null}}).getField();this.loginForm.appendChild(t);const s=new a({label:{text:"Contraseña",for:"password"},input:{type:"password",name:"password",id:"password",value:this.values?this.values.password:""},error:this.errors&&this.errors.password,message:this.errors&&this.errors.password?this.errors.password:"",callback:e=>{this.values.password=e,this.errors=null}}).getField();this.loginForm.appendChild(s);const i=document.createElement("input");i.type="submit",i.value="Iniciar sesión",i.classList.add("btn","primary-btn"),this.loginForm.appendChild(i)}repaintLoginForm(){this.loginForm.remove(),this.createLoginForm()}async login(e){e.preventDefault();const t=new FormData(e.currentTarget),s=await L.post("/api/user/login",t);if("error"===s.status)return this.errors=s.errors,void this.repaintLoginForm();await y.open({type:"success",title:"¡Login correcto!",message:"Serás redirigido al panel principal",timer:3e3}),window.location.href="/admin"}async register(){e.preventDefault(),new FormData(e.currentTarget),await L.post("/api/user/register")}async confirm(){const e=window.location.pathname.split("/").pop();(new FormData).append("token",e),await L.post("/api/user/confirm")}async recover(){(new FormData).append("token",token),await L.post("/api/user/recover")}async restore(){(new FormData).append("token",token),await L.post("/api/user/restore")}},new class{constructor(){this.post=new class{constructor(e){this.post=e||null,this.auth=!1,this.init()}async init(){document.querySelector("#cases-post")&&(await this.readPost(),this.showPost())}setPost(e){this.post=e}setAuth(e){this.auth=e}async readPost(){const e=window.location.pathname.split("/").pop(),t=await L.get(`/api/cases/post/${e}`);"error"!==t.status&&(this.setPost(t.post),this.setAuth(t.auth))}showPost(){const e=document.querySelector("#cases-post"),t=this.createPost();e.appendChild(t)}createPost(){const e=document.createElement("article"),t=document.createElement("header");e.appendChild(t);const s=document.createElement("h1");if(s.textContent=this.post.title,t.appendChild(s),this.auth){const e=document.createElement("div");e.classList.add("actions"),t.appendChild(e);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/casos/${this.post.alias}`,e.appendChild(s);const i=o.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,this.post)),e.appendChild(a);const n=o.get("trash");a.appendChild(n)}const i=document.createElement("div");i.classList.add("baf-container"),e.appendChild(i);const a=document.createElement("img");a.src=`/build/img/casos/${this.post.images.before.src}`,a.alt=this.post.images.before.alt;const n=document.createElement("img");n.src=`/build/img/casos/${this.post.images.after.src}`,n.alt=this.post.images.after.alt,this.beforeAndAfter=new C(i,a,n);const r=document.createElement("div");return r.classList.add("body"),r.innerHTML=this.post.html,e.appendChild(r),e}async deletePost(e){const t=new c({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,before_id:e.before_id,after_id:e.after_id};"error"!==(await L.delete("/api/blog",s)).status&&(await y.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido al blog",timer:3e3}),window.location.href="/blog")}},this.posts=new class{constructor(){this.posts=[],this.latestPosts=[],this.page=1,this.limit=5,this.total=0,this.category="",this.search="",this.auth=!1,this.init()}async init(){document.querySelector("#cases-posts")&&(await this.readPosts(),this.showPosts()),document.querySelector("#cases-posts-by-category")&&(await this.readPostsByCategory(),this.showPostsByCategory()),document.querySelector("#cases-posts-by-search")&&(await this.readPostsBySearch(),this.showPostsBySearch())}setPosts(e){this.posts=e}setLatestPosts(e){this.latestPosts=e}setPage(e){this.page=e}setLimit(e){this.limit=e}setCategory(e){this.category=e}setSearch(e){this.search=e}setAuth(e){this.auth=e}setTotal(e){this.total=e}updatePost(e){this.posts=this.posts.map((t=>t.id===e.id?e:t))}deletePost(e){this.posts=this.posts.filter((t=>t.id!==e.id))}clearPosts(){this.posts=[]}async readPosts(){const e=window.location.pathname.split("/"),t=e.includes("page")?Number(e.pop()):1;this.setPage(t),this.setLimit(1===t?5:6);const s={page:this.page,limit:this.limit},i=await L.post("/api/cases",s);"error"!==i.status&&(!i.posts.length&&this.page>1?window.location.href="/casos":(this.setPosts(i.posts),this.setTotal(i.total),this.setAuth(i.auth)))}async readPostsByCategory(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[2]:e.pop(),i=t?Number(e.pop()):1;this.setCategory(s),this.setPage(i),this.setLimit(1===i?5:6);const a={category:this.category,page:this.page,limit:this.limit},n=await L.post("/api/cases/category",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/casos/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}async readPostsBySearch(){const e=window.location.pathname.split("/"),t=e.includes("page"),s=t?e[3]:e.pop(),i=t?Number(e.pop()):1;this.setSearch(s),this.setPage(i),this.setLimit(1===i?5:6);const a={search:s.split("+").join(" "),page:this.page,limit:this.limit},n=await L.post("/api/cases/search",a);"error"!==n.status&&(!n.posts.length&&this.page>1?window.location.href=`/casos/search/${s}`:(this.setPosts(n.posts),this.setTotal(n.total),this.setAuth(n.auth)))}showPosts(){const e=document.querySelector("#cases-posts"),t=this.createPosts();e.appendChild(t),new l(this.page,this.limit,this.total,"/casos")}showPostsByCategory(){const e=document.querySelector("#cases-posts-by-category"),t=this.createPosts();e.appendChild(t),new l(this.page,this.limit,this.total,`/casos/${this.category}`)}showPostsBySearch(){const e=document.querySelector("#cases-posts-by-search"),t=this.createPosts();e.appendChild(t),new l(this.page,this.limit,this.total,`/casos/search/${this.search}`)}createPosts(){const e=document.createDocumentFragment();if(!this.posts.length){const t=document.createElement("p");t.textContent="No se encontraron posts",e.appendChild(t)}return this.posts.forEach(((t,s)=>{const i=this.createPost(t,s);e.appendChild(i)})),e}createPost(e,t){const s=document.createElement("article");1===this.page&&0===t&&s.classList.add("post-big");const i=document.createElement("div");i.classList.add("image"),s.appendChild(i);const a=document.createElement("img");a.src=`/build/img/casos/${e.images.before.src}`,a.alt=e.images.before.alt;const n=document.createElement("img");n.src=`/build/img/casos/${e.images.after.src}`,n.alt=e.images.after.alt,this.beforeAndAfter=new C(i,a,n);const r=document.createElement("h2");r.classList.add("title"),s.appendChild(r);const c=document.createElement("a");c.href=`/casos/${e.category_alias}/${e.alias}`,c.textContent=e.title,r.appendChild(c);const l=document.createElement("p");l.classList.add("description"),l.textContent=e.description,s.appendChild(l);const h=document.createElement("div");h.classList.add("row"),s.appendChild(h);const p=document.createElement("time");p.classList.add("date"),p.textContent=d(e.created_at),h.appendChild(p);const u=document.createElement("a");if(u.classList.add("author"),u.textContent=`By ${e.author}`,u.href="/casos",h.appendChild(u),this.auth){const t=document.createElement("div");t.classList.add("actions"),h.appendChild(t);const s=document.createElement("a");s.classList.add("edit"),s.href=`/editor/casos/${e.alias}`,t.appendChild(s);const i=o.get("pencilSquare");s.appendChild(i);const a=document.createElement("button");a.classList.add("remove"),a.addEventListener("click",this.deletePost.bind(this,e)),t.appendChild(a);const n=o.get("trash");a.appendChild(n)}if(1===this.page&&0===t){const t=document.createElement("a");t.classList.add("read-more"),t.href=`/casos/${e.category_alias}/${e.alias}`,h.appendChild(t);const s=document.createElement("span");s.textContent="Leer más",t.appendChild(s);const i=o.get("arrowRight");t.appendChild(i)}return s}async deletePost(e){const t=new c({title:"¿Eliminar post?",description:"¿Estás seguro de eliminar este post? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id,before_id:e.before_id,after_id:e.after_id};"error"!==(await L.delete("/api/cases",s)).status&&(await y.open({type:"success",title:"¡Post eliminado correctamente!",message:"Serás redirigido a los casos",timer:3e3}),window.location.href="/casos")}createImage(e,t=""){return new Promise(((s,i)=>{const a=new Image;a.src=e,a.alt=t,a.addEventListener("load",(()=>s(a))),a.addEventListener("error",(()=>i(new Error("Error loading image"))))}))}},this.search=new class{constructor(){this.init()}init(){document.querySelector("#cases-search-form")&&this.createSearch()}createSearch(){const e=document.querySelector("#cases-search-form");e.addEventListener("submit",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t);const s=document.createElement("div");s.classList.add("field"),e.appendChild(s);const i=document.createElement("button");i.classList.add("btn","primary-btn"),i.type="submit",i.ariaLabel="Buscar",s.appendChild(i);const n=o.get("search");i.appendChild(n)}async handleSearch(e){e.preventDefault();const t=new FormData(e.target),s=Object.fromEntries(t).search.trim().toLowerCase().split(" ").join("+");window.location.href=`/casos/search/${s}`}},this.categories=new class{constructor(){this.categories=[],this.category=null,this.values={name:"",alias:""},this.errors=null,this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"alias",headerName:"Alias"}],this.init()}async init(){const e=document.querySelector("#cases-categories"),t=document.querySelector("#cases-categories-table"),s=document.querySelector("#cases-categories-search");e&&(await this.readCategoriesInUse(),this.showCategoriesInUse()),t&&(await this.readAllCategories(),this.showCategoriesTable(),document.querySelector("#create-cases-category").addEventListener("click",this.handleCreateCategory.bind(this))),s&&this.createSearch()}setCategories(e){this.categories=e}async readCategoriesInUse(){const e=await L.get("/api/cases/categories");"error"!==e.status&&this.setCategories(e.categories)}async readAllCategories(){const e=await L.get("/api/admin/cases-categories");"error"!==e.status&&this.setCategories(e.categories)}resetValues(){this.values={name:"",alias:""}}handleCreateCategory(){this.modal=new u({title:"Crear categoría",content:this.createCategoryForm(),action:"Crear",actionCallback:()=>this.createCategory(),closeCallback:()=>this.resetValues()})}async createCategory(){const e=await L.post("/api/admin/cases-categories",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await y.open({type:"success",title:"¡Categoría creada!",message:"La categoría ha sido creada correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.category)}handleUpdateCategory(e){this.category=e,this.values={name:e.name,alias:e.alias},this.modal=new u({title:"Actualizar categoría",content:this.createCategoryForm(),action:"Actualizar",actionCallback:()=>this.updateCategory(),closeCallback:()=>this.resetValues()})}async updateCategory(){this.category={id:this.category.id,name:this.values.name,alias:this.values.alias};const e=await L.put("/api/admin/cases-categories",this.category);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await y.open({type:"success",title:"¡Categoría actualizada!",message:"La categoría ha sido actualziada correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.category)}async deleteCategory(e){const t=new c({title:"¿Eliminar categoría?",description:"¿Estás seguro de eliminar esta categoría? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await L.delete("/api/admin/cases-categories",s)).status&&(await y.open({type:"success",title:"¡Categoría eliminada!",message:"La categoría ha sido eliminada correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteCategories(e){const t=new c({title:`¿Eliminar ${e.length>1?"categorías":"categoría"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estas categorías":"esta categoría"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await L.delete("/api/admin/cases-categories/multiple",e)).status&&(await y.open({type:"success",title:`¡${e.length>1?"Categorías eliminadas":"Categoría eliminada"}!`,message:(e.length>1?"Las categorías han sido eliminadas":"La categoría ha sido eliminada")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#cases-categories-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar categoría",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createCategoryForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new a({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.values.alias=h(e),this.errors=null,s.setValue(this.values.alias)}}).getField();e.appendChild(t);const s=new a({label:{text:"Alias",for:"alias"},input:{type:"text",name:"alias",id:"alias",value:this.values?this.values.alias:""},error:this.errors&&this.errors.alias,message:this.errors&&this.errors.alias?this.errors.alias:""}),i=s.getField();return e.appendChild(i),e}showCategoriesInUse(){const e=document.querySelector("#cases-categories"),t=this.createCategoriesFragment();e.appendChild(t)}showCategoriesTable(){const e=document.querySelector("#cases-categories-table");this.table=new p({columns:this.columns,rows:this.categories,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateCategory.bind(this),delete:this.deleteCategory.bind(this),deleteSelected:this.deleteCategories.bind(this)})}createCategoriesFragment(){const e=document.createDocumentFragment();return this.categories.forEach((t=>{const s=this.createCategoryElement(t);e.appendChild(s)})),e}createCategoryElement(e){const t=document.createElement("a");t.href=`/casos/${e.alias}`;const s=document.createElement("span");s.textContent=e.name,t.appendChild(s);const i=o.get("arrowRight");return t.appendChild(i),t}},this.editor=new class{constructor(){this.post=null,this.categories=[],this.values={title:"",description:"",category_id:"",before_alt:"",after_alt:"",html:""},this.errors=null,this.previewBAF=!1,this.before=!1,this.after=!1,this.init()}async init(){document.querySelector("#cases-editor")&&(await this.loadCKEditor(),await this.readAllCategories(),await this.loadPost(),this.createEditorForm(),this.setFormEditorValues())}async loadCKEditor(){if(!document.querySelector('script[src="/build/js/vendor/ckeditor/ckeditor.js"]'))return new Promise(((e,t)=>{const s=document.createElement("script");s.src="/build/js/vendor/ckeditor/ckeditor.js",s.onload=e,s.onerror=t,document.body.appendChild(s)}))}createCKEditor(){return new Promise(((e,t)=>{ClassicEditor.create(html,{image:{toolbar:["imageStyle:inline","imageStyle:wrapText","imageStyle:breakText","|","toggleImageCaption","imageTextAlternative"]},extraPlugins:[b]}).then((t=>{this.editor=t,this.values.html&&this.editor.setData(this.values.html),e()})).catch((e=>{console.log(e),t()}))}))}async readAllCategories(){const e=await L.get("/api/admin/cases-categories");"error"!==e.status&&(this.categories=e.categories)}async loadPost(){const e=window.location.pathname.split("/").filter((e=>e));if(2===e.length)return;const t=e[2],s=await L.get(`/api/editor/cases/read/${t}`);"error"!==s.status&&(this.post=s.post,this.values={title:this.post.title,description:this.post.description,category_id:this.post.category_id,before_alt:this.post.images.before.alt,after_alt:this.post.images.after.alt,html:this.post.html})}async createEditorForm(){const e=document.querySelector("#cases-editor");this.formEditor=document.createElement("form"),this.formEditor.classList.add("mio-form"),this.formEditor.addEventListener("input",(e=>this.handleInput(e))),this.formEditor.addEventListener("submit",this.handleSubmit.bind(this)),e.appendChild(this.formEditor);const t=document.createElement("div");t.classList.add("col"),this.formEditor.appendChild(t);const s=document.createElement("h2");s.textContent="1. Título",t.appendChild(s);const i=document.createElement("p");i.textContent="Máximo 255 caracteres",t.appendChild(i);const r=new a({label:{text:"Título",for:"title"},input:{type:"text",name:"title",id:"title",value:this.values.title},error:this.errors&&this.errors.title,message:this.errors&&this.errors.title?this.errors.title:"",callback:e=>{this.values.title=e,this.errors=null}});t.appendChild(r.getField());const o=document.createElement("div");o.classList.add("col"),this.formEditor.appendChild(o);const c=document.createElement("h2");c.textContent="2. Descripción",o.appendChild(c);const l=document.createElement("p");l.textContent="Máximo 255 caracteres",o.appendChild(l);const d=new n({label:{text:"Descripción",for:"description"},input:{name:"description",id:"description",rows:2,value:this.values.description},error:this.errors&&this.errors.description,message:this.errors&&this.errors.description?this.errors.description:"",callback:e=>{this.values.description=e,this.errors=null}});o.appendChild(d.getField());const h=document.createElement("div");h.classList.add("col"),this.formEditor.appendChild(h);const p=document.createElement("h2");p.textContent="3. Categoría",h.appendChild(p);const u=document.createElement("p");u.textContent="Seleccionar la categoría a la que corresponde el post",h.appendChild(u);const m=new v({label:{text:"Categoría",for:"category_id"},select:{name:"category_id",id:"category_id"},option:{value:"id",text:"name"},options:this.categories,selected:this.values.category_id?{id:this.values.category_id}:null,error:this.errors&&this.errors.category_id,message:this.errors&&this.errors.category_id?this.errors.category_id:"",onSelect:e=>{this.values.category_id=e.id,this.errors=null}});h.appendChild(m.getField());const g=document.createElement("div");g.classList.add("row"),this.formEditor.appendChild(g);const b=document.createElement("div");b.classList.add("col"),g.appendChild(b);const C=document.createElement("h2");C.textContent="4. Imagen antes",b.appendChild(C);const f=document.createElement("p");f.textContent="Imagen antes. Recomendado 750px por 500px",b.appendChild(f),this.inputFileAfter&&this.inputFileAfter.getInput().files.length||(this.inputFileAfter=new w({label:{text:"Selecciona una imagen...",for:"before"},input:{name:"before",id:"before",accept:"image/jpeg, image/png"},error:this.errors&&this.errors.image?this.errors.image:"",callback:e=>{const t=this.inputFileAfter.getInput(),s=this.inputFileAfter.getLabel();this.previewImage(t,s,e)}})),b.appendChild(this.inputFileAfter.getField());const E=document.createElement("div");E.classList.add("col"),g.appendChild(E);const y=document.createElement("h2");y.textContent="5. Imagen después",E.appendChild(y);const L=document.createElement("p");L.textContent="Imagen después. Recomendado 750px por 500px",E.appendChild(L),this.inputFileBefore&&this.inputFileBefore.getInput().files.length||(this.inputFileBefore=new w({label:{text:"Selecciona una imagen...",for:"after"},input:{name:"after",id:"after",accept:"image/jpeg, image/png"},error:this.errors&&this.errors.image?this.errors.image:"",callback:e=>{const t=this.inputFileBefore.getInput(),s=this.inputFileBefore.getLabel();this.previewImage(t,s,e)}})),E.appendChild(this.inputFileBefore.getField());const x=document.createElement("div");x.classList.add("row"),this.formEditor.appendChild(x);const S=document.createElement("div");S.classList.add("before-alt"),x.appendChild(S);const P=document.createElement("h2");P.textContent="6. Descripción imagen antes",S.appendChild(P);const A=document.createElement("p");A.textContent="Descripción para imagen antes. Máximo 255 caracteres",S.appendChild(A);const F=new n({label:{text:"Descripción imagen antes",for:"before-alt"},input:{name:"before-alt",id:"before-alt",rows:2,value:this.values.before_alt},error:this.errors&&this.errors.before_alt,message:this.errors&&this.errors.before_alt?this.errors.before_alt:"",callback:()=>{this.errors=null}});S.appendChild(F.getField());const k=document.createElement("div");k.classList.add("before-alt"),x.appendChild(k);const q=document.createElement("h2");q.textContent="7. Descripción imagen después",k.appendChild(q);const T=document.createElement("p");T.textContent="Descripción para imagen después. Máximo 255 caracteres",k.appendChild(T);const R=new n({label:{text:"Descripción imagen después",for:"after-alt"},input:{name:"after-alt",id:"after-alt",rows:2,value:this.values.after_alt},error:this.errors&&this.errors.after_alt,message:this.errors&&this.errors.after_alt?this.errors.after_alt:"",callback:()=>{this.errors=null}});k.appendChild(R.getField());const B=document.createElement("div");B.classList.add("col"),this.formEditor.appendChild(B);const z=document.createElement("h2");z.textContent="8. Previsualización",B.appendChild(z);const I=document.createElement("p");I.textContent="Vista previa del deslizador antes y después",B.appendChild(I);const N=document.createElement("div");N.id="baf-preview",N.classList.add("field","baf-preview"),B.appendChild(N);const O=document.createElement("div");O.classList.add("col"),this.formEditor.appendChild(O);const D=document.createElement("h2");D.textContent="9. Contenido",O.appendChild(D);const $=document.createElement("p");$.textContent="Contenido principal del post",O.appendChild($);const _=document.createElement("div");_.classList.add("field"),this.errors&&this.errors.html&&_.classList.add("error"),O.appendChild(_);const M=document.createElement("textarea");if(M.id="html",M.name="html",_.appendChild(M),await this.createCKEditor(M),this.editor.model.document.on("change:data",(()=>{_.classList.remove("error"),_.querySelector(".error-message")&&_.querySelector(".error-message").remove(),this.values.html=this.editor.getData()})),this.post&&this.editor.setData(this.values.html),this.errors&&this.errors.image){const e=document.createElement("p");e.classList.add("error-message"),e.textContent=this.errors.html,_.appendChild(e)}const V=document.createElement("div");V.classList.add("field"),this.formEditor.appendChild(V);const H=document.createElement("input");H.type="submit",H.value=this.post?"Actualizar post":"Crear post",H.classList.add("btn","primary-btn"),V.appendChild(H)}async handleInput(e){const t=e.target,s=document.querySelector("#before"),i=document.querySelector("#after");if(this[t.name]=!0,s.value&&i.value&&!this.previewBAF){this.previewBAF=!0;const e=s.files[0],t=i.files[0],a=URL.createObjectURL(e),n=URL.createObjectURL(t);this.prevewBeforeAndAfter(a,n)}else if(this.isEdit()&&this.before&&this.after&&!this.previewBAF){if(this.previewBAF=!0,"before"===t.name){const e=`/build/img/casos/${this.post.images.after.src}`,t=s.files[0],i=URL.createObjectURL(t);this.prevewBeforeAndAfter(i,e)}if("after"===t.name){const e=`/build/img/casos/${this.post.images.before.src}`,t=i.files[0],s=URL.createObjectURL(t);this.prevewBeforeAndAfter(e,s)}}}async handleSubmit(e){e.preventDefault();const t=new FormData(e.currentTarget);t.append("html",this.editor.getData()),this.post&&t.append("id",this.post.id);const s=await L.post("/api/editor/cases/"+(this.post?"update":"create"),t);if("error"===s.status)return this.errors=s.errors,this.formEditor.remove(),void this.createEditorForm();await y.open({type:"success",title:`¡Post ${this.post?"actualizado":"creado"} correctamente!`,message:"Serás redirigido a los casos",timer:3e3}),window.location.href="/casos"}setFormEditorValues(){if(!this.isEdit())return;const e=document.querySelector("#before"),t=document.querySelector("label[for='before']"),s=`/build/img/casos/${this.post.images.before.src}`;this.before=!0,this.previewImage(e,t,s);const i=document.querySelector("#after"),a=document.querySelector("label[for='after']"),n=`/build/img/casos/${this.post.images.after.src}`;this.after=!0,this.previewImage(i,a,n),this.prevewBeforeAndAfter(s,n)}async previewImage(e,t,s){t.classList.add("hidden");const i=document.createElement("div");i.classList.add("image-preview"),e.parentElement.appendChild(i);const a=await this.createImage(s);i.appendChild(a);const n=document.createElement("button");n.classList.add("close"),n.type="button",n.addEventListener("click",(()=>{e.value="",t.classList.remove("hidden"),i.remove(),this.beforeAndAfter&&this.beforeAndAfter.destroy(),this.previewBAF=!1,this[e.name]=!1})),i.appendChild(n);const r=o.get("xLg");n.appendChild(r)}createImage(e,t=""){return new Promise(((s,i)=>{const a=new Image;a.src=e,a.alt=t,a.addEventListener("load",(()=>s(a))),a.addEventListener("error",(()=>i(new Error("Error loading image"))))}))}async prevewBeforeAndAfter(e,t){const s=await this.createImage(e),i=await this.createImage(t),a=document.querySelector("#baf-preview");this.beforeAndAfter=new C(a,s,i)}isEdit(){return window.location.pathname.split("/").filter((e=>e)).length>2}}}},new class{constructor(){this.patients=[],this.patient=null,this.values={name:"",surname:"",phone:"",email:"",nif:"",birth_date:"",gender:"",meet:"",insurance:"",address:"",postcode:"",location:"",province:"",country:"",comment:""},this.errors=null,this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"surname",headerName:"Apellidos"},{field:"phone",headerName:"Telefono"},{field:"age",headerName:"Edad"}],this.init()}async init(){const e=document.querySelector("#patients-table"),t=document.querySelector("#patients-search");e&&(await this.readAllPatients(),this.showPatientsTable(),document.querySelector("#patient-create").addEventListener("click",this.handleCreatePatient.bind(this))),t&&this.createSearch()}async readAllPatients(){const e=await L.get("/api/admin/patients");"error"!==e.status&&(this.patients=e.patients)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleCreatePatient(){this.modal=new u({title:"Crear paciente",content:this.createPatientForm(),action:"Crear",maxWidth:"700px",actionCallback:()=>this.createPatient(),closeCallback:()=>this.resetValues()})}async createPatient(){const e=await L.post("/api/admin/patients",this.values);if(console.log(e),"error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createPatientForm());await y.open({type:"success",title:"Paciente creado!",message:"El paciente ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.patient)}handleUpdatePatient(e){this.patient=e,this.setValues(e),this.modal=new u({title:"Actualizar paciente",content:this.createPatientForm(),action:"Actualizar",actionCallback:()=>this.updatePatient(),closeCallback:()=>this.resetValues()})}async updatePatient(){this.patient={id:this.patient.id,...this.values};const e=await L.put("/api/admin/patients",this.patient);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createPatientForm());await y.open({type:"success",title:"¡Paciente actualizado!",message:"El paciente ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.patient)}async deletePatient(e){const t=new c({title:"¿Eliminar paciente?",description:"¿Estás seguro de eliminar esta paciente? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await L.delete("/api/admin/patients",s)).status&&(await y.open({type:"success",title:"Paciente eliminado!",message:"El paciente ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deletePatients(e){const t=new c({title:`¿Eliminar ${e.length>1?"pacientes":"paciente"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos pacientes":"esta paciente"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await L.delete("/api/admin/patients/multiple",e)).status&&(await y.open({type:"success",title:`¡${e.length>1?"Pacientes eliminados":"Paciente eliminado"}!`,message:(e.length>1?"Los pacientes han sido eliminados":"El paciente ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#patients-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar paciente",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createPatientForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=document.createElement("div");t.classList.add("mio-double"),e.appendChild(t);const s=new a({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null}}).getField();t.appendChild(s);const i=new a({label:{text:"Apellidos",for:"surname"},input:{type:"text",name:"surname",id:"surname",value:this.values?this.values.surname:""},callback:e=>{this.values.surname=e,this.errors=null}}).getField();t.appendChild(i);const r=document.createElement("div");r.classList.add("mio-double"),e.appendChild(r);const o=new a({label:{text:"Teléfono",for:"phone"},input:{type:"text",name:"phone",id:"phone",value:this.values?this.values.phone:""},callback:e=>{this.values.phone=e,this.errors=null}}).getField();r.appendChild(o);const c=new a({label:{text:"NIF",for:"nif"},input:{type:"text",name:"nif",id:"nif",value:this.values?this.values.nif:""},callback:e=>{this.values.nif=e,this.errors=null}}).getField();r.appendChild(c);const l=new a({label:{text:"Email",for:"email"},input:{type:"email",name:"email",id:"email",value:this.values?this.values.email:""},error:this.errors&&this.errors.email,message:this.errors&&this.errors.email?this.errors.email:"",callback:e=>{this.values.email=e,this.errors=null}}).getField();e.appendChild(l);const d=document.createElement("div");d.classList.add("mio-double"),e.appendChild(d);const h=new a({label:{text:"Fecha de nacimiento",for:"birth_date"},input:{type:"date",name:"birth_date",id:"birth_date",value:this.values?this.values.birth_date:""},callback:e=>{this.values.birth_date=e,this.errors=null}}).getField();d.appendChild(h);const p=new v({label:{text:"Género",for:"gender"},select:{name:"gender",id:"gender"},option:{value:"value",text:"text"},options:[{value:"male",text:"Hombre"},{value:"female",text:"Mujer"}],selected:this.values.gender?{value:this.values.gender}:null,onSelect:e=>{this.values.gender=e.value,this.errors=null}}).getField();d.appendChild(p);const u=document.createElement("div");u.classList.add("mio-double"),e.appendChild(u);const m=new v({label:{text:"¿Cómo nos ha conocido?",for:"meet"},select:{name:"meet",id:"meet"},option:{value:"value",text:"text"},options:[{value:"recommendation",text:"Recomendación"},{value:"social-media",text:"Redes sociales"},{value:"web",text:"Web"},{value:"street",text:"Calle"},{value:"insurance",text:"Seguro"},{value:"other",text:"Otro"}],selected:this.values.meet?{value:this.values.meet}:null,onSelect:e=>{this.values.meet=e.value,this.errors=null}}).getField();u.appendChild(m);const g=new a({label:{text:"Seguro",for:"insurance"},input:{type:"text",name:"insurance",id:"insurance",value:this.values?this.values.insurance:""},callback:e=>{this.values.insurance=e,this.errors=null}}).getField();u.appendChild(g);const b=new a({label:{text:"Dirección",for:"address"},input:{type:"text",name:"address",id:"address",value:this.values?this.values.address:""},callback:e=>{this.values.address=e,this.errors=null}}).getField();e.appendChild(b);const w=document.createElement("div");w.classList.add("mio-double"),e.appendChild(w);const C=new a({label:{text:"Código postal",for:"postcode"},input:{type:"text",name:"postcode",id:"postcode",value:this.values?this.values.postcode:""},callback:e=>{this.values.postcode=e,this.errors=null}}).getField();w.appendChild(C);const f=new a({label:{text:"Localidad",for:"location"},input:{type:"text",name:"location",id:"location",value:this.values?this.values.location:""},callback:e=>{this.values.location=e,this.errors=null}}).getField();w.appendChild(f);const E=document.createElement("div");E.classList.add("mio-double"),e.appendChild(E);const y=new a({label:{text:"Provincia",for:"province"},input:{type:"text",name:"province",id:"province",value:this.values?this.values.province:""},callback:e=>{this.values.province=e,this.errors=null}}).getField();E.appendChild(y);const L=new a({label:{text:"País",for:"country"},input:{type:"text",name:"country",id:"country",value:this.values?this.values.country:""},callback:e=>{this.values.country=e,this.errors=null}}).getField();E.appendChild(L);const x=new n({label:{text:"Comentario",for:"comment"},input:{name:"comment",id:"comment",rows:2,maxlength:255,value:this.values?this.values.comment:""},callback:e=>{this.values.comment=e,this.errors=null}}).getField();return e.appendChild(x),e}showPatientsTable(){const e=document.querySelector("#patients-table");this.table=new p({columns:this.columns,rows:this.patients,findFields:["name","surname","phone","email"],container:e,visibleRows:15,rowsPerPage:20,update:this.handleUpdatePatient.bind(this),delete:this.deletePatient.bind(this),deleteSelected:this.deletePatients.bind(this)})}},new class{constructor(){this.treatments=[],this.treatment=null,this.values={name:"",description:"",price:""},this.columns=[{field:"id",headerName:"Id"},{field:"name",headerName:"Nombre"},{field:"description",headerName:"Descripción"},{field:"price",headerName:"Precio"}],this.init()}async init(){const e=document.querySelector("#treatments-table"),t=document.querySelector("#treatments-search");e&&(await this.readAllTreatments(),this.showTreatmentsTable(),document.querySelector("#treatment-create").addEventListener("click",this.handleCreateTreatment.bind(this))),t&&this.createSearch()}async readAllTreatments(){const e=await L.get("/api/admin/treatments");"error"!==e.status&&(this.treatments=e.treatments)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleCreateTreatment(){this.modal=new u({title:"Crear tratamiento",content:this.createTreatmentForm(),action:"Crear",actionCallback:()=>this.createTreatment(),closeCallback:()=>this.resetValues()})}async createTreatment(){const e=await L.post("/api/admin/treatments",this.values);if("error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createTreatmentForm());await y.open({type:"success",title:"Tratamiento creado!",message:"El tratamiento ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.treatment)}handleUpdateTreatment(e){this.treatment=e,this.setValues(e),this.modal=new u({title:"Actualizar tratamiento",content:this.createTreatmentForm(),action:"Actualizar",actionCallback:()=>this.updateTreatment(),closeCallback:()=>this.resetValues()})}async updateTreatment(){this.patient={id:this.treatment.id,...this.values};const e=await L.put("/api/admin/treatments",this.patient);if(console.log(e),"error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createCategoryForm());await y.open({type:"success",title:"¡Tratamiento actualizado!",message:"El tratamiento ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.treatment)}async deleteTreatment(e){const t=new c({title:"¿Eliminar tratamiento?",description:"¿Estás seguro de eliminar esta tratamiento? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await L.delete("/api/admin/treatments",s)).status&&(await y.open({type:"success",title:"Tratamiento eliminado!",message:"El tratamiento ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteTreatments(e){const t=new c({title:`¿Eliminar ${e.length>1?"tratamientos":"tratamiento"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos tratamientos":"esta tratamiento"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await L.delete("/api/admin/treatments/multiple",e)).status&&(await y.open({type:"success",title:`¡${e.length>1?"Tratamientos eliminados":"Tratamiento eliminado"}!`,message:(e.length>1?"Los tratamientos han sido eliminados":"El tratamiento ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#treatments-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar tratamiento",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createTreatmentForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new a({label:{text:"Nombre",for:"name"},input:{type:"text",name:"name",id:"name",value:this.values?this.values.name:""},error:this.errors&&this.errors.name,message:this.errors&&this.errors.name?this.errors.name:"",callback:e=>{this.values.name=e,this.errors=null}}).getField();e.appendChild(t);const s=new a({label:{text:"Descripción",for:"description"},input:{type:"text",name:"description",id:"description",value:this.values?this.values.description:""},callback:e=>{this.values.description=e}}).getField();e.appendChild(s);const i=new a({label:{text:"Precio",for:"price"},input:{type:"number",name:"price",id:"price",value:this.values?this.values.price:"",step:"0.01"},error:this.errors&&this.errors.price,message:this.errors&&this.errors.price?this.errors.price:"",callback:e=>{this.values.price=e,this.errors=null}}).getField();return e.appendChild(i),e}showTreatmentsTable(){const e=document.querySelector("#treatments-table");this.table=new p({columns:this.columns,rows:this.treatments,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateTreatment.bind(this),delete:this.deleteTreatment.bind(this),deleteSelected:this.deleteTreatments.bind(this)})}},new class{constructor(){this.patients=[],this.budgets=[],this.budget={patient:null,comment:"",budgeteds:[],errors:null},this.init()}async init(){const e=document.querySelector("#budgets-table"),t=document.querySelector("#budgets-search");e&&(await this.readAllPatients(),await this.readAllBudgets(),this.showBudgetsTable(),document.querySelector("#budget-create").addEventListener("click",this.handleCreateBudget.bind(this))),t&&this.createSearch()}resetBudget(){this.budget={patient:null,comment:"",budgeteds:[],errors:null}}async readAllBudgets(){const e=await L.get("/api/admin/budgets");"error"!==e.status&&(this.budgets=e.budgets)}async readAllPatients(){const e=await L.get("/api/admin/patients");"error"!==e.status&&(this.patients=e.patients)}async handleCreateBudget(){this.budgeteds=new E({budgeteds:[...this.budget.budgeteds],callback:()=>{this.budgeteds.repaint(this.budgeteds.getBudgeteds()),this.modal.repaint(this.createBudgetForm())}}),await this.budgeteds.readAllTreatments(),this.budgeteds.show(),this.modal=new u({title:"Crear presupuesto",content:this.createBudgetForm(),action:"Crear",actionCallback:()=>this.createBudget(),closeCallback:()=>{this.resetBudget()},maxWidth:"800px"})}async createBudget(){this.budget.budgeteds=this.budgeteds.getBudgeteds();const e=await L.post("/api/admin/budgets",this.budget);if("error"===e.status)return"budget"===e.type&&(this.budget.errors=e.errors),"budgeted"===e.type&&this.budget.budgeteds.forEach((t=>{e.errors.forEach((e=>{e.id===t.id&&(t.errors=e.errors)}))})),this.budgeteds.repaint(this.budgeteds.getBudgeteds()),void this.modal.repaint(this.createBudgetForm());await y.open({type:"success",title:"¡Presupuesto creado!",message:"El presupuesto ha sido creado correctamente.",timer:3e3}),await this.modal.close(),this.table.addRow(e.budget)}async handleUpdateBudget(e){this.budget=structuredClone(e),this.budgeteds=new E({budgeteds:this.budget.budgeteds,callback:()=>{this.budgeteds.repaint(this.budgeteds.getBudgeteds()),this.modal.repaint(this.createBudgetForm())}}),await this.budgeteds.readAllTreatments(),this.budgeteds.show(),this.modal=new u({title:"Actualizar presupuesto",content:this.createBudgetForm(),action:"Actualizar",actionCallback:()=>this.updateBudget(),closeCallback:()=>{this.resetBudget()},maxWidth:"800px"})}async updateBudget(){this.budget.budgeteds=this.budgeteds.getBudgeteds();const e=await L.put("/api/admin/budgets",this.budget);if("error"===e.status)return"budget"===e.type&&(this.budget.errors=e.errors),"budgeted"===e.type&&this.budget.budgeteds.forEach((t=>{e.errors.forEach((e=>{e.id===t.id&&(t.errors=e.errors)}))})),this.budgeteds.repaint(this.budgeteds.getBudgeteds()),void this.modal.repaint(this.createBudgetForm());await y.open({type:"success",title:"¡Presupuesto actualizado!",message:"El presupuesto ha sido actualziado correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.budget)}async deleteBudget(e){const t=new c({title:"¿Eliminar presupuesto?",description:"¿Estás seguro de eliminar esta presupuesto? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await L.delete("/api/admin/budgets",e)).status&&(await y.open({type:"success",title:"¡Presupuesto eliminado!",message:"El presupuesto ha sido eliminado correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteBudgets(e){const t=new c({title:`¿Eliminar ${e.length>1?"presupuestos":"presupuesto"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estos presupuestos":"esta presupuesto"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await L.delete("/api/admin/budgets/multiple",e)).status&&(await y.open({type:"success",title:`¡${e.length>1?"Presupuestos eliminados":"Presupuesto eliminado"}!`,message:(e.length>1?"Los presupuestos han sido eliminados":"El presupuesto ha sido eliminado")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#budgets-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar presupuesto",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createBudgetForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new a({label:{text:"Paciente",for:"patient"},input:{type:"text",name:"patient",id:"patient",value:this.budget.patient?`${this.budget.patient.name} ${this.budget.patient.surname}`:""},error:this.budget.errors&&this.budget.errors.patient,message:this.budget.errors&&this.budget.errors.patient?this.budget.errors.patient:"",callback:()=>{this.budget.errors=null}}).getField();e.appendChild(t),new f({target:t.querySelector("input"),data:this.patients,findFields:["name","surname"],showFields:["name","surname"],size:6,callback:e=>{this.budget.patient=e}});const s=new n({label:{text:"Comentario",for:"comment"},input:{name:"comment",id:"comment",rows:3,value:this.budget.comment},callback:e=>{this.budget.comment=e}});return e.appendChild(s.getField()),e.appendChild(this.budgeteds.getBudgetedsEl()),e}showBudgetsTable(){const e=document.querySelector("#budgets-table");this.table=new p({columns:[{field:"id",headerName:"Id"},{field:"full_patient_name",headerName:"Paciente"},{field:"total",headerName:"Total"},{field:"created_at",headerName:"Fecha"}],rows:this.budgets,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateBudget.bind(this),delete:this.deleteBudget.bind(this),deleteSelected:this.deleteBudgets.bind(this),extraActions:[{name:"Generar PDF",icon:o.get("filePDF"),callback:this.generatePDF.bind(this)},{name:"Crear factura",icon:o.get("fileText"),callback:this.createInvoice.bind(this)}]})}async generatePDF(e){const t=await L.post("/api/admin/budgets/pdf",e),s=`data:application/pdf;base64,${t.base64}`,i=document.createElement("a"),a=t.fileName;i.href=s,i.download=a,i.click()}async createInvoice(e){const t=await L.post("/api/admin/invoices",e);"error"!==t.status?await y.open({type:"success",title:"¡Factura creada!",message:"La factura ha sido creada correctamente.",timer:3e3}):await y.open({type:"error",title:"Error al crear la factura",message:t.message,timer:3e3})}dateFormat(){const e=new Date(date);return new Intl.DateTimeFormat("es-ES",{dateStyle:"short"}).format(e)}},new class{constructor(){this.invoices=[],this.invoice=null,this.values={number:""},this.init()}async init(){const e=document.querySelector("#invoices-table"),t=document.querySelector("#invoices-search");e&&(await this.readAllInvoices(),this.showInvoicesTable()),t&&this.createSearch()}async readAllInvoices(){const e=await L.get("/api/admin/invoices");"error"!==e.status&&(this.invoices=e.invoices)}setValues(e){for(const t of Object.keys(e))void 0!==this.values[t]&&(this.values[t]=e[t])}resetValues(){for(const e of Object.keys(this.values))this.values[e]=""}handleUpdateInvoice(e){this.invoice=e,this.setValues(e),this.modal=new u({title:"Actualizar factura",content:this.createInvoiceForm(),action:"Actualizar",actionCallback:()=>this.updateInvoice(),closeCallback:()=>this.resetValues()})}async updateInvoice(){this.invoice.number=this.values.number;const e=await L.put("/api/admin/invoices",this.invoice);if(console.log(e),"error"===e.status)return this.errors=e.errors,void this.modal.repaint(this.createInvoiceForm());await y.open({type:"success",title:"¡Factura actualizada!",message:"La factura ha sido actualziada correctamente.",timer:3e3}),await this.modal.close(),this.table.updateRow(e.invoice)}async deleteInvoice(e){const t=new c({title:"¿Eliminar factura?",description:"¿Estás seguro de eliminar esta factura? Los datos no podrán ser recuperados.",accept:"Eliminar",cancel:"Cancelar"});if(!await t.question())return;const s={id:e.id};"error"!==(await L.delete("/api/admin/invoices",s)).status&&(await y.open({type:"success",title:"Factura eliminada!",message:"La factura ha sido eliminada correctamente.",timer:3e3}),this.table.deleteRow(e))}async deleteInvoices(e){const t=new c({title:`¿Eliminar ${e.length>1?"facturas":"factura"}?`,description:`¿Estás seguro de eliminar  ${e.length>1?"estas facturas":"esta factura"}? Los datos no podrán ser recuperados.`,accept:"Eliminar",cancel:"Cancelar"});await t.question()&&"error"!==(await L.delete("/api/admin/invoices/multiple",e)).status&&(await y.open({type:"success",title:`¡${e.length>1?"Facturas eliminadas":"Factura eliminada"}!`,message:(e.length>1?"Las facturas han sido eliminadas":"La factura ha sido eliminada")+" correctamente!",timer:3e3}),this.table.deleteRows(e))}createSearch(){const e=document.querySelector("#invoices-search");e.addEventListener("keyup",this.handleSearch.bind(this));const t=new a({label:{text:"Buscar factura",for:"search"},input:{type:"text",name:"search",id:"search"}}).getField();e.appendChild(t)}async handleSearch(e){const t=e.target.value;this.table.searchRow(t)}createInvoiceForm(){const e=document.createElement("form");e.classList.add("mio-form"),e.noValidate=!0;const t=new a({label:{text:"Número de factura",for:"number"},input:{type:"text",name:"number",id:"number",value:this.values?this.values.number:""},error:this.errors&&this.errors.number,message:this.errors&&this.errors.number?this.errors.number:"",callback:e=>{this.values.number=e,this.errors=null}}).getField();return e.appendChild(t),e}showInvoicesTable(){const e=document.querySelector("#invoices-table");this.table=new p({columns:[{field:"id",headerName:"Id"},{field:"number",headerName:"Número"},{field:"full_patient_name",headerName:"Paciente"},{field:"total",headerName:"Total"},{field:"created_at",headerName:"Fecha"}],rows:this.invoices,container:e,visibleRows:10,rowsPerPage:15,update:this.handleUpdateInvoice.bind(this),delete:this.deleteInvoice.bind(this),deleteSelected:this.deleteInvoices.bind(this),extraActions:[{name:"Generar PDF",icon:o.get("filePDF"),callback:this.generatePDF.bind(this)}]})}async generatePDF(e){const t=await L.post("/api/admin/invoices/pdf",e),s=`data:application/pdf;base64,${t.base64}`,i=document.createElement("a"),a=t.fileName;i.href=s,i.download=a,i.click()}}})();